<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Rinevard</title>
  
  
  <link href="http://rinevard.github.io/atom.xml" rel="self"/>
  
  <link href="http://rinevard.github.io/"/>
  <updated>2025-08-22T02:59:28.690Z</updated>
  <id>http://rinevard.github.io/</id>
  
  <author>
    <name>Rinevard</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hw 1 Transformation</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/GAMES101/Hw/Hw1-transformation/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/GAMES101/Hw/Hw1-transformation/</id>
    <published>2025-08-22T03:00:58.000Z</published>
    <updated>2025-08-22T02:59:28.690Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ¬¡ä½œä¸šè¦æ±‚æˆ‘ä»¬å®ç°æ—‹è½¬çŸ©é˜µã€æŠ•å½±çŸ©é˜µã€‚æˆ‘ä»¬å…ˆç®€å•çœ‹ä¸‹ä½œä¸šæ˜¯æ€ä¹ˆåšçš„ï¼Œå†çœ‹çœ‹ä»£ç æ¡†æ¶é‡Œçš„å‡ ä¸ªæœ‰è¶£çš„åœ°æ–¹ã€‚</p><h1 id="ä½œä¸šå®ç°"><a href="#ä½œä¸šå®ç°" class="headerlink" title="ä½œä¸šå®ç°"></a>ä½œä¸šå®ç°</h1><h2 id="ä¸¤ä¸ªæ—‹è½¬çŸ©é˜µ"><a href="#ä¸¤ä¸ªæ—‹è½¬çŸ©é˜µ" class="headerlink" title="ä¸¤ä¸ªæ—‹è½¬çŸ©é˜µ"></a>ä¸¤ä¸ªæ—‹è½¬çŸ©é˜µ</h2><p>ç»• $z$ è½´çš„æ—‹è½¬çŸ©é˜µå®ç°èµ·æ¥å¾ˆç®€å•ï¼ŒæŠŠè¯¾ä¸Šçš„å†…å®¹ç¿»è¯‘æˆä»£ç å°±å¥½ã€‚åœ¨ä½¿ç”¨ std çš„ sin å’Œ cos æ—¶è¦æ³¨æ„æŠŠè§’åº¦è½¬æ¢æˆå¼§åº¦ã€‚</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Eigen<span class="token double-colon punctuation">::</span>Matrix4f <span class="token function">get_model_matrix</span><span class="token punctuation">(</span><span class="token keyword">float</span> rotation_angle<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    Eigen<span class="token double-colon punctuation">::</span>Matrix4f model <span class="token operator">=</span> Eigen<span class="token double-colon punctuation">::</span><span class="token class-name">Matrix4f</span><span class="token double-colon punctuation">::</span><span class="token function">Identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">float</span> angle_rad <span class="token operator">=</span> rotation_angle <span class="token operator">*</span> MY_PI <span class="token operator">/</span> <span class="token number">180.0</span><span class="token punctuation">;</span>    Eigen<span class="token double-colon punctuation">::</span>Matrix4f rotate<span class="token punctuation">;</span>    <span class="token keyword">float</span> sine <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">sin</span><span class="token punctuation">(</span>angle_rad<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">float</span> cosine <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">cos</span><span class="token punctuation">(</span>angle_rad<span class="token punctuation">)</span><span class="token punctuation">;</span>    rotate <span class="token operator">&lt;&lt;</span> cosine<span class="token punctuation">,</span> <span class="token operator">-</span>sine<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>            sine<span class="token punctuation">,</span> cosine<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>             <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>             <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">;</span>    model <span class="token operator">=</span> rotate <span class="token operator">*</span> model<span class="token punctuation">;</span>    <span class="token keyword">return</span> model<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æé«˜é¡¹é‡Œçš„æ—‹è½¬çŸ©é˜µç”¨è¯¾ä¸Šè®²çš„ Rodriguesâ€™ rotation formula å°±è¡Œï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/*    Computes the 4x4 rotation matrix representing a rotation of rotation_angle (in degree)     around a given normalized axis vector that passes through the origin,     using Rodrigues' rotation formula.*/</span>Eigen<span class="token double-colon punctuation">::</span>Matrix4f <span class="token function">get_rotation</span><span class="token punctuation">(</span>Vector3f axis<span class="token punctuation">,</span> <span class="token keyword">float</span> rotation_angle<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">float</span> angle_rad <span class="token operator">=</span> rotation_angle <span class="token operator">*</span> MY_PI <span class="token operator">/</span> <span class="token number">180.0</span><span class="token punctuation">;</span>        Eigen<span class="token double-colon punctuation">::</span>Matrix3f rot_mat <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token function">cos</span><span class="token punctuation">(</span>angle_rad<span class="token punctuation">)</span> <span class="token operator">*</span> Eigen<span class="token double-colon punctuation">::</span><span class="token class-name">Matrix3f</span><span class="token double-colon punctuation">::</span><span class="token function">Identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    rot_mat <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> std<span class="token double-colon punctuation">::</span><span class="token function">cos</span><span class="token punctuation">(</span>angle_rad<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> axis <span class="token operator">*</span> axis<span class="token punctuation">.</span><span class="token function">transpose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Eigen<span class="token double-colon punctuation">::</span>Matrix3f cross_product_mat<span class="token punctuation">;</span>    cross_product_mat <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>axis<span class="token punctuation">.</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        axis<span class="token punctuation">.</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>axis<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                         <span class="token operator">-</span>axis<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> axis<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">;</span>    rot_mat <span class="token operator">+=</span> std<span class="token double-colon punctuation">::</span><span class="token function">sin</span><span class="token punctuation">(</span>angle_rad<span class="token punctuation">)</span> <span class="token operator">*</span> cross_product_mat<span class="token punctuation">;</span>    Eigen<span class="token double-colon punctuation">::</span>Matrix4f trans_mat <span class="token operator">=</span> Eigen<span class="token double-colon punctuation">::</span><span class="token class-name">Matrix4f</span><span class="token double-colon punctuation">::</span><span class="token function">Identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    trans_mat<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">topLeftCorner</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> rot_mat<span class="token punctuation">;</span>    <span class="token keyword">return</span> trans_mat<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æŠ•å½±çŸ©é˜µ"><a href="#æŠ•å½±çŸ©é˜µ" class="headerlink" title="æŠ•å½±çŸ©é˜µ"></a>æŠ•å½±çŸ©é˜µ</h2><p>æŠ•å½±çŸ©é˜µå°±ç›¸å¯¹å¤æ‚ä¸€äº›äº†ï¼Œå…ˆä¸Šä»£ç </p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Eigen<span class="token double-colon punctuation">::</span>Matrix4f <span class="token function">get_projection_matrix</span><span class="token punctuation">(</span><span class="token keyword">float</span> eye_fov<span class="token punctuation">,</span> <span class="token keyword">float</span> aspect_ratio<span class="token punctuation">,</span>                                      <span class="token keyword">float</span> zNear<span class="token punctuation">,</span> <span class="token keyword">float</span> zFar<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// Students will implement this function</span>    Eigen<span class="token double-colon punctuation">::</span>Matrix4f projection <span class="token operator">=</span> Eigen<span class="token double-colon punctuation">::</span><span class="token class-name">Matrix4f</span><span class="token double-colon punctuation">::</span><span class="token function">Identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Eigen<span class="token double-colon punctuation">::</span>Matrix4f perspective<span class="token punctuation">;</span>    <span class="token keyword">float</span> cotangent <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token operator">/</span> std<span class="token double-colon punctuation">::</span><span class="token function">tan</span><span class="token punctuation">(</span>eye_fov <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">float</span> z_delta <span class="token operator">=</span> zFar <span class="token operator">-</span> zNear<span class="token punctuation">;</span>    perspective <span class="token operator">&lt;&lt;</span> cotangent <span class="token operator">/</span> aspect_ratio<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>                     <span class="token number">0</span><span class="token punctuation">,</span> cotangent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>                     <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token punctuation">(</span>zFar <span class="token operator">+</span> zNear<span class="token punctuation">)</span> <span class="token operator">/</span> z_delta<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> zFar <span class="token operator">*</span> zNear <span class="token operator">/</span> z_delta<span class="token punctuation">,</span>                    <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">;</span>    projection <span class="token operator">=</span> perspective <span class="token operator">*</span> projection<span class="token punctuation">;</span>    <span class="token keyword">return</span> projection<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆæˆ‘ä»¬ä¼šå‘ç°è¾“å…¥çš„ zNear å’Œ zFar éƒ½æ˜¯æ­£æ•°ï¼Œä»–ä»¬è¡¨ç¤ºè¿‘å¹³é¢å’Œè¿œå¹³é¢åˆ°åŸç‚¹çš„è·ç¦»ï¼Œè¿™ä¸è¯¾ä¸Šè®²çš„ä¸åŒã€‚è¯¾ä¸Šè®²çš„ $n$ å’Œ $f$ è¡¨ç¤ºè¿‘å¹³é¢å’Œè¿œå¹³é¢åœ¨ $z$ è½´çš„åæ ‡ï¼Œä»–ä»¬æ˜¯è´Ÿæ•°ã€‚</p><p>ç„¶åæˆ‘ä»¬åˆ†æ rasterizer.cpp é‡Œçš„ draw å‡½æ•°ï¼Œä¸‹é¢è¿™æ®µä»£ç é‡Œï¼Œv æ˜¯ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹æ„æˆçš„æ•°ç»„ï¼Œä¸‰ä¸ªé¡¶ç‚¹éƒ½å·²ç»è¢«å˜æ¢åˆ°äº† $[-1,1]^3$ çš„æ­£æ–¹ä½“ä¸­ã€‚</p><p>æ³¨æ„ <code>vert.z() = vert.z() * f1 + f2</code> è¿™è¡Œä»£ç ï¼ŒæŠŠ $-1$ ä»£å…¥å³è¾¹å¾—åˆ° $-n$ï¼Œ$1$ ä»£å…¥å³è¾¹å¾—åˆ° $-f$ï¼Œå› æ­¤æˆ‘ä»¬æœ‰ç†ç”±çŒœæµ‹ $[-n,-f]$ è¢«æ˜ å°„åˆ°äº† $[-1,1]$. </p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">float</span> f1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">-</span> <span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span><span class="token keyword">float</span> f2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">+</span> <span class="token number">0.1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">;</span><span class="token comment">// ...</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span> vert <span class="token operator">:</span> v<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    vert<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.5</span><span class="token operator">*</span>width<span class="token operator">*</span><span class="token punctuation">(</span>vert<span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    vert<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.5</span><span class="token operator">*</span>height<span class="token operator">*</span><span class="token punctuation">(</span>vert<span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    vert<span class="token punctuation">.</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> vert<span class="token punctuation">.</span><span class="token function">z</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> f1 <span class="token operator">+</span> f2<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬çš„å‘ç°ï¼š</p><ol><li>è¾“å…¥çš„ zNear å’Œ zFar éƒ½æ˜¯æ­£æ•°ï¼Œè¡¨ç¤ºè¿‘å¹³é¢å’Œè¿œå¹³é¢åˆ°åŸç‚¹çš„è·ç¦»</li><li>$[-n,-f]$ è¢«æ˜ å°„åˆ°äº† $[-1,1]$</li></ol><p>æœ€ç»ˆæˆ‘ä»¬èƒ½å†™å‡ºè¿™æ ·çš„æŠ•å½±çŸ©é˜µï¼š</p><script type="math/tex; mode=display">\large\text{M}_\text{per} =\begin{bmatrix}\frac{1}{\text{aspect} \times \tan(\frac{\text{fov}}{2})} & 0 & 0 & 0 \\0 & \frac{1}{\tan(\frac{\text{fov}}{2})} & 0 & 0 \\0 & 0 & -\frac{f+n}{f-n} & -\frac{2fn}{f-n} \\0 & 0 & -1 & 0\end{bmatrix}</script><p>ç¿»è¯‘æˆä»£ç å°±å¥½ã€‚</p><h1 id="ä»£ç æ¡†æ¶é‡Œæœ‰è¶£çš„åœ°æ–¹"><a href="#ä»£ç æ¡†æ¶é‡Œæœ‰è¶£çš„åœ°æ–¹" class="headerlink" title="ä»£ç æ¡†æ¶é‡Œæœ‰è¶£çš„åœ°æ–¹"></a>ä»£ç æ¡†æ¶é‡Œæœ‰è¶£çš„åœ°æ–¹</h1><h2 id="ind-çš„ä½œç”¨"><a href="#ind-çš„ä½œç”¨" class="headerlink" title="ind çš„ä½œç”¨"></a>ind çš„ä½œç”¨</h2><p>é¦–å…ˆæˆ‘ä»¬çœ‹å‘ main.cpp çš„ main å‡½æ•°é‡Œçš„è¿™æ®µä»£ç </p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Eigen<span class="token double-colon punctuation">::</span>Vector3f<span class="token operator">></span> pos<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Eigen<span class="token double-colon punctuation">::</span>Vector3i<span class="token operator">></span> ind<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>pos æ˜¾ç„¶æ˜¯ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹ï¼Œä½† ind æ˜¯åšä»€ä¹ˆçš„ï¼Ÿuh actuallyğŸ¤“â˜ï¸å®ƒå®šä¹‰äº†å¦‚ä½•å°†é¡¶ç‚¹è¿æ¥èµ·æ¥ã€‚å¯¹ä¸‰è§’å½¢æ¥è¯´å®ƒå½“ç„¶æ²¡ä»€ä¹ˆç”¨ï¼Œä½†å¯¹å¤šè¾¹å½¢æ¥è¯´ï¼Œå®ƒå°±å¾ˆæœ‰ç”¨äº†ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œæƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬åœ¨ç”»ä¸€ä¸ªå…­è¾¹å½¢ï¼Œæˆ‘ä»¬éœ€è¦å…­ä¸ªé¡¶ç‚¹ã€‚ä½†ç”±äºåœ¨æ¸²æŸ“æ—¶æˆ‘ä»¬ä¸»è¦ç»˜åˆ¶ä¸‰è§’å½¢ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠå…­è¾¹å½¢æ‹†åˆ†æˆå¤šä¸ªä¸‰è§’å½¢ï¼Œè€Œæ‹†åˆ†å‡ºçš„æ¯ä¸ªä¸‰è§’å½¢å°±å¯¹åº”ç€ ind é‡Œçš„ä¸€ä¸ªå…ƒç´ äº†ã€‚</p><p>å¯¹å…­è¾¹å½¢æ¥è¯´ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå®šä¹‰ä¸‹é¢è¿™æ ·çš„ pos å’Œ ind</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Eigen<span class="token double-colon punctuation">::</span>Vector3f<span class="token operator">></span> pos<span class="token punctuation">&#123;</span>    <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token comment">// 0: å³</span>    <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1.732</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// 1: å³ä¸Š</span>    <span class="token punctuation">&#123;</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1.732</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token comment">// 2: å·¦ä¸Š</span>    <span class="token punctuation">&#123;</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>     <span class="token comment">// 3: å·¦</span>    <span class="token punctuation">&#123;</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.732</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token comment">// 4: å·¦ä¸‹</span>    <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.732</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">&#125;</span>  <span class="token comment">// 5: å³ä¸‹</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Eigen<span class="token double-colon punctuation">::</span>Vector3i<span class="token operator">></span> ind<span class="token punctuation">&#123;</span>    <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="id-çš„ä½œç”¨"><a href="#id-çš„ä½œç”¨" class="headerlink" title="id çš„ä½œç”¨"></a>id çš„ä½œç”¨</h2><p>ç»§ç»­çœ‹å‘ main.cpp çš„ main å‡½æ•°ï¼ŒæŠŠç›®å…‰æŠ•å‘è¿™æ®µä»£ç </p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">auto</span> pos_id <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">load_positions</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">auto</span> ind_id <span class="token operator">=</span> r<span class="token punctuation">.</span><span class="token function">load_indices</span><span class="token punctuation">(</span>ind<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ...</span>r<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>pos_id<span class="token punctuation">,</span> ind_id<span class="token punctuation">,</span> rst<span class="token double-colon punctuation">::</span>Primitive<span class="token double-colon punctuation">::</span>Triangle<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠ id ä¼ å…¥äº† draw å‡½æ•°æ¥ç”»å›¾ã€‚ä½†ä¸ºä»€ä¹ˆè¦ç”¨ id å‘¢ï¼Ÿç›´æ¥ &amp; ä¼ å‚ä¸è¡Œå—ï¼Ÿ</p><p>ã€TODOï¼šæˆ‘ä¸çŸ¥é“ã€‚AIè¯´åœ¨æ­£å¼çš„æ¸²æŸ“ä»£ç é‡Œï¼Œæˆ‘ä»¬ä¼šåœ¨loadæ—¶åšä¸€äº›æ“ä½œè¯¸å¦‚æŠŠæ•°æ®ä¸Šä¼ åˆ°æ˜¾å­˜ï¼Œæˆ–è€…é‡æ–°ç»„ç»‡ä¸Šä¼ çš„å„ä¸ªæ•°æ®æ¥æé«˜æ•ˆç‡ï¼Œä½†å’±ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯çœŸçš„ã€‚ã€‘</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ¬æ¬¡ä½œä¸šè¦æ±‚æˆ‘ä»¬å®ç°æ—‹è½¬çŸ©é˜µã€æŠ•å½±çŸ©é˜µã€‚æˆ‘ä»¬å…ˆç®€å•çœ‹ä¸‹ä½œä¸šæ˜¯æ€ä¹ˆåšçš„ï¼Œå†çœ‹çœ‹ä»£ç æ¡†æ¶é‡Œçš„å‡ ä¸ªæœ‰è¶£çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;h1 id=&quot;ä½œä¸šå®ç°&quot;&gt;&lt;a href=&quot;#ä½œä¸šå®ç°&quot; class=&quot;headerlink&quot; title=&quot;ä½œä¸šå®ç°&quot;&gt;&lt;/a&gt;ä½œä¸šå®ç°&lt;/h1&gt;&lt;h2 i</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="GAMES101" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/GAMES101/"/>
    
    <category term="Hw" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/GAMES101/Hw/"/>
    
    
  </entry>
  
  <entry>
    <title>Note 1 Transformation</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/GAMES101/Notes/Note1-transformation/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/GAMES101/Notes/Note1-transformation/</id>
    <published>2025-08-19T07:10:28.000Z</published>
    <updated>2025-08-22T01:20:58.030Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2D-Transformation"><a href="#2D-Transformation" class="headerlink" title="2D Transformation"></a>2D Transformation</h1><p>åœ¨äºŒç»´ç©ºé—´ä¸­ï¼Œæˆ‘ä»¬èƒ½ç”¨äºŒç»´çŸ©é˜µè¡¨ç¤ºæ‰€æœ‰çš„çº¿æ€§å˜æ¢ã€‚ä½†äºŒç»´ç©ºé—´ä¸­çš„å¹³ç§»åœ¨äºŒç»´ç©ºé—´ä¸­ä¸æ˜¯çº¿æ€§å˜æ¢ï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°å¦ä¸€ä¸ªç©ºé—´ï¼Œå¹¶å°†äºŒç»´ç©ºé—´åµŒå…¥ï¼Œè®©äºŒç»´å¹³ç§»åœ¨è¿™ä¸ªç©ºé—´ä¸­å˜ä¸ºçº¿æ€§å˜æ¢ã€‚æŠŠç¬›å¡å°”åæ ‡æ‰©å±•ä¸ºé½æ¬¡åæ ‡ï¼Œå°±å¾—åˆ°äº†è¿™æ ·çš„ç©ºé—´ã€‚</p><p>å¯¹äºŒç»´ç©ºé—´çš„ä¸€ç‚¹ $(x,y)$ï¼Œä¸‰å…ƒç»„ $(xZ,yZ,Z)$ å³ä¸ºè¯¥ç‚¹çš„é½æ¬¡åæ ‡ã€‚å¦‚ $(1,2)$ å¯è¡¨ç¤ºä¸º $(1,2,1)$ æˆ– $(100,200,100)$. æ¢å¥è¯è¯´ï¼ŒäºŒç»´ç©ºé—´çš„ä»»ä½•ç‚¹éƒ½èƒ½è¡¨ç¤ºä¸ºé½æ¬¡åæ ‡ $(X,Y,Z)$ï¼Œå…¶ä¸­ $Z\neq 0$.</p><p>å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæ— ç©·è¿œç‚¹ä¹Ÿè€ƒè™‘è¿›æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ $(x,y,0)$ è¡¨ç¤ºæ— ç©·è¿œç‚¹ã€‚</p><p>å½é‡Œå’•å™œè¯´ä»€ä¹ˆå‘¢ï¼Œå¿«å‘Šè¯‰æˆ‘æ€ä¹ˆç”¨çº¿æ€§å˜æ¢è¡¨ç¤ºå¹³ç§»ï¼</p><p>å¯¹äºŒç»´ç©ºé—´çš„ä¸€ç‚¹ $(x,y)$ï¼Œé¦–å…ˆå°†å®ƒè½¬åŒ–ä¸ºé½æ¬¡åæ ‡å¾—åˆ° $(x,y,1)$ï¼Œç„¶åä¸ä¸‹é¢çš„çŸ©é˜µç›¸ä¹˜</p><script type="math/tex; mode=display">M = \begin{bmatrix}1 & 0 & t_x \\0 & 1 & t_y \\0 & 0 & 1\end{bmatrix}</script><p>å°±å¾—åˆ°äº† $(x+t_x,y+t_y,1)$. ç„¶åå†è½¬æ¢å›ç¬›å¡å°”åæ ‡ï¼Œå°±å¾—åˆ°äº† $(x+t_x,y+t_y)$.</p><p>è¿™æ ·ä¸€æ¥ï¼Œæ—‹è½¬ã€å¹³ç§»å°±èƒ½ç»Ÿä¸€æˆä¸‹é¢çš„å½¢å¼ï¼š</p><script type="math/tex; mode=display">M = \begin{bmatrix}\cos \theta & -\sin \theta & t_x \\\sin \theta & \cos \theta & t_y \\0 & 0 & 1\end{bmatrix}</script><h1 id="3D-Transformation"><a href="#3D-Transformation" class="headerlink" title="3D Transformation"></a>3D Transformation</h1><p>ä¸äºŒç»´çš„æƒ…å†µç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹ŸæŠŠä¸‰ç»´ç©ºé—´åµŒå…¥ä¸€ä¸ªæ–°ç©ºé—´ã€‚</p><p>å¯¹ä¸‰ç»´ç©ºé—´çš„ä¸€ç‚¹ $(x,y,z)$ï¼Œä¸‰å…ƒç»„ $(xS,yS,zS,S)$ å³ä¸ºè¯¥ç‚¹çš„é½æ¬¡åæ ‡ã€‚å¦‚ $(1,2,3)$ å¯è¡¨ç¤ºä¸º $(1,2,3,1)$ æˆ– $(100,200,300,100)$. æ¢å¥è¯è¯´ï¼Œä¸‰ç»´ç©ºé—´çš„ä»»ä½•ç‚¹éƒ½èƒ½è¡¨ç¤ºä¸ºé½æ¬¡åæ ‡ $(X,Y,Z,S)$ï¼Œå…¶ä¸­ $S\neq 0$.</p><p>æˆ‘ä»¬è¿™é‡Œè®¨è®ºå³æ‰‹åæ ‡ç³»ï¼Œä¸‹é¢ç»™å‡ºæŒ‰å³æ‰‹å®šåˆ™æ—‹è½¬ $\theta$ è§’åº¦çš„çŸ©é˜µï¼š</p><script type="math/tex; mode=display">R_x(\theta) = \begin{bmatrix} 1 & 0 & 0 & 0 \\ 0 & \cos \theta & -\sin \theta & 0 \\ 0 & \sin \theta & \cos \theta & 0 \\ 0 & 0 & 0 & 1 \end{bmatrix}</script><script type="math/tex; mode=display">R_y(\theta) = \begin{bmatrix} \cos \theta & 0 & \sin \theta & 0 \\ 0 & 1 & 0 & 0 \\ -\sin \theta & 0 & \cos \theta & 0 \\ 0 & 0 & 0 & 1 \end{bmatrix}</script><script type="math/tex; mode=display">R_z(\theta) = \begin{bmatrix} \cos \theta & -\sin \theta & 0 & 0 \\ \sin \theta & \cos \theta & 0 & 0 \\ 0 & 0 & 1 & 0 \\ 0 & 0 & 0 & 1 \end{bmatrix}</script><p>ä½ ä¼šæ³¨æ„åˆ°æ²¿ $y$ è½´æ—‹è½¬çš„çŸ©é˜µå’Œåˆ«çš„ä¸ä¸€æ ·ï¼Œä½†è¿™æ˜¯å®Œå…¨æ­£ç¡®çš„ï¼Œè®¤çœŸç®—ä¸€ç®—å°±å¥½äº†ã€‚</p><p>ï¼ˆæˆ‘æ²¡æ„Ÿè§‰è¿™é‡Œæœ‰ä»€ä¹ˆâ€œæ·±åˆ»å«ä¹‰â€ï¼Œä½†æ„Ÿè§‰å³ä½¿æœ‰ä¹Ÿåº”è¯¥ä¸ä¼šå¾ˆæœ‰ç”¨â€¦â€¦ï¼‰</p><p>ï¼ˆä¸è¿‡ä¸çŸ¥é“å¦‚æœæ¨å¹¿åˆ° $n$ ç»´æ—‹è½¬ä¼šä¸ä¼šæœ‰ç”¨ï¼‰</p><p>ï¼ˆå¯æˆ‘ä»¬ç”Ÿæ´»åœ¨ä¸‰æ¬¡å…ƒï¼ï¼‰</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>æ—‹è½¬çŸ©é˜µéƒ½æ˜¯æ­£äº¤çŸ©é˜µ</strong>ï¼Œæ‰€ä»¥å®ƒçš„è½¬ç½®å°±æ˜¯å®ƒçš„é€†ã€‚</p><p>ä¸–ç•Œä¸Šè¿˜å­˜åœ¨ä¸€ä¸ªå«åš <strong>Rodrigues æ—‹è½¬å…¬å¼</strong>çš„ä¸œè¥¿ï¼Œå®ƒç»™å‡ºäº†å‘é‡ $v$ ç»•å•ä½å‘é‡ $k$ æ—‹è½¬ $\theta$ è§’åº¦å¾—åˆ°çš„ç»“æœã€‚ï¼ˆæŒ‰å³æ‰‹å®šåˆ™æ—‹è½¬ï¼‰</p><script type="math/tex; mode=display">\mathbf{v}_{\text{rot}} = \mathbf{v} \cos\theta + (\mathbf{k} \times \mathbf{v}) \sin\theta + \\\mathbf{k}(\mathbf{k} \cdot \mathbf{v})(1 - \cos\theta)</script><p><img src="/images/learning/open-course/GAMES101/Notes/note1/rodrigues.png" alt=""></p><p>å½“ç„¶ä¹Ÿå¯ä»¥æŠŠè¿™ä¸ªæ—‹è½¬çŸ©é˜µå†™å‡ºæ¥ï¼š</p><script type="math/tex; mode=display">\mathbf{R}(\mathbf{k}, \theta) = \cos(\theta)\mathbf{I} + (1 - \cos(\theta))\mathbf{k}\mathbf{k}^T + \sin(\theta)\begin{bmatrix} 0 & -k_z & k_y \\ k_z & 0 & -k_x \\ -k_y & k_x & 0 \end{bmatrix}</script><p>æœ€å³è¾¹é‚£ä¸ªçŸ©é˜µæ˜¯ $k$ çš„å‰ä¹˜çŸ©é˜µå•¦~</p><h1 id="Viewing-transformation"><a href="#Viewing-transformation" class="headerlink" title="Viewing transformation"></a>Viewing transformation</h1><p>2D å’Œ 3D transformation éƒ½æ˜¯åŸºç¡€å˜æ¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç ”ç©¶æ¸¸æˆé‡Œçš„ç”»é¢æ˜¯å¦‚ä½•æ¸²æŸ“åˆ°å±å¹•ä¸Šçš„ã€‚</p><p><img src="/images/learning/open-course/GAMES101/Notes/note1/map-seq.png" alt=""></p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ‘„åƒæœºã€ä¸¤ä¸ªæ–¹å—ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯æ€ä¹ˆè®¡ç®—å‡ºæ‘„åƒæœºæ‹æ‘„çš„ç”»é¢çš„å‘¢ï¼ˆå‚è€ƒå³ä¸‹è§’ï¼‰ï¼Ÿ</p><p><img src="/images/learning/open-course/GAMES101/Notes/note1/godot-camera.png" alt=""></p><p>æˆ‘ä»¬æŒ‰ç…§ä¸‹é¢çš„æµç¨‹è¿›è¡Œæ“ä½œï¼š</p><h2 id="Camera-transformation"><a href="#Camera-transformation" class="headerlink" title="Camera transformation"></a>Camera transformation</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å˜æ¢ç©ºé—´è®©æ‘„åƒæœºä½äºåæ ‡åŸç‚¹ï¼Œä¸”é¢å‘ $z$ è½´è´Ÿæ–¹å‘ï¼Œå¤´é¡¶æœ $y$ è½´æ­£æ–¹å‘ã€‚å¯¹ä¸Šå›¾æ¥è¯´ï¼Œå°±æ˜¯æŠŠ $w$ å˜æ¢ä¸º $z$ è½´ï¼ŒæŠŠ $v$ å˜æ¢ä¸º $y$ è½´ã€‚</p><p>å¯¹åº”çš„çŸ©é˜µæ˜¯</p><script type="math/tex; mode=display">\text{M}_{\text{cam}} =\begin{bmatrix}u_x & u_y & u_z & 0 \\v_x & v_y & v_z & 0 \\w_x & w_y & w_z & 0 \\0 & 0 & 0 & 1\end{bmatrix}\times\begin{bmatrix}1 & 0 & 0 & -\text{cam}_x \\0 & 1 & 0 & -\text{cam}_y \\0 & 0 & 1 & -\text{cam}_z \\0 & 0 & 0 & 1\end{bmatrix}</script><p>è¿™é‡Œçš„å°æŠ€å·§æ˜¯ï¼Œæ—‹è½¬çŸ©é˜µçš„é€†æ˜¯å…¶è½¬ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆç®—å‡º $xyz$ è½´å˜æ¢åˆ° $uvw$ è½´çš„æ—‹è½¬çŸ©é˜µï¼Œå†å¯¹å…¶è½¬ç½®ï¼Œå°±å¾—åˆ°äº†æŠŠ $uvw$ å˜æ¢åˆ° $xyz$ çš„çŸ©é˜µã€‚</p><h2 id="Projection-transformation"><a href="#Projection-transformation" class="headerlink" title="Projection transformation"></a>Projection transformation</h2><p>ç„¶åï¼Œæˆ‘ä»¬æŠŠç›¸æœºæ‹æ‘„çš„åŒºåŸŸå˜æ¢åˆ° $[-1,1]^3$ ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªè§„èŒƒåŒ–ï¼Œä¸ºæœªæ¥æŠŠåŒºåŸŸæ”¾åˆ°å±å¹•ä¸Šåšå‡†å¤‡ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å…ˆç¡®å®šç›¸æœºèƒ½å¤Ÿæ‹æ‘„çš„åŒºåŸŸçš„èŒƒå›´ã€‚è¿™é‡Œæ¶‰åŠåˆ°çš„å˜é‡ä¸»è¦æœ‰ fovã€aspect ratioã€nearã€far. </p><p>ä¸‹å›¾èƒ½æ¸…æ™°åœ°è§£é‡Š fov å’Œ aspect ratioã€‚fov å³ field of viewï¼Œè¡¨ç¤ºç”¨è§’åº¦è¡¡é‡çš„å¯è§èŒƒå›´ï¼›aspect ratio åˆ™æ˜¯æ˜¾ç¤ºåŒºåŸŸçš„å®½é«˜æ¯”ã€‚</p><p><img src="/images/learning/open-course/GAMES101/Notes/note1/fov-and-aspect-ratio.png" alt=""></p><p>near å’Œ far åˆ™å®šä¹‰äº†å‰”é™¤è¾¹ç•Œï¼Œæˆ‘ä»¬åªæ¸²æŸ“æ»¡è¶³ $z \in [\text{near}, \text{far}]$ çš„ä¸œè¥¿ã€‚åŸç‚¹ã€è¿‘å¹³é¢å’ŒåŸå¹³é¢å…±åŒåˆ’åˆ†å‡ºäº†ä¸€å—æœ‰é™çš„ç©ºé—´ï¼Œè¿™å°±æ˜¯æ‘„åƒæœºæ‹æ‘„çš„åŒºåŸŸï¼ˆè§†é”¥ï¼‰ï¼Œæˆ‘ä»¬ä¼šæŠŠä»–å˜æ¢åˆ° $[-1,1]^3$ ä¸­ã€‚</p><p><img src="/images/learning/open-course/GAMES101/Notes/note1/near-far.png" alt=""></p><p>å˜æ¢åˆ†ä¸ºä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯æŠŠè§†é”¥å˜æ¢ä¸ºé•¿æ–¹ä½“ï¼Œç¬¬äºŒæ­¥æŠŠé•¿æ–¹ä½“å˜æ¢ä¸º $[-1,1]^3$ çš„æ­£æ–¹ä½“ã€‚</p><p>åœ¨ç¬¬ä¸€æ­¥å˜æ¢æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›æ»¡è¶³ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ol><li>near å’Œ far å¹³é¢ä¸Šçš„ç‚¹çš„ $z$ å€¼ä¸å˜</li><li>è¿‘å¤§è¿œå°ï¼Œä¸”ç¼©æ”¾æ¯”ä¾‹ç¬¦åˆç›¸ä¼¼ä¸‰è§’å½¢çš„è§„å¾‹</li></ol><p>ç»“åˆé½æ¬¡åæ ‡ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°ä»¥ä¸‹çŸ©é˜µï¼š</p><script type="math/tex; mode=display">\begin{align*}\text{M}_\text{per}&=\begin{bmatrix}\frac{2}{r-l} & 0 & 0 & -\frac{r+l}{r-l} \\0 & \frac{2}{t-b} & 0 & -\frac{t+b}{t-b} \\0 & 0 & \frac{2}{n-f} & -\frac{n+f}{n-f} \\0 & 0 & 0 & 1\end{bmatrix}\times\begin{bmatrix}n & 0 & 0 & 0 \\0 & n & 0 & 0 \\0 & 0 & n+f & -nf \\0 & 0 & 1 & 0\end{bmatrix}\\&=\begin{bmatrix}\frac{2n}{r-l} & 0 & -\frac{r+l}{r-l} & 0 \\0 & \frac{2n}{t-b} & -\frac{t+b}{t-b} & 0 \\0 & 0 & \frac{n+f}{n-f} & -\frac{2nf}{n-f} \\0 & 0 & 1 & 0\end{bmatrix}\end{align*}</script><p>ç¬¬ä¸€ä¸ªç­‰å·å³è¾¹çš„å¼å­ä¸­ï¼Œå³è¾¹çš„çŸ©é˜µæŠŠè§†é”¥å‹ç¼©ä¸ºä¸€ä¸ªé•¿æ–¹ä½“ï¼Œå·¦è¾¹çš„çŸ©é˜µæŠŠè¿™ä¸ªé•¿æ–¹ä½“å˜æ¢åˆ° $[-1,1]^3$.</p><p><img src="/images/learning/open-course/GAMES101/Notes/note1/rectangle.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥æ ¹æ® $\text{near},\text{fov},\text{aspectRatio<br>}$ æ±‚å‡º $l,t,r,b$.</p><script type="math/tex; mode=display">\begin{align*}&\text{t} = -n \times \tan\left(\frac{\text{fov}}{2}\right)\\&\text{b} = -\text{t}\\&\text{r} = \text{t} \times \text{aspectRatio}\\&\text{l} = -\text{r}\end{align*}</script><p><img src="/images/learning/open-course/GAMES101/Notes/note1/fov-ltrb.png" alt=""></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæŠ•å½±çŸ©é˜µå†™ä¸ºï¼š</p><script type="math/tex; mode=display">\large\text{M}_\text{per} =\begin{bmatrix}-\frac{1}{\text{aspect} \times \tan(\frac{\text{fov}}{2})} & 0 & 0 & 0 \\0 & -\frac{1}{\tan(\frac{\text{fov}}{2})} & 0 & 0 \\0 & 0 & \frac{n+f}{n-f} & -\frac{2nf}{n-f} \\0 & 0 & 1 & 0\end{bmatrix}</script><h2 id="Viewport-transformation"><a href="#Viewport-transformation" class="headerlink" title="Viewport transformation"></a>Viewport transformation</h2><p>æœ€åï¼Œæˆ‘ä»¬ä¼šæŠŠ $[-1,1]^3$ çš„å†…å®¹çš„å®½é«˜æ˜ å°„ä¸ºå±å¹•å¤§å°ã€‚åœ¨è¿™ä¸ªå˜æ¢ä¸­ $z$ åæ ‡ä¸å˜ï¼Œå› æ­¤å˜æ¢çŸ©é˜µä¸ºï¼š</p><script type="math/tex; mode=display">\large\text{M}_\text{viewport}=\begin{bmatrix}\frac{width}{2} & 0 & 0 & \frac{width}{2} \\0 & \frac{height}{2} & 0 & \frac{height}{2} \\0 & 0 & 1 & 0 \\0 & 0 & 0 & 1\end{bmatrix}</script><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘ä»¬çš„å˜æ¢çŸ©é˜µä¸º</p><script type="math/tex; mode=display">\begin{align*}&\text{M}=\text{M}_\text{viewport}\text{M}_\text{per}\text{M}_\text{cam}\end{align*}</script><p>å…¶ä¸­</p><script type="math/tex; mode=display">\begin{align*}&\text{M}_{\text{cam}} =\begin{bmatrix}u_x & u_y & u_z & 0 \\v_x & v_y & v_z & 0 \\w_x & w_y & w_z & 0 \\0 & 0 & 0 & 1\end{bmatrix}\times\begin{bmatrix}1 & 0 & 0 & -\text{cam}_x \\0 & 1 & 0 & -\text{cam}_y \\0 & 0 & 1 & -\text{cam}_z \\0 & 0 & 0 & 1\end{bmatrix}\\\large&\text{M}_\text{per} =\begin{bmatrix}-\frac{1}{\text{aspect} \times \tan(\frac{\text{fov}}{2})} & 0 & 0 & 0 \\0 & -\frac{1}{\tan(\frac{\text{fov}}{2})} & 0 & 0 \\0 & 0 & \frac{n+f}{n-f} & -\frac{2nf}{n-f} \\0 & 0 & 1 & 0\end{bmatrix}\\&\large\text{M}_\text{viewport}=\begin{bmatrix}\frac{width}{2} & 0 & 0 & \frac{width}{2} \\0 & \frac{height}{2} & 0 & \frac{height}{2} \\0 & 0 & 1 & 0 \\0 & 0 & 0 & 1\end{bmatrix}\end{align*}</script><p>è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬è®¨è®ºçš„ $n$ å’Œ $f$ è¢«å®šä¹‰ä¸ºåæ ‡å€¼ï¼Œå®ƒä»¬æ˜¯å°äº 0 çš„ã€‚ä¸€äº›åœ°æ–¹æŠŠ $n$ å’Œ $f$ å®šä¹‰ä¸ºåˆ°è¿‘/è¿œå¹³é¢çš„è·ç¦»ï¼Œè¿™æ˜¯å¤§äº 0 çš„ï¼Œè¿™ä¼šå¼•èµ·æŠ•å½±çŸ©é˜µçš„å˜åŒ–ã€‚å¦å¤–ï¼Œä¸åŒçš„åæ ‡ç³»çº¦å®šä¹Ÿä¼šå¼•èµ·çŸ©é˜µçš„å˜åŒ–ã€‚</p><p>æ¯”å¦‚åœ¨OpenGLä¸­ï¼Œ $n$ å’Œ $f$ è¢«å®šä¹‰ä¸ºåˆ°è¿‘/è¿œå¹³é¢çš„è·ç¦»ï¼Œè¿™æ˜¯å¤§äº 0 çš„ï¼Œè€Œä¸”ä»–ä»¬çš„ projection transformation æŠŠæ‹æ‘„å†…å®¹ä»å³æ‰‹åæ ‡ç³»çš„è§†å›¾ç©ºé—´æ˜ å°„åˆ°å·¦æ‰‹åæ ‡ç³»çš„æ ‡å‡†è®¾å¤‡åæ ‡ï¼ˆNDCï¼‰ç©ºé—´ã€‚ç‰¹åˆ«åœ°ï¼Œ$z$ è½´çš„ $[ -n,-f]$ è¢«æ˜ å°„åˆ° $[-1,1]$ ï¼ˆè¿™ä¼¼ä¹è¯´æ˜åœ¨ NDC ç©ºé—´ä¸­ï¼Œ$z$ å€¼è¾ƒå°çš„å†…å®¹æ¸²æŸ“æ›´é å‰ï¼Ÿï¼‰</p><p>ä»–ä»¬çš„ $\text{M}_\text{their-per}$ ä¸ºï¼š</p><script type="math/tex; mode=display">\large\text{M}_\text{their-per} =\begin{bmatrix}\frac{1}{\text{aspect} \times \tan(\frac{\text{fov}}{2})} & 0 & 0 & 0 \\0 & \frac{1}{\tan(\frac{\text{fov}}{2})} & 0 & 0 \\0 & 0 & -\frac{f+n}{f-n} & -\frac{2fn}{f-n} \\0 & 0 & -1 & 0\end{bmatrix}</script><p>Godot ä½¿ç”¨å’Œ OpenGL ä¸€æ ·çš„çŸ©é˜µï¼Œä¸‹é¢æ˜¯ä»–ä»¬è®¾ç½® $\text{M}_\text{per}$ çš„ä»£ç ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œä»–ä»¬ä½¿ç”¨ column-major çš„æ–¹æ³•å­˜å‚¨æ•°æ®ï¼Œå³</p><script type="math/tex; mode=display">M =\begin{pmatrix}\text{columns}[0][0] & \text{columns}[1][0] \\\text{columns}[0][1] & \text{columns}[1][1]\end{pmatrix}</script><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token class-name">Projection</span><span class="token double-colon punctuation">::</span><span class="token function">set_perspective</span><span class="token punctuation">(</span>real_t p_fovy_degrees<span class="token punctuation">,</span> real_t p_aspect<span class="token punctuation">,</span> real_t p_z_near<span class="token punctuation">,</span> real_t p_z_far<span class="token punctuation">,</span> <span class="token keyword">bool</span> p_flip_fov<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>p_flip_fov<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>p_fovy_degrees <span class="token operator">=</span> <span class="token function">get_fovy</span><span class="token punctuation">(</span>p_fovy_degrees<span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token operator">/</span> p_aspect<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>real_t sine<span class="token punctuation">,</span> cotangent<span class="token punctuation">,</span> deltaZ<span class="token punctuation">;</span>real_t radians <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token double-colon punctuation">::</span><span class="token function">deg_to_rad</span><span class="token punctuation">(</span>p_fovy_degrees <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>deltaZ <span class="token operator">=</span> p_z_far <span class="token operator">-</span> p_z_near<span class="token punctuation">;</span>sine <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token double-colon punctuation">::</span><span class="token function">sin</span><span class="token punctuation">(</span>radians<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>deltaZ <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>sine <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>p_aspect <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>cotangent <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token double-colon punctuation">::</span><span class="token function">cos</span><span class="token punctuation">(</span>radians<span class="token punctuation">)</span> <span class="token operator">/</span> sine<span class="token punctuation">;</span><span class="token function">set_identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>columns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> cotangent <span class="token operator">/</span> p_aspect<span class="token punctuation">;</span>columns<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> cotangent<span class="token punctuation">;</span>columns<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>p_z_far <span class="token operator">+</span> p_z_near<span class="token punctuation">)</span> <span class="token operator">/</span> deltaZ<span class="token punctuation">;</span>columns<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>columns<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> p_z_near <span class="token operator">*</span> p_z_far <span class="token operator">/</span> deltaZ<span class="token punctuation">;</span>columns<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;2D-Transformation&quot;&gt;&lt;a href=&quot;#2D-Transformation&quot; class=&quot;headerlink&quot; title=&quot;2D Transformation&quot;&gt;&lt;/a&gt;2D Transformation&lt;/h1&gt;&lt;p&gt;åœ¨äºŒç»´ç©ºé—´ä¸­ï¼Œæˆ‘ä»¬èƒ½</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="GAMES101" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/GAMES101/"/>
    
    <category term="Notes" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/GAMES101/Notes/"/>
    
    
  </entry>
  
  <entry>
    <title>ä¸»é¢˜å‘¨æ˜¯ä»€ä¹ˆï¼Ÿ</title>
    <link href="http://rinevard.github.io/wiki/learning/theme-week/%E4%B8%BB%E9%A2%98%E5%91%A8%E6%98%AF%E4%BB%80%E4%B9%88/"/>
    <id>http://rinevard.github.io/wiki/learning/theme-week/%E4%B8%BB%E9%A2%98%E5%91%A8%E6%98%AF%E4%BB%80%E4%B9%88/</id>
    <published>2025-07-21T06:28:38.000Z</published>
    <updated>2025-07-21T06:37:17.017Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘æƒ³æå‡è‡ªå·±çš„æ¸¸æˆå¼€å‘æŠ€èƒ½ï¼Œäºæ˜¯æƒ³å‡ºäº†è¿™ä¸ªä¸»é¢˜å‘¨æ¨¡å¼ï¼Œå°±æ˜¯æ¯å‘¨é€‰ä¸€ä¸ªä¸»é¢˜ç„¶åå»å­¦ç›¸å…³çš„ä¸œè¥¿ï¼Œç„¶åè‡³å°‘è¾¾åˆ°ä¸€ä¸ªèƒ½ç”¨åœ¨gamejamä¸Šçš„æ°´å¹³ã€‚ä¸å¾—ä¸è¯´è¿™ä¸ªæ¨¡å¼è¿˜æ˜¯éå¸¸é€‚åˆæˆ‘çš„ï¼Œæ¯•ç«Ÿæˆ‘æ¯”è¾ƒå–œæ¬¢å­¦å…¬å¼€è¯¾ï¼Œè€Œä¸»é¢˜å‘¨å’Œå…¬å¼€è¯¾æœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä¸è¿‡è¦è‡ªå·±ä¸ºæ‰“é€ æ¯å‘¨çš„ä¸»é¢˜ã€è¯¾ç¨‹ã€ä½œä¸šã€‚</p><p>åšä¸»åšä¸»ï¼Œä½ ç°åœ¨å®šäº†å“ªäº›ä¸»é¢˜å‘¢ï¼Ÿç°åœ¨æœ‰å…‰ç…§ã€éª¨éª¼åŠ¨ç”»ã€è‚‰é¸½çš„éšæœºåœ°å›¾ã€è‡ªèµ°æ£‹æ–—è›è›ã€viewportæœºåˆ¶ã€‚è®©æˆ‘ä»¬æ…¢æ…¢å­¦ï¼Œå¸Œæœ›åœ¨èƒ½åœ¨ä»¥åçš„gamejamä¸Šç”¨ä¸Šä»–ä»¬ï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€è¿‘æƒ³æå‡è‡ªå·±çš„æ¸¸æˆå¼€å‘æŠ€èƒ½ï¼Œäºæ˜¯æƒ³å‡ºäº†è¿™ä¸ªä¸»é¢˜å‘¨æ¨¡å¼ï¼Œå°±æ˜¯æ¯å‘¨é€‰ä¸€ä¸ªä¸»é¢˜ç„¶åå»å­¦ç›¸å…³çš„ä¸œè¥¿ï¼Œç„¶åè‡³å°‘è¾¾åˆ°ä¸€ä¸ªèƒ½ç”¨åœ¨gamejamä¸Šçš„æ°´å¹³ã€‚ä¸å¾—ä¸è¯´è¿™ä¸ªæ¨¡å¼è¿˜æ˜¯éå¸¸é€‚åˆæˆ‘çš„ï¼Œæ¯•ç«Ÿæˆ‘æ¯”è¾ƒå–œæ¬¢å­¦å…¬å¼€è¯¾ï¼Œè€Œä¸»é¢˜å‘¨å’Œå…¬å¼€è¯¾æœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä¸è¿‡è¦è‡ªå·±ä¸ºæ‰“é€ æ¯å‘¨çš„ä¸»é¢˜ã€è¯¾ç¨‹ã€ä½œä¸šã€‚&lt;/</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="ä¸»é¢˜å‘¨" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E4%B8%BB%E9%A2%98%E5%91%A8/"/>
    
    
  </entry>
  
  <entry>
    <title>Godotå…‰ç…§åŸºç¡€</title>
    <link href="http://rinevard.github.io/wiki/learning/theme-week/lighting/godot-lighting-basic/"/>
    <id>http://rinevard.github.io/wiki/learning/theme-week/lighting/godot-lighting-basic/</id>
    <published>2025-07-21T06:28:38.000Z</published>
    <updated>2025-07-21T06:39:19.850Z</updated>
    
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="ä¸»é¢˜å‘¨" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E4%B8%BB%E9%A2%98%E5%91%A8/"/>
    
    <category term="å…‰ç…§" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E4%B8%BB%E9%A2%98%E5%91%A8/%E5%85%89%E7%85%A7/"/>
    
    
  </entry>
  
  <entry>
    <title>æ€æˆ®å°–å¡”çš„æ¡†æ¶å¦‚æ­¤è‡ªæ´½ï¼Œæˆ‘ä»¬èƒ½ç¦»å¼€å®ƒå—ï¼Ÿ</title>
    <link href="http://rinevard.github.io/wiki/game-design/%E6%9D%80%E6%88%AE%E5%B0%96%E5%A1%94%E6%A1%86%E6%9E%B6/"/>
    <id>http://rinevard.github.io/wiki/game-design/%E6%9D%80%E6%88%AE%E5%B0%96%E5%A1%94%E6%A1%86%E6%9E%B6/</id>
    <published>2025-07-10T12:22:38.000Z</published>
    <updated>2025-08-20T11:13:48.877Z</updated>
    
    <content type="html"><![CDATA[<style>img{    width: 70%;}</style><p>æœ€è¿‘åœ¨è®¾è®¡å¡ç‰Œæ¸¸æˆï¼ˆä½ çŸ¥é“çš„ï¼Œæˆ‘ä¸€ç›´æ˜¯ç‰Œä½¬ï¼‰ï¼Œå‘ç°ä»¥å‰åšçš„ç¿»ç‰Œæ¸¸æˆåŸå‹çš„ç¿»ç‰Œç©æ³•æœ¬èº«éšæœºæ€§è¿‡å¼ºï¼Œä»è€Œæ‹“å±•ç©ºé—´è¿‡å°ï¼Œä½†â€œæ£‹ç›˜ä¸Šçš„éšä»äº¤äº’â€éå¸¸æœ‰è¶£ï¼Œäºæ˜¯å°±æ‰“ç®—ä»å®ƒå‡ºå‘å¼€å§‹è¿›ä¸€æ­¥è®¾è®¡ã€‚åˆæ­¥çš„æƒ³æ³•æ˜¯åšå¡ç‰Œè‚‰é¸½ã€‚ï¼ˆå“‡ï¼Œåˆä¸€ä¸ªå¡ç‰Œè‚‰é¸½ï¼‰</p><p><img src="/images/game-design/æ€æˆ®å°–å¡”æ¡†æ¶/reverse_prototype.png" alt=""></p><p>æˆ‘å¯¹è‚‰é¸½å¹¶æ²¡æœ‰ç‰¹åˆ«çš„å–œçˆ±ï¼Œå› ä¸ºæˆ‘ä¸€ç›´æƒ³ç€ï¼Œå¦‚æœæˆ‘ä»¬æ‹¿èµ°äº†ç©å®¶çš„æ—¶é—´ï¼Œèµ·ç è¦è¡¥å¿ä¸€äº›ä»€ä¹ˆï¼Œè€Œè‚‰é¸½ä¼¼ä¹å¹¶æ²¡æœ‰è¡¥å¿ä¸€äº›æˆ‘å¾ˆå–œæ¬¢çš„ä¸œè¥¿ã€‚ä¸è¿‡æ— è®ºå¦‚ä½•ï¼Œæˆ‘è¿˜æ˜¯æŒºå–œæ¬¢æ‰“ç‰Œçš„ï¼Œæ€æˆ®å°–å¡”ã€ç‚‰çŸ³ç‹—å¤´äººå†’é™©ã€é‚ªæ¶å†¥åˆ»éƒ½æ˜¯æˆ‘å¾ˆå–œæ¬¢çš„æ¸¸æˆï¼Œæ‰€ä»¥åšä¸ªå¡ç‰Œè‚‰é¸½ä¹Ÿè¿˜æŒºä¸é”™ã€‚æŒ‰æˆ‘çš„ç†è§£ï¼Œè‚‰é¸½æœ€é‡è¦çš„æ˜¯æ¯ä¸ªå°å…³å¡çš„ä½“éªŒï¼Œå› æ­¤æˆ‘å°±ç€æ‰‹å¼€å§‹åšæ¯å±€ç‰Œå±€çš„åŸå‹äº†ã€‚</p><p>ç„¶åè®©æˆ‘ä»¬å¼€å§‹æœ€æœ‰è¶£çš„è®¾è®¡ç¯èŠ‚ï¼</p><p>ç°åœ¨æˆ‘ä»¬é¢å‰æœ‰ä¸€ä¸ª3x5çš„ç‰Œæ¡Œï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¯¥åšä»€ä¹ˆï¼Ÿæˆ‘ä»¬å…ˆéšä¾¿æ‹¿ç‚¹æ‰‹ç‰Œå§ï¼Œå¯ä»¥æŠŠæ‰‹ç‰Œæ”¾åˆ°ç‰Œæ¡Œä¸Šæ¥å¬å”¤éšä»ï¼Œç„¶åå’Œæ•Œæ–¹éšä»æ‰“æ¶ã€‚ä½†æ‰‹ç‰Œä»å“ªé‡Œæ¥ï¼Œè´¹ç”¨æœºåˆ¶åˆæ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±å¼•å‡ºäº†æœ¬æ–‡çš„æ ¸å¿ƒå†…å®¹â€”â€”æ€æˆ®å°–å¡”çš„æ¡†æ¶å¦‚æ­¤è‡ªæ´½ï¼Œæˆ‘ä»¬èƒ½ç¦»å¼€å®ƒå—ï¼Ÿ</p><h1 id="æ€æˆ®å°–å¡”"><a href="#æ€æˆ®å°–å¡”" class="headerlink" title="æ€æˆ®å°–å¡”"></a>æ€æˆ®å°–å¡”</h1><p>æ€æˆ®å°–å¡”ä¸ºä»€ä¹ˆæ˜¯ç¥ï¼Ÿåœ¨è°ˆè®ºè¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆè¯´è¯´å…¶ä»–å¡ç‰Œæ¸¸æˆç›¸è¾ƒäºçˆ¬å¡”ç©¶ç«Ÿå·®åœ¨äº†å“ªé‡Œï¼ˆè¯¯</p><p>æ€»ä¹‹ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æ€æˆ®å°–å¡”è‡ªæ´½çš„è®¾è®¡å§ã€‚</p><p><img src="/images/game-design/æ€æˆ®å°–å¡”æ¡†æ¶/slayspire.jpg" alt=""></p><h2 id="å•å±€ç‰Œå±€çš„è‡ªæ´½"><a href="#å•å±€ç‰Œå±€çš„è‡ªæ´½" class="headerlink" title="å•å±€ç‰Œå±€çš„è‡ªæ´½"></a>å•å±€ç‰Œå±€çš„è‡ªæ´½</h2><p>æ€æˆ®å°–å¡”çš„æ‰‹ç‰Œä»å“ªé‡Œæ¥ï¼Œè´¹ç”¨æœºåˆ¶åˆæ˜¯æ€æ ·çš„ï¼Ÿåœ¨æ€æˆ®å°–å¡”ä¸­ï¼Œå¦‚æœä¸è€ƒè™‘ç‰¹æ®Šæ•ˆæœï¼Œæˆ‘ä»¬åœ¨å›åˆå¼€å§‹æ—¶ä¼šä¸¢å¼ƒæ‰€æœ‰æ‰‹ç‰Œå¹¶æŠ½äº”å¼ ç‰Œï¼Œå¹¶ä¸”è´¹ç”¨é‡ç½®ä¸ºä¸‰è´¹ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥èŠèŠå‰è€…ã€‚å‰è€…åœ¨ç©èµ·æ¥æ—¶æ„Ÿè§‰ååˆ†è‡ªç„¶ï¼Œä½†ä»è®¾è®¡çš„è§’åº¦ï¼Œå…¶å®æ˜¯ä¸€ä¸ªå¹¶ä¸æ˜¾ç„¶çš„è®¾è®¡ã€‚æˆ‘ç®€å•è°ƒç ”äº†ä¸€ä¸‹ï¼Œå‘ç°å›åˆå¼€å§‹æ—¶åˆ·æ–°æ‰‹ç‰Œä¼¼ä¹æ˜¯DBGæ¸¸æˆçš„æ ‡é…ï¼Œå…¶å¼€å±±é¼»ç¥–æ˜¯ã€Šçš‡èˆ†äº‰éœ¸ã€‹ï¼ˆDominionï¼‰ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæœ‰æ€æ ·çš„æ•ˆæœã€‚</p><p>æˆ‘è®¤ä¸ºæœ€å…³é”®çš„ä¸¤ç‚¹æ˜¯ï¼Œ<strong>å‡å°‘äº†å¡æ‰‹çš„å¯èƒ½æ€§</strong>ã€<strong>é™ä½äº†ç­–ç•¥æ€§</strong>ã€‚åˆ·æ–°æ‰‹ç‰Œæ˜¾ç„¶èƒ½å‡å°‘å¡æ‰‹ï¼Œä½†ä¸ºä»€ä¹ˆé™ä½äº†ç­–ç•¥æ€§å‘¢ï¼Œä»¥åŠè¿™æ˜¯å¥½äº‹å—ï¼Ÿ</p><p>ä¸ºä»€ä¹ˆå®ƒé™ä½äº†ç­–ç•¥æ€§ï¼Ÿå› ä¸ºæ‰‹ç‰Œçš„åˆ·æ–°å°±æ„å‘³ç€ç©å®¶å‡å°‘äº†å¯¹ä¸‹ä¸€å›åˆçš„é¢„æœŸã€‚å›åˆåˆ¶æ¸¸æˆçš„å¾ˆå¤§ä¸€éƒ¨åˆ†ç­–ç•¥æ€§æ˜¯ç”±å¯¹ä¸‹ä¸€å›åˆçš„é¢„æœŸå¼•èµ·çš„ã€‚å¯¹ç‚‰çŸ³ï¼ˆä»¥åŠå¾ˆå¤šCCGï¼‰æ¥è¯´ï¼Œæˆ‘ä¼šæ ¹æ®åœºé¢è€ƒè™‘æ¯å¼ ç‰Œä»€ä¹ˆæ—¶å€™æ‰“å‡ºæœ‰æœ€å¤§æ”¶ç›Šï¼Œç”šè‡³çŒœæµ‹å¯¹æ‰‹æ¥ä¸‹æ¥çš„è¡ŒåŠ¨å¹¶é¢„ç•™ä¸€äº›å¡ç‰Œã€‚è€Œæ€æˆ®å°–å¡”åˆ™æœç»äº†è¿™ç§é¢„æœŸï¼Œè®©ç©å®¶æ ¹æ®æ•Œäººå½“å‰å›åˆçš„æ„å›¾ï¼Œç»“åˆæ¯å›åˆå‘çš„ç‰Œæ‰“æœ€ä¼˜è§£ã€‚</p><p>æ˜¯çš„ï¼Œæœ€ä¼˜è§£ã€‚å¯¹å¾ˆå¤šå¡ç‰Œæ¸¸æˆæ¥è¯´ï¼Œæœ€ä¼˜è§£çš„è®¡ç®—é‡æ˜¯æå¤§çš„ï¼Œè€Œæ€æˆ®å°–å¡”æå¤§åœ°ç®€åŒ–äº†è¿™ä¸ªè®¡ç®—é‡ï¼Œè®©æ¯å›åˆæœ€ä¼˜è§£çš„è®¡ç®—éƒ½å¹¶ä¸å›°éš¾ï¼Œä»è€Œé™ä½äº†æ€ç»´é‡ã€‚è¿™å½“ç„¶ä¸æ˜¯åäº‹ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ç›¸å½“ä¼˜ç§€çš„è®¾è®¡ã€‚æ¸¸æˆå¹¶ä¸æ˜¯ä¸ºäº†éš¾å€’ç©å®¶è€Œå­˜åœ¨çš„ï¼Œæ¯”èµ·éš¾å€’ç©å®¶ï¼Œè®©ç©å®¶é€šè¿‡è‡ªå·±çš„åŠªåŠ›å…‹æœéš¾å…³æ›´é‡è¦ã€‚</p><p><img src="/images/game-design/æ€æˆ®å°–å¡”æ¡†æ¶/doc-pengpeng.jpg" alt=""></p><p>å¦‚æœæ‰‹ç‰Œåˆ·æ–°ï¼Œé‚£è´¹ç”¨è‡ªç„¶ä¹Ÿè¦åˆ·æ–°ï¼Œè¿™ä¾¿æ˜¯æ‰‹ç‰Œå’Œè´¹ç”¨çš„è‡ªæ´½äº†ã€‚è€Œç”±æ­¤ä¹Ÿèƒ½æ¨å‡ºæ€æˆ®å°–å¡”ä¸åšéšä»çš„ç†ç”±äº†ã€‚éšä»æ˜¯æŒç»­æ€§çš„ï¼Œè€Œæ³•æœ¯æ˜¯ä¸€æ¬¡æ€§çš„ã€‚å¦‚æœæ‰‹ç‰Œåœ¨åˆ·æ–°ï¼Œé‚£æ€ä¹ˆå’Œéšä»æ‰“comboå‘¢ï¼Ÿ</p><p>æ‰€ä»¥æˆ‘è®¤ä¸ºæ€ªç‰©ç«è½¦å¹¶ä¸å¦‚æ€æˆ®å°–å¡”è‡ªæ´½ã€‚æˆ‘è¿™å›åˆè´¹ç”¨ä¸è¶³ä»¥æ‰“å‡ºæ‰€æœ‰çš„æ²»ç–—ç‰Œï¼Œç„¶åå›åˆç»“æŸæ²»ç–—ç‰Œå°±å…¨è¢«æ‰”åˆ°å¼ƒç‰Œå †é‡Œäº†ï¼Œé‚£æˆ‘ç¼ºçš„comboè°ç»™æˆ‘è¡¥å•ŠğŸ˜­</p><p>å¦‚æœæ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä¼šè¯´æ€æˆ®å°–å¡”çš„æ¯ä¸€å±€éƒ½ç»™æˆ‘å¸¦æ¥äº†ç‚‰çŸ³é‡Œå¥¥ç§˜æ³•èˆ¬çš„ä½“éªŒï¼Œä¾é æ³•æœ¯è½°ç‚¸åˆ›æ­»å¯¹é¢ï¼Œä½†æ²¡æœ‰å¾ˆå¤šçš„åŒæ—¶ä¾é å¤šå¼ å¡ç‰Œçš„comboï¼Œ<strong>å•å±€ç‰Œå±€</strong>è¿è¥ä¸å¤šã€‚</p><h2 id="æ¯å±€æ¸¸æˆçš„è‡ªæ´½"><a href="#æ¯å±€æ¸¸æˆçš„è‡ªæ´½" class="headerlink" title="æ¯å±€æ¸¸æˆçš„è‡ªæ´½"></a>æ¯å±€æ¸¸æˆçš„è‡ªæ´½</h2><p>æ¯å±€æ¸¸æˆçš„è‡ªæ´½åˆå¯ä»¥åˆ†ä¸ºæ€ç»´é‡è¦æ±‚çš„å¼ å¼›æœ‰åº¦ï¼Œä»¥åŠæ¸¸æˆæœºåˆ¶æœ¬èº«çš„è‡ªæ´½ã€‚</p><p>å…ˆè¯´å‰è€…ã€‚å•å±€ç‰Œå±€ç­–ç•¥æ€§è¾ƒä½ï¼Œä½†ä¸€æ•´å±€æ¸¸æˆä¸­è¿è¥æ˜¯ä¸€ä¸ªç­–ç•¥æ€§å¾ˆé«˜çš„æ“ä½œï¼Œä¹Ÿå› æ­¤æ—¢ä¸ä¼šç©å¾—å¤ªç´¯ï¼Œä¹Ÿä¸ä¼šå¤ªç®€å•ã€‚</p><p>å†è¯´åè€…ã€‚ä¸»è¦è¦è¯´çš„æ˜¯â€œè¡€é‡ä¿æŒâ€çš„æœºåˆ¶ã€‚å¦‚æœå•å±€ç‰Œå±€çš„åŒæ–¹å§‹ç»ˆå¼ºåº¦æ¥è¿‘ï¼ˆæ¯”å¦‚å¯¹ç§°å¼å¡ç‰Œæ¸¸æˆï¼‰ï¼Œé‚£è¡€é‡æ˜¾ç„¶ä¹Ÿæ˜¯éœ€è¦åœ¨æ¯å±€åˆ·æ–°çš„ã€‚ä¸è¿‡å¯¹éå¯¹ç§°æ¸¸æˆæ¥è¯´ï¼Œæ§åˆ¶å¼ºåº¦æ¥è¿‘å®åœ¨æœ‰ç‚¹å›°éš¾ï¼Œè¡€é‡ä¿æŒå’Œæ¯ä¸€å¤§å±‚çš„è¡€é‡å›å¤æ˜¯ä¸€ä¸ªç®€å•çš„å¹³è¡¡æ‰‹æ®µã€‚</p><p>åŸæœ¬è¿˜æƒ³è¯´è¯´æ˜“è¿›éš¾å‡ºçš„å¡ç»„ï¼Œä½†å®åœ¨æ²¡æ„Ÿè§‰å®ƒå’Œåˆ«çš„ä¸œè¥¿å¾ˆâ€œè‡ªæ´½â€ã€‚æˆ‘å¯¹æœºåˆ¶â€œè‡ªæ´½â€çš„ç†è§£æ˜¯æŠŠè¿™ä¸ªæœºåˆ¶æ¢æˆåˆ«çš„ï¼Œæ¸¸æˆå°±å¾ˆéš¾å·¥ä½œäº†ã€‚æ¯”å¦‚æŠŠæŠ½å¡æ¢æˆæ¯å›åˆæŠ½ä¸€å¼ ï¼Œé‚£è´¹ç”¨é‡ç½®å°±ä¼šå¯¼è‡´ä¸€ä¸‹å°±æŠŠç‰Œæ‰“å®Œï¼›æŠŠè¡€é‡æ¢æˆæ¯å±€é‡ç½®ï¼Œé‚£æ¸¸æˆå°±ç®€å•ä¸€å¤§æˆªäº†ã€‚</p><p>è€Œå¡ç»„çš„æ˜“è¿›éš¾å‡ºçœ‹èµ·æ¥æ˜¯ä¸€ä¸ªæ§åˆ¶å¼ºåº¦çš„è‡ªç„¶æ‰‹æ®µï¼Œç®€å•åœ°æŠŠå®ƒæ”¹ä¸ºé™åˆ¶å¡ç»„æœ€å°‘åäº”å¼ ï¼Œå…è®¸è‡ªç”±å¢åˆ ï¼Œä¼¼ä¹ä¹Ÿä¸ä¼šç ´åæ•´ä¸ªæ¸¸æˆã€‚è™½ç„¶æ²¡æœ‰åŸæ¥å¥½ï¼Œä½†è‡³å°‘ä¸æ˜¯æ¯ç­æ€§çš„ã€‚</p><p><img src="/images/game-design/æ€æˆ®å°–å¡”æ¡†æ¶/slayspire-shop.jpg" alt=""></p><p>æœ‰è¶£çš„æ˜¯ï¼Œæ€æˆ®å°–å¡”ä¼¼ä¹å¹¶æ²¡æœ‰å¾ˆå¤šæé«˜å•å¡å¼ºåº¦çš„æ‰‹æ®µï¼Œè€Œè®¸å¤šç±»ä¼¼çš„å¡ç‰Œè‚‰é¸½ä¼šåšå¤§é‡çš„å•å¡å¼ºåº¦çš„æé«˜ã€‚æ¯”å¦‚â€”â€”é‚ªæ¶å†¥åˆ»ã€‚</p><h1 id="é‚ªæ¶å†¥åˆ»"><a href="#é‚ªæ¶å†¥åˆ»" class="headerlink" title="é‚ªæ¶å†¥åˆ»"></a>é‚ªæ¶å†¥åˆ»</h1><p>æˆ‘ä»¬èŠèŠè±è¥¿æ¨¡ç»„ï¼Œè¿™æœ€æ¥è¿‘å¡ç‰Œè‚‰é¸½ã€‚</p><h2 id="å•å±€ç‰Œå±€çš„è‡ªæ´½-1"><a href="#å•å±€ç‰Œå±€çš„è‡ªæ´½-1" class="headerlink" title="å•å±€ç‰Œå±€çš„è‡ªæ´½"></a>å•å±€ç‰Œå±€çš„è‡ªæ´½</h2><p>é‚ªæ¶å†¥åˆ»æ¯å›åˆæŠ½ä¸€å¼ ç‰Œï¼ˆå¯é€‰æŠ½ç‰Œç»„çš„ç‰Œæˆ–è€…æ¾é¼ ç‰Œï¼‰ï¼Œè´¹ç”¨ä¸è‡ªç„¶å›å¤ï¼Œè€Œæ˜¯ä¾é çŒ®ç¥­éšä»è·å¾—ã€‚å®ƒçš„åŸå‹æ¥è‡ªludum dare 43è¿™åœºgamejamï¼ŒçŒ®ç¥­æœºåˆ¶åœ¨é‚£é‡Œå°±è¢«å®šä¸‹æ¥äº†ã€‚çŒ®ç¥­æœºåˆ¶ç¡®å®éå¸¸å¥½ç©ï¼Œæ‰€ä»¥æ•´ä¸ªæ¸¸æˆéƒ½æ˜¯ä»¥å®ƒä¸ºæ ¸å¿ƒå‘å±•å‡ºå»çš„ã€‚ </p><p><img src="/images/game-design/æ€æˆ®å°–å¡”æ¡†æ¶/sacrifice-jam.png" alt=""></p><p>çŒ®ç¥­æ˜¯è´¹ç”¨æœºåˆ¶ï¼Œé‚£æŠ½ç‰Œæœºåˆ¶æ˜¯æ€ä¹ˆæ ¹æ®çŒ®ç¥­è¢«ç¡®å®šçš„å‘¢ï¼ŸæŠ½ç‰Œæ— éä¸¤ç§ï¼Œä¸€ç§æ˜¯åˆ·æ–°ï¼Œä¸€ç§æ˜¯ä¿ç•™æ‰‹ç‰Œæ¯å›åˆæŠ½å¡ã€‚çŒ®ç¥­æœºåˆ¶å¯¼è‡´é«˜è´¹ç‰Œéš¾ä»¥ç«‹å³æ‰“å‡ºï¼Œæ¯•ç«Ÿå¦‚æœæŠŠé«˜è´¹ç‰Œåˆ·æ‰ï¼Œä¸‹æ¬¡æŠ½åˆ°å°±ä¸çŸ¥é“æ˜¯ä»€ä¹ˆæ—¶å€™äº†ã€‚æ‰€ä»¥æ˜¾ç„¶ä¿ç•™æ‰‹ç‰Œæ›´åˆé€‚ã€‚</p><p>æ¯”èµ·æ€æˆ®å°–å¡”ï¼Œé‚ªæ¶å†¥åˆ»çš„å•å±€ç‰Œå±€æ›´å…·â€æŒç»­æ€§â€œï¼Œæˆ‘ä»¬ä¸ä»…èƒ½è€ƒè™‘åˆ°ä¸‹ä¸€å›åˆï¼Œè¿˜èƒ½è€ƒè™‘åˆ°ä¸‹ä¸‹å›åˆã€‚éšä»ç«™åœºã€æ‰‹ç‰Œä¸åˆ·æ–°ã€çŒ®ç¥­æœºåˆ¶éƒ½æ˜¯æŒç»­æ€§çš„ä½“ç°ã€‚</p><p>ä½†è¿æ°”æˆåˆ†å®åœ¨æ˜¯å¤ªé«˜äº†ï¼è¿‡ç‰Œçš„ç¼ºä¹å¯¼è‡´æˆ‘ä»¬æåº¦ä¾èµ–äºèµ·æ‰‹ï¼Œè´¹ç”¨ä¸è‡ªç„¶å›å¤å’Œäº”ç‚¹ä¼¤å®³å·®å°±è¾“åˆå¼ºåŒ–äº†è¿™ä¸€ç‚¹ã€‚</p><p>ä¸è¿‡è¯´åˆ°åº•ï¼Œè¿™äº›é—®é¢˜éƒ½æ˜¯å› ä¸ºæ¯å›åˆåªæŠ½ä¸€å¼ ç‰Œå¯¹å¡ç»„æ„ç­‘æå‡ºäº†æé«˜çš„è¦æ±‚ã€‚å¥½ç‰Œå¯èƒ½æ²‰åº•ï¼Œæ–°ç‰Œä¹Ÿå¯èƒ½æ²‰åº•ï¼Œä¸€æ²‰åº•è¿™å±€å°±æ²¡æ³•ç©äº†ã€‚</p><p>ä½œè€…Danielç”¨å¥‡å¦™çš„æ–¹å¼è§£å†³äº†é—®é¢˜â€”â€”åœ¨åœ°å›¾ä¸Šæä¾›å¤§é‡çš„ç‰Œç»„æ”¹é€ èŠ‚ç‚¹ï¼Œå¹¶é¼“åŠ±è¶…æ¨¡å•å¡ã€‚æˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚è®¨è®ºè¿™ä¸€ç‚¹ã€‚</p><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹é‚ªæ¶å†¥åˆ»çš„åŸå‹å§ï¼š<a href="https://dmullinsgames.itch.io/sacrifices-must-be-made">https://dmullinsgames.itch.io/sacrifices-must-be-made</a></p><h2 id="æ¯å±€æ¸¸æˆçš„è‡ªæ´½-1"><a href="#æ¯å±€æ¸¸æˆçš„è‡ªæ´½-1" class="headerlink" title="æ¯å±€æ¸¸æˆçš„è‡ªæ´½"></a>æ¯å±€æ¸¸æˆçš„è‡ªæ´½</h2><p><img src="/images/game-design/æ€æˆ®å°–å¡”æ¡†æ¶/inscription.png" alt=""></p><p>å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è¨€ï¼Œæ¯å›åˆåªæŠ½ä¸€å¼ ç‰Œå¯¹å¡ç»„æ„ç­‘æå‡ºäº†æé«˜çš„è¦æ±‚ã€‚ä¸€ä¸ªè‡ªç„¶çš„æ€è·¯æ˜¯å…è®¸ç©å®¶è‡ªç”±è°ƒæ•´å¡ç»„ï¼Œåªæ˜¯è®¾ç½®äº›è®¸é™åˆ¶ï¼Œæ¯”å¦‚æ¯å¼ ç‰Œæœ€å¤šå¸¦ä¸¤å¼ ã€è‡³å°‘äºŒåå¼ ç‰Œä»€ä¹ˆçš„ã€‚ä½†é‚ªæ¶å†¥åˆ»å¹¶ä¸æ˜¯è¿™ä¹ˆåšçš„ã€‚</p><p>åœ¨é‚ªæ¶å†¥åˆ»ä¸­ï¼Œåˆ å¡å¹¶ä¸æ˜¯å¾ˆå›°éš¾çš„äº‹ï¼Œé€ è¶…æ¨¡å•å¡ä¹Ÿéå¸¸ç®€å•ã€‚ç¥­å›ã€çœŸèŒå­¦å®¶èŠ‚ç‚¹å¯ä»¥åŒæ—¶å®ç°è¿™ä¸¤ç‚¹ï¼Œéª¨ç‹å¯ä»¥åˆ å¡ï¼Œç”»å®¶å¯ä»¥å¤åˆ¶è¶…æ¨¡å•å¡ï¼Œæ¯å±‚å¯ä»¥æ‹¿ä¸¤ä¸‰å¼ ç¨€æœ‰å¡ã€‚è¿™å°±è®©ç©å®¶èƒ½å¤Ÿè¿…é€Ÿæå‡å•å¡è´¨é‡ï¼Œé è¶…æ¨¡å•å¡å’Œå¯¹é¢æ‰“æ¶ã€‚</p><p>ä¹Ÿå› æ­¤åœ¨é‚ªæ¶å†¥åˆ»ä¸­ç»å¸¸ä¼šå‡ºç°ä¸€å›åˆç§’å¯¹é¢çš„å±€ï¼Œè¯´å®è¯æˆ‘è§‰å¾—è¿™å¹¶ä¸æ˜¯å¤ªå¥½çš„è®¾è®¡ï¼Œä¸è¿‡ç¡®å®æŒºè‡ªæ´½çš„ã€‚</p><h1 id="æˆ‘çš„æ¸¸æˆ"><a href="#æˆ‘çš„æ¸¸æˆ" class="headerlink" title="æˆ‘çš„æ¸¸æˆ"></a>æˆ‘çš„æ¸¸æˆ</h1><p>ï¼ˆå“‡ï¼Œä½ çš„æ¸¸æˆå’Œæ€æˆ®å°–å¡”ã€é‚ªæ¶å†¥åˆ»éƒ½æ˜¯ä¸€çº§æ ‡é¢˜ï¼Œé‚£ä¸€å®šå’Œä»–ä»¬ä¸€æ ·å‰å®³å§</p><p><img src="/images/game-design/æ€æˆ®å°–å¡”æ¡†æ¶/reverse_prototype.png" alt=""></p><p>ç°åœ¨æˆ‘ä»¬é¢å‰æœ‰ä¸€ä¸ª3x5çš„ç‰Œæ¡Œï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥è¯¥åšä»€ä¹ˆï¼Ÿæˆ‘ä»¬å…ˆéšä¾¿æ‹¿ç‚¹æ‰‹ç‰Œå§ï¼Œå¯ä»¥æŠŠæ‰‹ç‰Œæ”¾åˆ°ç‰Œæ¡Œä¸Šæ¥å¬å”¤éšä»ï¼Œç„¶åå’Œæ•Œæ–¹éšä»æ‰“æ¶ã€‚ä½†æ‰‹ç‰Œä»å“ªé‡Œæ¥ï¼Œè´¹ç”¨æœºåˆ¶åˆæ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>éšä»æ˜¯ç«™åœºçš„æŒç»­æ€§çš„ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ä¸åˆ·æ–°æ‰‹ç‰Œäº†ï¼Œè€Œæ˜¯æ¯å›åˆæŠ½ä¸€å¼ ç‰Œã€‚è´¹ç”¨åˆ·æ–°ä¹Ÿæœªå°ä¸å¯ï¼Œä¸è¿‡æˆ‘æŒºå–œæ¬¢é‚ªæ¶å†¥åˆ»çš„çŒ®ç¥­æœºåˆ¶çš„ï¼Œæ‰€ä»¥å°±ç›´æ¥æ¬è¿‡æ¥ç”¨äº†ã€‚é‚ªæ¶å†¥åˆ»å¤ªå¡æ‰‹äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¯å›åˆå†ç»™ç©å®¶å¡ä¸€å¼ æ¾é¼ ç‰Œã€‚</p><p>ä¸è¿‡è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™äº›åªæ˜¯ç†è®ºæ¨å¯¼ã€‚åœ¨å®é™…åšåŸå‹çš„æ—¶å€™æˆ‘ä¹Ÿæµ‹è¯•äº†åˆ·æ–°æ‰‹ç‰Œã€åˆ·æ–°è´¹ç”¨ï¼Œå‘ç°ç¡®å®è¿˜æ˜¯æ¯å›åˆæŠ½ä¸€å¼ ç‰Œ+çŒ®ç¥­æœºåˆ¶å’Œè¿™ä¸ªéšä»äº¤äº’æœºåˆ¶çš„å¥‘åˆåº¦æœ€é«˜ã€‚ç†è®ºå’Œå®é™…ç›¸ç¬¦è¯´æ˜ç†è®ºæœ‰ä¸€å®šæŒ‡å¯¼æ„ä¹‰ï¼Œä»¥åå¯ä»¥æ¥ç€ç”¨ï¼Œç†è®ºä¸å®é™…ä¸ç¬¦è¯´æ˜ç†è®ºåœ¨èƒ¡æ‰¯ï¼Œå°±è¦è°ƒæ•´äº†ã€‚</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†å•å±€ç‰Œå±€çš„è®¾è®¡ã€‚ä¹‹åæˆ‘æŠŠç‰Œæ¡Œæ”¹æˆäº†4x5ï¼Œå‘ç°æ›´æœ‰ç­–ç•¥ä¹Ÿæ›´å¥½ç©äº†ï¼Œæ‰¾äººè¯•ç©äº†ä¸€ä¸‹ä¹‹åæ¿€è¿›åœ°æ”¹æˆäº†5x7ï¼Œå±…ç„¶åˆæ›´æœ‰ç­–ç•¥æ›´å¥½ç©äº†ï¼Œé‚£æš‚æ—¶å°±è¿™æ ·å§ã€‚</p><p><img src="/images/game-design/æ€æˆ®å°–å¡”æ¡†æ¶/5x7prototype.png" alt=""></p><p>è¿™é‡Œæ˜¯è¯•ç©é“¾æ¥ï¼š</p><p><a href="/games/card-chess-prototype/index.html" target="_blank" rel="noopener noreferrer">å¼€å§‹æ¸¸æˆï¼ˆå°†åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€ï¼‰</a></p><p>å–œæ¬¢çš„è¯å¯ä»¥å¡«ä¸ªé—®å·ï¼Œè°¢è°¢å–µï¼</p><p><a href="https://wj.qq.com/s2/23112055/a88d/" target="_blank" rel="noopener noreferrer">é—®å·ï¼ˆå°†åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€ï¼‰</a></p><p>é‚£ä¹ˆæ¯å±€æ¸¸æˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿç”±äºæˆ‘ä»¬çš„æœºåˆ¶å’Œé‚ªæ¶å†¥åˆ»ç›¸ä¼¼ï¼Œæ‰€ä»¥å®ƒä¼šé‡åˆ°çš„é—®é¢˜æˆ‘ä»¬ä¹Ÿéƒ½ä¼šé‡åˆ°ã€‚æœ€å…³é”®çš„ä¸¤ç‚¹å°±æ˜¯ç‰Œè¶Šå¤šè¶Šèœå’Œå…³é”®ç‰Œæ²‰åº•ã€‚</p><p>ä¸€å¼€å§‹æˆ‘å°è¯•è§£å†³å‰è€…ï¼Œç„¶åå¶ç„¶é—´å¾—åˆ°äº†ä¸€ä¸ªæˆ‘è§‰å¾—è¿˜ä¸é”™çš„ï¼Œèƒ½åŒæ—¶è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜çš„æ–¹æ¡ˆã€‚</p><p>è§£å†³é—®é¢˜æ— éä»å•å±€ç‰Œå±€å’Œæ•´å±€æ¸¸æˆè€ƒè™‘ï¼Œæˆ‘æƒ³äº†åŠå¤©æ²¡æƒ³åˆ°æ€ä¹ˆç”¨åœ¨å•å±€å†…è§£å†³é—®é¢˜ï¼Œäºæ˜¯å°±æƒ³ç ”ç©¶ä¸‹é€šè¿‡è°ƒæ•´æ•´å±€æ¸¸æˆçš„è¿è¥æ¥è§£å†³é—®é¢˜ã€‚</p><p>åœ¨ç©å¡ç‰Œè‚‰é¸½çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°é€‰ç‰ŒåŠ å…¥ç‰Œç»„ä¸å¦‚è·³è¿‡çš„æƒ…å†µï¼Œè¿™å°±æ˜¯å…¸å‹çš„â€œç‰Œè¶Šå¤šè¶Šèœâ€ã€‚é‚£æ€ä¹ˆä¿è¯æ¯æ¬¡é€‰ç‰Œéƒ½æœ‰è¡¥å¼ºå‘¢ï¼Ÿè€ƒè™‘åˆ°æˆ‘ä»¬çš„çŒ®ç¥­æœºåˆ¶ï¼Œæˆ‘å°±æƒ³åˆ°æŠŠå¯é€‰ç‰ŒçŒ®ç¥­æˆéšæ—¶å¯ä»¥ä½¿ç”¨çš„ä¸€æ¬¡æ€§é“å…·ï¼Œè¿™æ ·æ¯æ¬¡é€‰ç‰Œéƒ½è‡³å°‘èƒ½è®©ç©å®¶å˜å¼ºä¸€ç‚¹ã€‚</p><p>é“å…·æ€ä¹ˆåšå‘¢ï¼Ÿåˆæ­¥æƒ³æ³•æ˜¯æŠŠç‰Œçš„è´¹ç”¨å‡åŠï¼Œæ³•æœ¯ç‰Œä¸å˜ï¼Œéšä»ç‰Œåœ¨ä¸‹ä¸ªå›åˆå¼€å§‹æ—¶è‡ªåŠ¨è¢«çŒ®ç¥­ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼Œå®ƒä¹Ÿç¼“è§£äº†å…³é”®ç‰Œæ²‰åº•çš„é—®é¢˜ï¼Œæ¯•ç«Ÿä¸€æ–¹é¢é“å…·èƒ½å¸®åŠ©æˆ‘ä»¬è¿‡æ¸¡ï¼Œå¦ä¸€æ–¹é¢æˆ‘ä»¬ä¹Ÿèƒ½ç›´æ¥æŠŠå…³é”®ç‰ŒçŒ®ç¥­æˆé“å…·ï¼Œç„¶åå°±ä¸ç”¨æ‹…å¿ƒæ²‰åº•äº†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;style&gt;
img{
    width: 70%;
}
&lt;/style&gt;

&lt;p&gt;æœ€è¿‘åœ¨è®¾è®¡å¡ç‰Œæ¸¸æˆï¼ˆä½ çŸ¥é“çš„ï¼Œæˆ‘ä¸€ç›´æ˜¯ç‰Œä½¬ï¼‰ï¼Œå‘ç°ä»¥å‰åšçš„ç¿»ç‰Œæ¸¸æˆåŸå‹çš„ç¿»ç‰Œç©æ³•æœ¬èº«éšæœºæ€§è¿‡å¼ºï¼Œä»è€Œæ‹“å±•ç©ºé—´è¿‡å°ï¼Œä½†â€œæ£‹ç›˜ä¸Šçš„éšä»äº¤äº’â€éå¸¸æœ‰è¶£ï¼Œäºæ˜¯å°±æ‰“ç®—ä»å®ƒå‡ºå‘å¼€å§‹è¿›ä¸€æ­¥è®¾è®¡ã€‚åˆæ­¥çš„æƒ³æ³•æ˜¯</summary>
      
    
    
    
    <category term="æ¸¸æˆè®¾è®¡" scheme="http://rinevard.github.io/categories/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1/"/>
    
    
  </entry>
  
  <entry>
    <title>_æˆ‘ä¹Ÿæƒ³åšå‡ºä¼˜ç§€çš„ä½œå“</title>
    <link href="http://rinevard.github.io/wiki/others/thoughts/%E6%88%91%E4%B9%9F%E6%83%B3%E5%81%9A%E5%87%BA%E4%BC%98%E7%A7%80%E7%9A%84%E4%BD%9C%E5%93%81/"/>
    <id>http://rinevard.github.io/wiki/others/thoughts/%E6%88%91%E4%B9%9F%E6%83%B3%E5%81%9A%E5%87%BA%E4%BC%98%E7%A7%80%E7%9A%84%E4%BD%9C%E5%93%81/</id>
    <published>2025-06-16T14:03:30.000Z</published>
    <updated>2025-07-18T15:06:40.639Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åšäº†<a href="https://rinevard.itch.io/myriad-by-cards">ç‰Œç”Ÿä¸‡ç‰©</a>ï¼Œæ„Ÿè§‰æŒºéš¾å—çš„ã€‚ä¸€ç›´ä»¥æ¥æˆ‘éƒ½å¸Œæœ›æ¯ä¸€éƒ¨ä½œå“éƒ½åšå¾—æ¯”ä¸Šä¸€éƒ¨æ›´å¥½ï¼Œè¿™ä¸€éƒ¨çœ‹èµ·æ¥æ¯”<a href="https://rinevard.itch.io/undertetris">undertetris</a>å¥½ä¸€ç‚¹å—ï¼Ÿæˆ–è®¸å§ï¼Œä½†æˆ‘å°±æ˜¯æ„Ÿè§‰ä¸å¼€å¿ƒã€‚</p><p>æƒ³æ¥å¯èƒ½æ˜¯å› ä¸ºè¿™ä¸æ˜¯æˆ‘å–œæ¬¢çš„ä½“éªŒå§ã€‚æˆ‘æƒ³åšå‡ºèƒ½æ‰“åŠ¨ç©å®¶çš„ä½œå“ï¼Œèƒ½è®©ç©å®¶è®°ä½ä¸€è¾ˆå­ï¼Œè‡³å°‘æ˜¯ä¸€å¹´çš„ä½œå“ï¼Œè€Œä¸æ˜¯è¿™æ ·çš„è«åå…¶å¦™çš„â€œèåˆå¡ç‰Œâ€ã€‚ç©ç€è¿™ä¸ªæ¸¸æˆæ—¶ï¼Œæ¯”èµ·å¯¹ä½œå“çš„æ»¡æ„ï¼Œæ›´å¤šçš„æ˜¯çƒ¦èºã€‚ä¹Ÿå¯èƒ½æ˜¯å› ä¸ºç°åœ¨æ˜¯è€ƒè¯•å‘¨å‹åŠ›å¤§å§ï¼Œæˆ‘ä¹Ÿä¸æ¸…æ¥šã€‚</p><p>æˆ‘æƒ³å’ŒLLMä¸€èµ·åˆ›é€ ä¸€ä¸ªä¸–ç•Œå•Šï¼Œä¸€ä¸ªæ ©æ ©å¦‚ç”Ÿçš„ä¸–ç•Œã€‚æ¯ä¸ªäº‹ä»¶éƒ½è®©äººæ€è€ƒï¼Œæ¯ä¸ªè§’è‰²éƒ½ç»™äººæ·±åˆ»å°è±¡ï¼Œè€Œä¸æ˜¯ç°åœ¨çš„åè¯å †ç Œã€æ•°å€¼è†¨èƒ€ã€‚LLMä¸ä¼šå†™æ•…äº‹ä»æ¥éƒ½ä¸æ˜¯å€Ÿå£ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯æœ¬å¯ä»¥åšå¾—æ›´å¥½ï¼Ÿ</p><p>æˆ‘è¯¥æ€ä¹ˆåšæ‰å¥½ï¼Ÿæˆ‘è¯¥å‰å¾€ä½•æ–¹ï¼Ÿ</p><p>æˆ‘çŸ¥é“ï¼Œè®©LLMç”Ÿæˆçš„ä¸–ç•Œåƒã€Šè‹ä¸¹çš„æ¸¸æˆã€‹ä¸€æ ·æœ¬èº«å°±æ˜¯ä¸€ä»¶ä¸ç°å®çš„äº‹æƒ…ã€‚ä½†èµ·ç å®ƒè¦åƒæ˜¯ä¸€ä¸ªä¸–ç•Œå§ï¼Œæ•´ä¸ªå†’é™©æ˜¯æœ‰æ•…äº‹æ€§çš„å§ï¼Œç°åœ¨æ˜¯ä¸ªä»€ä¹ˆç©æ„ï¼Ÿï¼Ÿï¼Ÿæ›´å¯æ°”çš„æ˜¯è¿™ç©æ„è¿˜çœŸæœ‰å¯ç©æ€§ï¼Œåšäº†ä¸€ä¸ªé å¼ºåŒ–ç¨‹åºå’Œæ•°å€¼è†¨èƒ€å †ç Œèµ·æ¥çš„ä¸œè¥¿çœŸåƒæ˜¯å¯¹è‡ªå·±çš„ä¾®è¾±ï¼</p><p>è‡³å°‘ï¼Œå®ƒçš„ä½“éªŒä¸è¯¥æ˜¯æ•°å€¼è†¨èƒ€ã€‚è‡³å°‘ï¼Œè®©ç©å®¶ç©ä¸‹å»çš„åŠ¨åŠ›ä¸è¯¥æ˜¯å¼ºåŒ–ç¨‹åºã€‚å¦‚æœæˆ‘ä»¬æ‹¿èµ°äº†ç©å®¶çš„æ—¶é—´ï¼Œæˆ‘ä»¬èµ·ç åº”å½“è¡¥å¿ä¸€äº›ä»€ä¹ˆæ‰å¯¹ï¼Œè€Œä¸è¯¥å¾’ç•™æ‚”æ¨æ„Ÿã€‚</p><p>å¯èƒ½ä¹Ÿæœ‰ç‚¹åæ¿€äº†ï¼Œå¯èƒ½åªæ˜¯æˆ‘è‡ªå·±ä¸å–œæ¬¢è¿™ç§ç±»å‹è€Œå·²â€¦â€¦ç”šè‡³æˆ‘è‡ªå·±ä¹Ÿè§‰å¾—è¿˜ç®—å¯ä»¥ï¼Œè‡³å°‘ç¡®å®æœ‰è®©æˆ‘å°è±¡æ·±åˆ»çš„æ—¶åˆ»ã€‚ä½†æˆ‘è¿˜æ˜¯æ„Ÿè§‰ä¸å¼€å¿ƒï¼Œæ¯•ç«Ÿï¼Œâ€œæˆ‘ä»¬æ˜¯ä¸æ˜¯æœ¬å¯ä»¥åšå¾—æ›´å¥½ï¼Ÿâ€</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€è¿‘åšäº†&lt;a href=&quot;https://rinevard.itch.io/myriad-by-cards&quot;&gt;ç‰Œç”Ÿä¸‡ç‰©&lt;/a&gt;ï¼Œæ„Ÿè§‰æŒºéš¾å—çš„ã€‚ä¸€ç›´ä»¥æ¥æˆ‘éƒ½å¸Œæœ›æ¯ä¸€éƒ¨ä½œå“éƒ½åšå¾—æ¯”ä¸Šä¸€éƒ¨æ›´å¥½ï¼Œè¿™ä¸€éƒ¨çœ‹èµ·æ¥æ¯”&lt;a href=&quot;https://rinevard.itch.io/un</summary>
      
    
    
    
    <category term="æ‚è°ˆ" scheme="http://rinevard.github.io/categories/%E6%9D%82%E8%B0%88/"/>
    
    <category term="ç¢ç¢å¿µ" scheme="http://rinevard.github.io/categories/%E6%9D%82%E8%B0%88/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
  </entry>
  
  <entry>
    <title>Lab2 System calls</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/Labs/lab2-syscall/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/Labs/lab2-syscall/</id>
    <published>2025-06-04T07:10:38.000Z</published>
    <updated>2025-06-04T06:37:13.135Z</updated>
    
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="MIT-6.S081" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/MIT-6-S081/"/>
    
    <category term="Labs" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/MIT-6-S081/Labs/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¬¬äºŒç« â€”â€”æ“ä½œç³»ç»Ÿæ¦‚è¿°</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/Notes/note2-organization-overview/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/Notes/note2-organization-overview/</id>
    <published>2025-06-04T06:26:38.000Z</published>
    <updated>2025-06-04T06:43:40.608Z</updated>
    
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="MIT-6.S081" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/MIT-6-S081/"/>
    
    <category term="Notes" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/MIT-6-S081/Notes/"/>
    
    
  </entry>
  
  <entry>
    <title>çœ‹æˆ‘çœ‹æˆ‘</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/Notes/little-fish/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/Notes/little-fish/</id>
    <published>2025-06-01T06:32:38.000Z</published>
    <updated>2025-07-18T10:42:54.523Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œå­˜æ”¾ç€æˆ‘å¯¹ book-riscv-rev4 å’Œ MIT-6.S081 çš„ç¬”è®°ï¼Œæ¯ä¸ªç¬”è®°å¯¹åº” book-riscv-rev4 çš„ä¸€ä¸ªç« èŠ‚ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™é‡Œå­˜æ”¾ç€æˆ‘å¯¹ book-riscv-rev4 å’Œ MIT-6.S081 çš„ç¬”è®°ï¼Œæ¯ä¸ªç¬”è®°å¯¹åº” book-riscv-rev4 çš„ä¸€ä¸ªç« èŠ‚ã€‚&lt;/p&gt;
</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="MIT-6.S081" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/MIT-6-S081/"/>
    
    <category term="Notes" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/MIT-6-S081/Notes/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¬¬ä¸€ç« â€”â€”ç³»ç»Ÿæ¥å£</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/Notes/note1-sys-interface/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/Notes/note1-sys-interface/</id>
    <published>2025-06-01T03:18:38.000Z</published>
    <updated>2025-08-20T11:13:48.861Z</updated>
    
    <content type="html"><![CDATA[<style>img{    width: 70%;}</style><h1 id="å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£"><a href="#å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£" class="headerlink" title="å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£"></a>å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£</h1><div class="table-container"><table><thead><tr><th><strong>ç³»ç»Ÿè°ƒç”¨</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>fork()</td><td>åˆ›å»ºè¿›ç¨‹</td></tr><tr><td>exit()</td><td>ç»“æŸå½“å‰è¿›ç¨‹</td></tr><tr><td>wait()</td><td>ç­‰å¾…å­è¿›ç¨‹ç»“æŸ</td></tr><tr><td>kill(pid)</td><td>ç»“æŸ pid æ‰€æŒ‡è¿›ç¨‹</td></tr><tr><td>getpid()</td><td>è·å¾—å½“å‰è¿›ç¨‹ pid</td></tr><tr><td>sleep(n)</td><td>ç¡çœ  n ç§’</td></tr><tr><td>exec(filename, *argv)</td><td>åŠ è½½å¹¶æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶</td></tr><tr><td>sbrk(n)</td><td>ä¸ºè¿›ç¨‹å†…å­˜ç©ºé—´å¢åŠ  n å­—èŠ‚</td></tr><tr><td>open(filename, flags)</td><td>æ‰“å¼€æ–‡ä»¶ï¼Œflags æŒ‡å®šè¯»/å†™æ¨¡å¼</td></tr><tr><td>read(fd, buf, n)</td><td>ä»æ–‡ä»¶ä¸­è¯» n ä¸ªå­—èŠ‚åˆ° buf</td></tr><tr><td>write(fd, buf, n)</td><td>ä» buf ä¸­å†™ n ä¸ªå­—èŠ‚åˆ°æ–‡ä»¶</td></tr><tr><td>close(fd)</td><td>å…³é—­æ‰“å¼€çš„ fd</td></tr><tr><td>dup(fd)</td><td>å¤åˆ¶ fd</td></tr><tr><td>pipe( p)</td><td>åˆ›å»ºç®¡é“ï¼Œ å¹¶æŠŠè¯»å’Œå†™çš„ fd è¿”å›åˆ°p</td></tr><tr><td>chdir(dirname)</td><td>æ”¹å˜å½“å‰ç›®å½•</td></tr><tr><td>mkdir(dirname)</td><td>åˆ›å»ºæ–°çš„ç›®å½•</td></tr><tr><td>mknod(name, major, minor)</td><td>åˆ›å»ºè®¾å¤‡æ–‡ä»¶</td></tr><tr><td>fstat(fd)</td><td>è¿”å›æ–‡ä»¶ä¿¡æ¯</td></tr><tr><td>link(f1, f2)</td><td>ç»™ f1 åˆ›å»ºä¸€ä¸ªæ–°åå­—(f2)</td></tr><tr><td>unlink(filename)</td><td>åˆ é™¤æ–‡ä»¶</td></tr></tbody></table></div><h1 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h1><div class="table-container"><table><thead><tr><th><strong>ç³»ç»Ÿè°ƒç”¨</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>fork()</td><td>åˆ›å»ºè¿›ç¨‹</td></tr><tr><td>exit()</td><td>ç»“æŸå½“å‰è¿›ç¨‹</td></tr><tr><td>wait()</td><td>ç­‰å¾…å­è¿›ç¨‹ç»“æŸ</td></tr><tr><td>kill(pid)</td><td>ç»“æŸ pid æ‰€æŒ‡è¿›ç¨‹</td></tr><tr><td>getpid()</td><td>è·å¾—å½“å‰è¿›ç¨‹ pid</td></tr><tr><td>exec(filename, *argv)</td><td>åŠ è½½å¹¶æ‰§è¡Œä¸€ä¸ªæ–‡ä»¶</td></tr><tr><td>sbrk(n)</td><td>ä¸ºè¿›ç¨‹å†…å­˜ç©ºé—´å¢åŠ  n å­—èŠ‚</td></tr></tbody></table></div><h1 id="I-O"><a href="#I-O" class="headerlink" title="I/O"></a>I/O</h1><div class="table-container"><table><thead><tr><th><strong>ç³»ç»Ÿè°ƒç”¨</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>open(filename, flags)</td><td>æ‰“å¼€æ–‡ä»¶ï¼Œflags æŒ‡å®šè¯»/å†™æ¨¡å¼</td></tr><tr><td>read(fd, buf, n)</td><td>ä»æ–‡ä»¶ä¸­è¯» n ä¸ªå­—èŠ‚åˆ° buf</td></tr><tr><td>write(fd, buf, n)</td><td>ä» buf ä¸­å†™ n ä¸ªå­—èŠ‚åˆ°æ–‡ä»¶</td></tr><tr><td>close(fd)</td><td>å…³é—­æ‰“å¼€çš„ fd</td></tr><tr><td>dup(fd)</td><td>å¤åˆ¶ fd</td></tr></tbody></table></div><p>ä»£ç ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">cat</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> n<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// å†™å…¥æ ‡å‡†è¾“å‡º</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">!=</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"cat: write error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"cat: read error\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> fd<span class="token punctuation">,</span> i<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">cat</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> argc<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"cat: cannot open %s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">cat</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸å¦¨å†æ¥çœ‹çœ‹CSAPPçš„ä¸¤å¼ å›¾</p><h3 id="openä¸¤æ¬¡ï¼š"><a href="#openä¸¤æ¬¡ï¼š" class="headerlink" title="openä¸¤æ¬¡ï¼š"></a><strong>openä¸¤æ¬¡ï¼š</strong></h3><p><img src="/images/learning/open-course/MIT-6.S081/notes/note1-syscall/opentwice.png" alt=""></p><h3 id="forkï¼š"><a href="#forkï¼š" class="headerlink" title="forkï¼š"></a><strong>forkï¼š</strong></h3><p><img src="/images/learning/open-course/MIT-6.S081/notes/note1-syscall/fork.png" alt=""></p><h1 id="ç®¡é“"><a href="#ç®¡é“" class="headerlink" title="ç®¡é“"></a>ç®¡é“</h1><div class="table-container"><table><thead><tr><th><strong>ç³»ç»Ÿè°ƒç”¨</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>pipe( p)</td><td>åˆ›å»ºç®¡é“ï¼Œ å¹¶æŠŠè¯»å’Œå†™çš„ fd è¿”å›åˆ°pï¼Œå…¶ä¸­pæ˜¯ int p[2]</td></tr></tbody></table></div><ul><li>p[0]: è¯»ç«¯(read end)çš„æ–‡ä»¶æè¿°ç¬¦</li><li>p[1]: å†™ç«¯(write end)çš„æ–‡ä»¶æè¿°ç¬¦</li></ul><p>æ ·ä¾‹ï¼š <code>grep fork sh.c | wc -l</code> å‘½ä»¤å°†ç¬¬ä¸€ä¸ªå‘½ä»¤(grep)çš„è¾“å‡ºä½œä¸ºç¬¬äºŒä¸ªå‘½ä»¤(wc)çš„è¾“å…¥ï¼Œ<code>|</code> å°±æ˜¯ç®¡é“ç¬¦å·ã€‚</p><p>ä¸‹é¢çš„ä»£ç æ˜¯ <code>|</code> çš„å®ç°ç¤ºä¾‹ï¼Œå¤§ä½“æ€è·¯æ˜¯æŠŠ <code>|</code> å·¦è¾¹çš„æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°pipeçš„å†™ç«¯ï¼ŒæŠŠ <code>|</code> å³è¾¹çš„æ ‡å‡†è¾“å…¥é‡å®šå‘åˆ°pipeçš„è¯»ç«¯ã€‚</p><p>æ³¨æ„è¦å…³é—­ç®¡é“çš„æ‰€æœ‰å†™å…¥ç«¯æ¥è®© <code>read</code> è¿”å›ï¼Œå› ä¸ºå½“ pipe ä¸­æ²¡æœ‰æ•°æ®æ—¶ï¼Œ<code>read</code> ä¼šé˜»å¡ç­‰å¾…æ–°æ•°æ®å†™å…¥ï¼Œæˆ–æ˜¯å†™å…¥ç«¯éƒ½å…³é—­ï¼Œå¦‚æœæœ‰æ–°æ•°æ®å†™å…¥å°±è¯»å–ï¼Œå¦‚æœæ‰€æœ‰å†™å…¥ç«¯éƒ½å…³é—­å°±è¿”å› 0ï¼ˆå¯¹åº”EOFï¼‰.</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// å‡è®¾æˆ‘ä»¬çš„å‘½ä»¤æ˜¯ grep fork sh.c | wc -l</span><span class="token keyword">case</span> PIPE<span class="token operator">:</span>    pcmd <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">pipecmd</span> <span class="token operator">*</span><span class="token punctuation">)</span>cmd<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">pipe</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"pipe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">close</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// é‡Šæ”¾æ–‡ä»¶æè¿°ç¬¦1ï¼Œä»è€Œè®©dupæŠŠæ–‡ä»¶æè¿°ç¬¦1ç»‘å®šåˆ°p[1]æŒ‡å‘çš„ä¸œè¥¿</span>        <span class="token function">dup</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åœ¨é‡å®šå‘æ ‡å‡†è¾“å‡ºåˆ°pipeçš„å†™ç«¯</span>        <span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">runcmd</span><span class="token punctuation">(</span>pcmd<span class="token operator">-></span>left<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº” grep fork sh.c</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">close</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¸ä¸Šé¢ç±»ä¼¼ï¼Œé‡å®šå‘æ ‡å‡†è¾“å…¥åˆ°pipeçš„è¯»ç«¯</span>        <span class="token function">dup</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">runcmd</span><span class="token punctuation">(</span>pcmd<span class="token operator">-></span>right<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¯¹åº” wc -l</span>    <span class="token punctuation">&#125;</span>    <span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h1><div class="table-container"><table><thead><tr><th><strong>ç³»ç»Ÿè°ƒç”¨</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>chdir(dirname)</td><td>æ”¹å˜å½“å‰ç›®å½•</td></tr><tr><td>mkdir(dirname)</td><td>åˆ›å»ºæ–°çš„ç›®å½•</td></tr><tr><td>mknod(name, major, minor)</td><td>åˆ›å»ºè®¾å¤‡æ–‡ä»¶</td></tr><tr><td>fstat(fd)</td><td>è¿”å›æ–‡ä»¶ä¿¡æ¯</td></tr><tr><td>link(f1, f2)</td><td>ç»™ f1 åˆ›å»ºä¸€ä¸ªæ–°åå­—(f2)</td></tr><tr><td>unlink(filename)</td><td>åˆ é™¤æ–‡ä»¶</td></tr></tbody></table></div><p>æˆ‘ä»¬é€šå¸¸è®¤ä¸ºæ–‡ä»¶åå°±æ˜¯æ–‡ä»¶æœ¬èº«ï¼Œä½†å®é™…ä¸Šåç§°æ˜¯ä¸€ä¸ªç¡¬é“¾æ¥(hard link)ã€‚ä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªç¡¬é“¾æ¥â€”â€”ä¾‹å¦‚ï¼Œä¸€ä¸ªç›®å½•è‡³å°‘æœ‰ä¸¤ä¸ªç¡¬é“¾æ¥ï¼šç›®å½•åå’Œ <code>.</code> ï¼ˆåœ¨ç›®å½•å†…æ—¶ï¼‰ã€‚å®ƒè¿˜æœ‰æ¥è‡ªæ¯ä¸ªå­ç›®å½•çš„ä¸€ä¸ªç¡¬é“¾æ¥ï¼ˆæ¯ä¸ªå­ç›®å½•ä¸­çš„ <code>..</code> æ–‡ä»¶ï¼‰ã€‚</p><p>é‚£æ–‡ä»¶æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸€ä¸ªæ–‡ä»¶å’Œä¸€ä¸ª inode ä¸€ä¸€å¯¹åº”ï¼Œinodeå­˜æ”¾ç€è¿™ä¸ªæ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯</p><p>xv6ç³»ç»Ÿçš„inodeç»“æ„åŒ…æ‹¬ä¸‹é¢è¿™äº›å†…å®¹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">dinode</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">short</span> type<span class="token punctuation">;</span>              <span class="token comment">// File type</span>    <span class="token keyword">short</span> major<span class="token punctuation">;</span>             <span class="token comment">// Major device number (T_DEVICE only)</span>    <span class="token keyword">short</span> minor<span class="token punctuation">;</span>             <span class="token comment">// Minor device number (T_DEVICE only)</span>    <span class="token keyword">short</span> nlink<span class="token punctuation">;</span>             <span class="token comment">// Number of links to inode in file system</span>    uint size<span class="token punctuation">;</span>               <span class="token comment">// Size of file (bytes)</span>    uint addrs<span class="token punctuation">[</span>NDIRECT <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// Data block addresses</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥é€šè¿‡ <code>fstat</code> è·å–æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘çš„æ–‡ä»¶çš„ä¿¡æ¯ã€‚dinodeæ˜¯ç£ç›˜ä¸Šå­˜å‚¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œstatæ˜¯æš´éœ²ç»™ç”¨æˆ·çš„æ–‡ä»¶ä¿¡æ¯æ¥å£</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">stat</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> dev<span class="token punctuation">;</span>     <span class="token comment">// File system's disk device</span>    uint ino<span class="token punctuation">;</span>    <span class="token comment">// Inode number</span>    <span class="token keyword">short</span> type<span class="token punctuation">;</span>  <span class="token comment">// Type of file</span>    <span class="token keyword">short</span> nlink<span class="token punctuation">;</span> <span class="token comment">// Number of links to file</span>    uint64 size<span class="token punctuation">;</span> <span class="token comment">// Size of file in bytes</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»…å½“æˆ‘ä»¬æŠŠæ‰€æœ‰æŒ‡å‘æŸä¸ªinodeçš„é“¾æ¥éƒ½åˆ é™¤ï¼Œè¿™ä¸ªinodeæ‰ä¼šè¢«åˆ é™¤ã€‚</p><p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ç”¨ <code>ln</code> åˆ›å»ºäº†ä¸¤ä¸ªè¿æ¥ file2 å’Œ file3ï¼Œå®ƒä»¬éƒ½å’Œ file1 æŒ‡å‘çš„ inode ç›¸åŒã€‚å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœç”¨ <code>echo</code> ä¿®æ”¹ file2ï¼Œé‚£ä¹ˆ file1 ä¹Ÿä¼šè¢«ä¿®æ”¹ï¼Œå› ä¸ºæˆ‘ä»¬ä¿®æ”¹çš„å®é™…ä¸Šæ˜¯ inodeï¼Œè€Œå®ƒä»¬æŒ‡å‘åŒä¸€ä¸ªinodeã€‚<code>ls -l</code> åˆ—å‡ºç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„è¯¦ç»†ä¿¡æ¯ï¼Œç¬¬äºŒä¸ªå€¼æ˜¯inodeçš„linkæ•°ã€‚æˆ‘ä»¬å¯ä»¥æŠŠé“¾æ¥è§†ä½œæ–‡ä»¶çš„â€œåˆ«åâ€ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ echo &quot;What&#39;s in a name? That which we call a rose, by any other word would smell as sweet.&quot; &gt; file1.txt$ lsfile1.txt  open-course  programs$ cat file1.txtWhat&#39;s in a name? That which we call a rose, by any other word would smell as sweet.$ ln file1.txt file2.txt$ ln file1.txt file3.txt$ ls -ltotal 20-rw-r--r-- 3 rinevard rinevard   85 May 29 11:37 file1.txt-rw-r--r-- 3 rinevard rinevard   85 May 29 11:37 file2.txt-rw-r--r-- 3 rinevard rinevard   85 May 29 11:37 file3.txtdrwxr-xr-x 3 rinevard rinevard 4096 May 28 11:00 open-coursedrwxr-xr-x 2 rinevard rinevard 4096 May 28 10:19 programs$ echo &quot;-- William Shakespeare&quot; &gt;&gt; file2.txt$ cat file1.txtWhat&#39;s in a name? That which we call a rose, by any other word would smell as sweet.-- William Shakespeare<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½ å¯èƒ½ä¼šå¥½å¥‡ç›®å½•çš„é“¾æ¥æ•°æ€ä¹ˆè®¡ç®—ï¼Œæ˜¯è¿™æ ·çš„ï¼š</p><ol><li>æ¯ä¸ªç›®å½•é»˜è®¤æœ‰2ä¸ªé“¾æ¥ï¼Œä¸€ä¸ªæ˜¯ç›®å½•è‡ªèº«çš„â€.â€ï¼Œå¦ä¸€ä¸ªæ˜¯çˆ¶ç›®å½•ä¸­æŒ‡å‘è¯¥ç›®å½•çš„é“¾æ¥</li><li>ç›®å½•ä¸­æ¯åŒ…å«ä¸€ä¸ªå­ç›®å½•ï¼Œé“¾æ¥æ•°å°±ä¼š+1ï¼Œå› ä¸ºæ¯ä¸ªå­ç›®å½•éƒ½ä¼šåˆ›å»ºâ€..â€é“¾æ¥æŒ‡å‘çˆ¶ç›®å½•</li></ol><p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œrootdir çš„é“¾æ¥æ•°æ˜¯ 4ï¼Œå› ä¸ºçˆ¶ç›®å½•æœ‰ä¸€ä¸ªæŒ‡å‘å®ƒçš„é“¾æ¥â€rootdirâ€ï¼Œå®ƒè‡ªå·±æœ‰ä¸€ä¸ªæŒ‡å‘è‡ªå·±çš„é“¾æ¥â€.â€ï¼Œå®ƒçš„ä¸¤ä¸ªå­ç›®å½•dir1å’Œdir2åˆ†åˆ«æœ‰æŒ‡å‘å®ƒçš„é“¾æ¥â€..â€</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/open-course/rootdir$ <span class="token function">ls</span>dir1  dir2  file1.md  file2.md  file3.md~/open-course/rootdir$ <span class="token function">ls</span> <span class="token punctuation">..</span>/ <span class="token parameter variable">-l</span>total <span class="token number">8</span>drwxr-xr-x <span class="token number">11</span> rinevard rinevard <span class="token number">4096</span> May <span class="token number">31</span> <span class="token number">16</span>:40 mit-6.828drwxr-xr-x  <span class="token number">4</span> rinevard rinevard <span class="token number">4096</span> Jun  <span class="token number">1</span> <span class="token number">10</span>:58 rootdir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ–‡ä»¶è·¯å¾„æ ¼å¼ï¼šä»¥ â€œ/â€ å¼€å¤´çš„æ˜¯ä»æ ¹ç›®å½•å‡ºå‘çš„è·¯å¾„ï¼Œå¦åˆ™æ˜¯ä»å½“å‰æ–‡ä»¶å¤¹å‡ºå‘çš„è·¯å¾„</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/open-course$ <span class="token function">ls</span>mit-6.828~/open-course$ <span class="token function">ls</span> mit-6.828/LICENSE  Makefile  README  conf  grade-lab-util  gradelib.py  kernel  <span class="token function">mkfs</span>  user~/open-course$ <span class="token function">ls</span> /home/rinevard/open-course  programs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>unix shellçš„è®¸å¤šå‘½ä»¤éƒ½æ˜¯ç”¨æˆ·çº§åˆ«çš„ï¼Œè€Œéå†…ç½®çš„ã€‚shellé€šè¿‡forkå­è¿›ç¨‹å¹¶è°ƒç”¨execæ¥æ‰§è¡Œå®ƒä»¬ã€‚ä½†cdæ˜¯å†…ç½®çš„ï¼Œå› ä¸ºcdæ”¹å˜äº†shellè‡ªèº«çš„å·¥ä½œç›®å½•ã€‚</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// Read and run input commands.</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getcmd</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'c'</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'d'</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">' '</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Chdir must be called by the parent, not the child.</span>        buf<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// chop \n</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">chdir</span><span class="token punctuation">(</span>buf <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"cannot cd %s\n"</span><span class="token punctuation">,</span> buf <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">continue</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token function">runcmd</span><span class="token punctuation">(</span><span class="token function">parsecmd</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;style&gt;
img{
    width: 70%;
}
&lt;/style&gt;

&lt;h1 id=&quot;å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£&quot;&gt;&lt;a href=&quot;#å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£&quot; class=&quot;headerlink&quot; title=&quot;å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£&quot;&gt;&lt;/a&gt;å¸¸ç”¨çš„ç³»ç»Ÿæ¥å£&lt;/h1&gt;&lt;div class=&quot;</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="MIT-6.S081" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/MIT-6-S081/"/>
    
    <category term="Notes" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/MIT-6-S081/Notes/"/>
    
    
  </entry>
  
  <entry>
    <title>Lab1 Xv6 and Unix utilities</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/Labs/lab1-util/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/Labs/lab1-util/</id>
    <published>2025-05-31T03:18:38.000Z</published>
    <updated>2025-08-20T11:13:48.861Z</updated>
    
    <content type="html"><![CDATA[<style>img{    width: 80%;}</style><p>åœ¨å¼€å§‹ lab ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæˆ‘ä»¬å†™çš„ä»£ç èƒ½ç›´æ¥åœ¨ xv6 çš„ shell é‡Œæ‰§è¡Œã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ <code>sh.c</code> çš„éƒ¨åˆ†ä»£ç ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// Read and run input commands.</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getcmd</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'c'</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'d'</span> <span class="token operator">&amp;&amp;</span> buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">' '</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Chdir must be called by the parent, not the child.</span>        buf<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// chop \n</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">chdir</span><span class="token punctuation">(</span>buf <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"cannot cd %s\n"</span><span class="token punctuation">,</span> buf <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">continue</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token function">runcmd</span><span class="token punctuation">(</span><span class="token function">parsecmd</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»è¿™é‡Œæˆ‘ä»¬çœ‹å‡ºï¼Œshellé€šè¿‡forkå­è¿›ç¨‹æ¥æ‰§è¡Œå‘½ä»¤ã€‚å¦‚æœè¿›ä¸€æ­¥çœ‹çœ‹ <code>runcmd</code> å‡½æ•°ï¼Œå°±ä¼šå‘ç°å®ƒè°ƒç”¨äº† <code>exec</code>ï¼Œå› æ­¤ shell èƒ½æ‰§è¡Œç”¨æˆ·å†™çš„ä»£ç ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼Œä»è¿™æ®µä»£ç é‡Œæˆ‘ä»¬ä¹Ÿèƒ½çœ‹å‡º <code>cd</code> æ˜¯å†…ç½®åœ¨ shell é‡Œçš„å‘½ä»¤ï¼Œè¿™æ˜¯å› ä¸º cd æ”¹å˜äº†shellè‡ªèº«çš„å·¥ä½œç›®å½•ã€‚</p><h1 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h1><p>è¿™é¢˜è®©æˆ‘ä»¬ç®€å•ç†Ÿæ‚‰ä¸‹æ¥å£ã€‚å…¶å®è¿™é‡Œç”¨ <code>printf</code> æ›´æ˜“è¯»ï¼Œä¸è¿‡æˆ‘å½“æ—¶åšçš„æ—¶å€™æ²¡å‘ç°æœ‰ <code>printf</code> </p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/types.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"user/user.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/fcntl.h"</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">char</span> <span class="token operator">*</span>errmsg <span class="token operator">=</span> <span class="token string">"sleep: missing operand\n"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> errmsg<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="pingpong"><a href="#pingpong" class="headerlink" title="pingpong"></a><strong>pingpong</strong></h1><p>è¿™é¢˜è®©æˆ‘ä»¬æ¥è§¦ä¸€ä¸‹ç®¡é“çš„ä½¿ç”¨ï¼Œéš¾è€…ä¸ä¼šï¼Œä¼šè€…ä¸éš¾</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/types.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"user/user.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/fcntl.h"</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> p_parent_sender<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> p_child_sender<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">pipe</span><span class="token punctuation">(</span>p_parent_sender<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">pipe</span><span class="token punctuation">(</span>p_child_sender<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å­è¿›ç¨‹å…ˆè¯»</span>        <span class="token function">read</span><span class="token punctuation">(</span>p_parent_sender<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d: received ping\n"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">write</span><span class="token punctuation">(</span>p_child_sender<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>p_parent_sender<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>p_parent_sender<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>p_child_sender<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>p_child_sender<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// çˆ¶è¿›ç¨‹å…ˆå†™</span>    <span class="token function">write</span><span class="token punctuation">(</span>p_parent_sender<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">read</span><span class="token punctuation">(</span>p_child_sender<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d: received pong\n"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">close</span><span class="token punctuation">(</span>p_parent_sender<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">close</span><span class="token punctuation">(</span>p_parent_sender<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">close</span><span class="token punctuation">(</span>p_child_sender<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">close</span><span class="token punctuation">(</span>p_child_sender<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="primes"><a href="#primes" class="headerlink" title="primes"></a>primes</h1><p>è¿™é¢˜å¾ˆæœ‰è¶£ï¼Œæ˜¯ä¸€ä¸ªå¹¶å‘ç´ æ•°ç­›æ³•ã€‚è¿™ä¸ªç®—æ³•ç†è®ºä¸Šæ˜¯å¯ä»¥æé«˜æ•ˆç‡çš„ï¼Œæ¯•ç«Ÿåœ¨è¿è¡Œäº†ä¸€æ®µæ—¶é—´åï¼Œå„ä¸ªè¿›ç¨‹é‡Œéƒ½æœ‰ä¸€äº›æ•°ç­‰å¾…ç­›é€‰ï¼Œè¿™æ—¶å„ä¸ªè¿›ç¨‹åœ¨åŒæ—¶ç”¨è‡ªå·±çš„ç´ æ•°ç­›é€‰è¾“å…¥çš„æ•°ã€‚</p><p><img src="/images/learning/open-course/MIT-6.S081/labs/lab1-util/prime-concurrent.png" alt=""></p><p>ç½‘ä¸Šå¾ˆå¤šä»£ç éƒ½æ˜¯2020ç‰ˆçš„ï¼Œå½“æ—¶çš„è¦æ±‚æ˜¯æ‰¾å‡º 2-35 é—´çš„ç´ æ•°ã€‚è¿™äº›ä»£ç èƒ½è¿‡è€ç‰ˆæœ¬çš„è¦æ±‚ï¼Œä½†è¿‡ä¸äº†2024ç‰ˆè¦æ±‚çš„ 2-280ã€‚æˆ‘è®¤çœŸçœ‹äº†ä¸€ä¸¤ä»½ä»£ç ï¼Œå‘ç°å®ƒä»¬åœ¨ç”¨ fork åˆ›å»ºå­è¿›ç¨‹çš„å­è¿›ç¨‹åï¼Œå¿˜äº†å…³é—­å­å­è¿›ç¨‹çš„è¿æ¥åˆ°çˆ¶è¿›ç¨‹çš„æè¿°ç¬¦ã€‚å¯ä»¥çœ‹ä¸‹é¢ç¤ºæ„å›¾çš„ç¬¬ä¸‰ä¸ªæ¡†ï¼Œè¿™äº›ä»£ç å¿˜äº†å…³é—­ child child process çš„ fd_read.</p><p>æˆ‘ç”»äº†ç¤ºæ„å›¾æ¥è§£é‡Šæˆ‘çš„ä»£ç ~</p><p><img src="/images/learning/open-course/MIT-6.S081/labs/lab1-util/prime-code.png" alt=""></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/types.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/stat.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"user/user.h"</span></span><span class="token keyword">const</span> <span class="token keyword">int</span> NUM <span class="token operator">=</span> <span class="token number">280</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">connected_fork</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">do_child</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> pid<span class="token punctuation">;</span>    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pid <span class="token operator">=</span> <span class="token function">connected_fork</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fd<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">do_child</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">int</span> n<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> n <span class="token operator">&lt;=</span> NUM<span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>n<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* * åˆ›å»ºå­è¿›ç¨‹. çˆ¶è¿›ç¨‹çš„ fd å’Œå­è¿›ç¨‹çš„ fd ä¼šè¢«åˆ†åˆ«è®¾ç½®ä¸ºä¸€ä¸ª pipe çš„ä¸¤ç«¯. * å¯¹çˆ¶è¿›ç¨‹, fd è¢«è®¾ç½®ä¸ºå†™ç«¯. * å¯¹å­è¿›ç¨‹, fd è¢«è®¾ç½®ä¸ºè¯»ç«¯. * * return 0 if is child else child's pid */</span><span class="token keyword">int</span> <span class="token function">connected_fork</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span>fd<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">pipe</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> pid<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// child</span>        <span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">*</span>fd <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// parent</span>        <span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">*</span>fd <span class="token operator">=</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> pid<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* * ä» fd_read ä¸­è¯»å–æ•°å­—, æ‰“å°ç¬¬ä¸€ä¸ªæ•°, * ç­›é€‰å…¶ä»–æ•°å¹¶æ–°å»ºå­è¿›ç¨‹æŠŠè¢«ç­›é€‰åçš„æ•°å†™å…¥å­è¿›ç¨‹. åœ¨è¿è¡Œå®Œæˆåå…³é—­ fd_read. */</span><span class="token keyword">void</span> <span class="token function">do_child</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd_read<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> prime <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>fd_read<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>n<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>prime <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            prime <span class="token operator">=</span> n<span class="token punctuation">;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"prime %d\n"</span><span class="token punctuation">,</span> prime<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">%</span> prime<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>fd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">connected_fork</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fd<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// fd == -1 ç­‰ä»·äºæ²¡æœ‰å­è¿›ç¨‹</span>                <span class="token comment">// å¦‚æœæ²¡æœ‰å­è¿›ç¨‹å°±åˆ›å»ºå­è¿›ç¨‹å¹¶è®©å®ƒå¼€å§‹å·¥ä½œ</span>                <span class="token function">close</span><span class="token punctuation">(</span>fd_read<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">do_child</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>n<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">close</span><span class="token punctuation">(</span>fd_read<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// fd == -1 ç­‰ä»·äºæ²¡æœ‰å­è¿›ç¨‹, è¯´æ˜å®ƒæ˜¯æœ€åä¸€ä¸ªè¿›ç¨‹</span>    <span class="token comment">// æœ€åä¸€ä¸ªè¿›ç¨‹ä¸éœ€è¦å…³é—­æè¿°ç¬¦, ä¹Ÿä¸éœ€è¦ç­‰å¾…</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* * ä¸ªäººè®¤ä¸ºå…³é—­ fd_read ä¸åº”è¯¥æ˜¯ do_child çš„å·¥ä½œ, æˆ‘è§‰å¾—"è°åˆ›å»º, * è°å…³é—­"ä¼šæ›´åˆé€‚. ä¹Ÿå°±æ˜¯è¯´, æˆ‘è§‰å¾—è®©è°ƒç”¨ do_child çš„å‡½æ•°å…³é—­ fd_read * æ›´åˆé€‚. * * ä½†å¦‚æœ do_child ä¸å…³é—­ fd_read, å­å­™è¿›ç¨‹å°±ä¼šä¿ç•™çˆ¶è¿›ç¨‹æœªå…³é—­çš„æè¿°ç¬¦, * ä»è€Œè€—å°½ xv6 çš„èµ„æº. */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="find"><a href="#find" class="headerlink" title="find"></a>find</h1><p>åœ¨ <code>ls.c</code> çš„åŸºç¡€ä¸Šç¨å¾®æ”¹æ”¹å°±å¥½äº†ï¼Œè¦æ³¨æ„çš„æ˜¯é€’å½’æ—¶ä¸è¦é€’å½’è¿› â€œ.â€ å’Œ â€œ..â€ ä¸¤ä¸ªæ–‡ä»¶å¤¹</p><p>æˆ‘ä»¬å®ç°çš„ <code>find &lt;path&gt; &lt;name&gt;</code> çš„åŠŸèƒ½å’Œ Linux é‡Œçš„ <code>find &lt;path&gt; -name &lt;name&gt;</code> ä¸€è‡´</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/types.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/stat.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"user/user.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/fs.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/fcntl.h"</span></span><span class="token keyword">void</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"usage: find &lt;path> &lt;filename>\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">find</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* * åœ¨ä»¥ path ä¸ºæ ¹èŠ‚ç‚¹çš„æ–‡ä»¶æ ‘ä¸‹æœç´¢åä¸º name çš„æ–‡ä»¶, * å¦‚æœæ‰¾åˆ°åˆ™æ‰“å°å…¶è·¯å¾„. */</span><span class="token keyword">void</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> fd<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"find: cannot open %s\n"</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fstat</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>st<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"find: cannot stat %s\n"</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span><span class="token function">basename</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// åªæœ‰æ–‡ä»¶å¤¹æœ‰é€’å½’çš„å¿…è¦</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>st<span class="token punctuation">.</span>type <span class="token operator">!=</span> T_DIR<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>    <span class="token keyword">struct</span> <span class="token class-name">dirent</span> de<span class="token punctuation">;</span>    <span class="token comment">// ç¬¬ä¸€ä¸ª +1 å¯¹åº” '/', ç¬¬äºŒä¸ª +1 å¯¹åº”ç»“å°¾çš„ '\0'</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> DIRSIZ <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">></span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ls: path too long\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">strcpy</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>    p <span class="token operator">=</span> buf <span class="token operator">+</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">*</span>p<span class="token operator">++</span> <span class="token operator">=</span> <span class="token char">'/'</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>de<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>de<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>de<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>de<span class="token punctuation">.</span>inum <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token function">strcmp</span><span class="token punctuation">(</span>de<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span>            <span class="token function">strcmp</span><span class="token punctuation">(</span>de<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">".."</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token function">memmove</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> de<span class="token punctuation">.</span>name<span class="token punctuation">,</span> DIRSIZ<span class="token punctuation">)</span><span class="token punctuation">;</span>        p<span class="token punctuation">[</span>DIRSIZ<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">stat</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token operator">&amp;</span>st<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ls: cannot stat %s\n"</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">find</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/* * è·å–è·¯å¾„ path çš„æœ€åä¸€éƒ¨åˆ† */</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token function">strlen</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span> p <span class="token operator">>=</span> path <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token char">'/'</span><span class="token punctuation">;</span> <span class="token operator">--</span>p<span class="token punctuation">)</span>        <span class="token punctuation">;</span>    <span class="token operator">++</span>p<span class="token punctuation">;</span>    <span class="token keyword">return</span> p<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="xargs"><a href="#xargs" class="headerlink" title="xargs"></a><strong>xargs</strong></h1><p>xargs å°†æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰æ•°æ®è½¬æ¢æˆå‘½ä»¤è¡Œå‚æ•°ï¼Œä¸€èˆ¬å’Œç®¡é“ä¸€èµ·ä½¿ç”¨ã€‚åœ¨ linux ä¸­ï¼Œxargs é»˜è®¤çš„å‘½ä»¤æ˜¯ echo.</p><p>ä¸Šé¢çš„è§£é‡Šå¯èƒ½ä¸å¤ªæ¸…æ™°ï¼Œé€šè¿‡ä¸¤ä¸ªä¾‹å­å°±èƒ½çœ‹å‡ºæ¥å®ƒåœ¨åšä»€ä¹ˆäº†ï¼š</p><p>ç¬¬ä¸€ä¸ªä¾‹å­æ˜¯ç›´æ¥ä½¿ç”¨ xargs</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">xargs</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token builtin class-name">echo</span> Im prefix<span class="token number">111</span>Im prefix <span class="token number">111</span><span class="token number">222</span>Im prefix <span class="token number">222</span>ï¼ˆæŒ‰ ctrl+D ç»ˆæ­¢è¾“å…¥<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬äºŒä¸ªä¾‹å­æ˜¯å’Œç®¡é“è”ç”¨</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token punctuation">(</span>echo <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token builtin class-name">echo</span><span class="token number">1</span><span class="token number">2</span>$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å®ç°çš„ <code>xargs &lt;command&gt;</code> çš„åŠŸèƒ½å’Œ Linux é‡Œçš„ <code>xargs -n 1 &lt;command&gt;</code> ä¸€è‡´</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/types.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"kernel/param.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"user/user.h"</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"usage: xargs command\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">char</span> <span class="token operator">*</span>cmd <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> <span class="token operator">*</span>cmdargs<span class="token punctuation">[</span>MAXARG<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> cmdargc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨æ›´æ”¹ cmdargc å‰, æœ€å¥½æ£€æŸ¥ cmdargc &lt; MAXARG,</span>                     <span class="token comment">// ä¸è¿‡ä¸ºäº†ç®€åŒ–ä»£ç , æˆ‘ä»¬å°±ä¸æ£€æŸ¥äº†</span>    <span class="token comment">// argv[0] æ˜¯ 'xargs', argv[1] æ˜¯ command, ä¹‹åæ˜¯å‚æ•°</span>    <span class="token comment">// cmdargs åº”å½“å½¢å¦‚ [command, arg1, arg2, ..., addition_arg1, ...]</span>    cmdargc <span class="token operator">=</span> argc <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cmdargc<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        cmdargs<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> argv<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å…¥è¡Œ</span>    <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> buf<span class="token punctuation">;</span> <span class="token comment">// è¾“å…¥è¡Œçš„æœ«å°¾</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>            cmdargs<span class="token punctuation">[</span>cmdargc<span class="token punctuation">]</span> <span class="token operator">=</span> buf<span class="token punctuation">;</span>            <span class="token operator">++</span>cmdargc<span class="token punctuation">;</span>            cmdargs<span class="token punctuation">[</span>cmdargc<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token operator">++</span>cmdargc<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> cmdargs<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// é‡ç½®</span>            p <span class="token operator">=</span> buf<span class="token punctuation">;</span>            cmdargc <span class="token operator">=</span> argc <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token operator">++</span>p<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;style&gt;
img{
    width: 80%;
}
&lt;/style&gt;

&lt;p&gt;åœ¨å¼€å§‹ lab ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæˆ‘ä»¬å†™çš„ä»£ç èƒ½ç›´æ¥åœ¨ xv6 çš„ shell é‡Œæ‰§è¡Œã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ &lt;code&gt;sh.c&lt;/code&gt; çš„éƒ¨åˆ†ä»£ç ï¼š&lt;/p&gt;
&lt;pre class=&quot;</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="MIT-6.S081" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/MIT-6-S081/"/>
    
    <category term="Labs" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/MIT-6-S081/Labs/"/>
    
    
  </entry>
  
  <entry>
    <title>æ…¢æ…¢åœ°å†²æµª</title>
    <link href="http://rinevard.github.io/wiki/others/thoughts/%E7%BD%91%E4%B8%8A%E5%86%B2%E6%B5%AA/"/>
    <id>http://rinevard.github.io/wiki/others/thoughts/%E7%BD%91%E4%B8%8A%E5%86%B2%E6%B5%AA/</id>
    <published>2025-05-28T03:50:11.000Z</published>
    <updated>2025-08-19T07:08:07.564Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨äº’è”ç½‘ä¸Šå†²æµªæ—¶ï¼Œå¶å°”ä¼šçœ‹åˆ°ä¸€äº›åšå®¢ï¼Œè‹¥æ˜¯å®ƒä»¬å¸®åˆ°äº†æˆ‘ï¼Œæˆ‘ç»å¸¸ä¹Ÿä¼šç‚¹è¿›ä¸»é¡µçœ‹çœ‹ä½œè€…éƒ½å†™äº†æ€æ ·çš„æ–‡ç« ï¼Œéƒ½æœ‰æ€æ ·çš„æ•…äº‹ã€‚</p><p>å¾ˆå¤šäººçš„ç½‘ç«™é‡Œå…¨æ˜¯æŠ€æœ¯æ–‡ç« ï¼Œæˆ‘å¯¹è¿™æ ·çš„ç½‘ç«™ç¡®å®æ²¡ä»€ä¹ˆå…´è‡´ã€‚æˆ‘æ›´å–œæ¬¢æ‚è°ˆç±»çš„æ–‡ç« ï¼Œé‚£ç§åƒæ˜¯åœ¨å¤œæ·±äººé™æ—¶ï¼Œç‹¬è‡ªä¸€äººåœ¨ç”µè„‘å‰æ…¢æ…¢å†™ä¸‹çš„æ–‡ç« ã€‚è¯»è¿™æ ·ç‹¬å¤„æ—¶å†™ä¸‹çš„æ–‡ç« ï¼Œæ€»è®©æˆ‘è§‰å¾—è‡ªå·±å’Œä½œè€…çš„çµé­‚æ›´è¿‘äº†ä¸€ç‚¹ã€‚</p><p>åœ¨äº’è”ç½‘ä¸Šéšæœºæ¼«æ¸¸ï¼Œå¯¹ç€å®Œå…¨ä¸è®¤è¯†è‡ªå·±çš„äººäº§ç”Ÿå•ç®­å¤´ï¼Œå¦‚æœè¿æ°”å¥½çš„è¯è¯´ä¸å®šä¼šæ˜¯åŒç®­å¤´ï¼ŒçœŸçš„éå¸¸æœ‰è¶£ã€‚æˆ‘å¯èƒ½è¿˜æ˜¯å–œæ¬¢æ…¢ä¸€ç‚¹çš„æ•…äº‹ï¼Œå–œæ¬¢æœ‰ç€å¾ˆé•¿å¾ˆé•¿å›å¤çš„è´´å­ï¼Œå–œæ¬¢æŠŠè‡ªå·±é‡è§çš„è¶£äº‹åˆ†äº«åˆ°ç½‘ä¸Šçš„è§†é¢‘ï¼Œå–œæ¬¢éšæ„çš„ã€çœŸè¯šçš„æ–‡ç« ã€‚å®ƒä»¬åªæ˜¯è¢«æ”¾åœ¨é‚£é‡Œï¼Œç­‰ç€åå¹´åè¢«å¦ä¸€ä¸ªäººå¶ç„¶å‘ç°ï¼Œé‚£æ˜¯ç—•è¿¹ã€‚</p><style>/* éšè—è‰ä¹¦ */.hidden-text {    font-size: 18px;    text-align: center;    margin: 20px 0;    /* padding: 20px; */    line-height: 1.5;    color: transparent;    cursor: default}.hidden-fancy-text::selection {    color: black;    background: white;}</style><div class="hidden-text">å°±åƒè¿™é‡Œçš„ç—•è¿¹ã€‚</div>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;åœ¨äº’è”ç½‘ä¸Šå†²æµªæ—¶ï¼Œå¶å°”ä¼šçœ‹åˆ°ä¸€äº›åšå®¢ï¼Œè‹¥æ˜¯å®ƒä»¬å¸®åˆ°äº†æˆ‘ï¼Œæˆ‘ç»å¸¸ä¹Ÿä¼šç‚¹è¿›ä¸»é¡µçœ‹çœ‹ä½œè€…éƒ½å†™äº†æ€æ ·çš„æ–‡ç« ï¼Œéƒ½æœ‰æ€æ ·çš„æ•…äº‹ã€‚&lt;/p&gt;
&lt;p&gt;å¾ˆå¤šäººçš„ç½‘ç«™é‡Œå…¨æ˜¯æŠ€æœ¯æ–‡ç« ï¼Œæˆ‘å¯¹è¿™æ ·çš„ç½‘ç«™ç¡®å®æ²¡ä»€ä¹ˆå…´è‡´ã€‚æˆ‘æ›´å–œæ¬¢æ‚è°ˆç±»çš„æ–‡ç« ï¼Œé‚£ç§åƒæ˜¯åœ¨å¤œæ·±äººé™æ—¶ï¼Œç‹¬è‡ªä¸€äººåœ¨ç”µè„‘å‰æ…¢æ…¢å†™ä¸‹çš„æ–‡ç« ã€‚è¯»è¿™æ ·ç‹¬</summary>
      
    
    
    
    <category term="æ‚è°ˆ" scheme="http://rinevard.github.io/categories/%E6%9D%82%E8%B0%88/"/>
    
    <category term="ç¢ç¢å¿µ" scheme="http://rinevard.github.io/categories/%E6%9D%82%E8%B0%88/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"/>
    
    
  </entry>
  
  <entry>
    <title>åœ¨å¼€å§‹ä¹‹å‰</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/BeforeStory/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/MIT-6.S081/BeforeStory/</id>
    <published>2025-05-27T07:20:38.000Z</published>
    <updated>2025-07-18T09:05:23.420Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘å‘ç°äº† <a href="https://arthals.ink/">Arthal</a> çš„ç¬”è®°ï¼Œæ„Ÿè§‰å†™å¾—éå¸¸ç²¾ç¾ï¼å›å¤´çœ‹çœ‹è‡ªå·±å¯¹ 15213 labs çš„ç¬”è®°ï¼Œæ„Ÿè§‰å†™å¾—ç¡®å®å¤ªç²—ç³™äº†ï¼Œå¸Œæœ›æˆ‘çš„ 6.S081 çš„ç¬”è®°ä¹Ÿèƒ½å†™å¾—è¯¦ç»†ä¸€äº›ã€‚</p><p>å’³å’³ï¼Œæˆ‘çŸ¥é“æˆ‘è¿˜æ²¡å†™ 15213 çš„ proxylabï¼Œä¸è¿‡æˆ‘æ„Ÿè§‰csappç½‘ç»œé‚£ä¸€ç« å†™å¾—æœ‰ç‚¹å«ç³Šï¼Œæ‰€ä»¥æ™šç‚¹å†åšå§ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€è¿‘å‘ç°äº† &lt;a href=&quot;https://arthals.ink/&quot;&gt;Arthal&lt;/a&gt; çš„ç¬”è®°ï¼Œæ„Ÿè§‰å†™å¾—éå¸¸ç²¾ç¾ï¼å›å¤´çœ‹çœ‹è‡ªå·±å¯¹ 15213 labs çš„ç¬”è®°ï¼Œæ„Ÿè§‰å†™å¾—ç¡®å®å¤ªç²—ç³™äº†ï¼Œå¸Œæœ›æˆ‘çš„ 6.S081 çš„ç¬”è®°ä¹Ÿèƒ½å†™å¾—è¯¦ç»†ä¸€äº›ã€‚&lt;/p&gt;
&lt;p&gt;å’³å’³ï¼Œæˆ‘çŸ¥é“æˆ‘è¿˜æ²¡å†™</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="MIT-6.S081" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/MIT-6-S081/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¬¬ä¹ç« â€”â€”è™šæ‹Ÿå†…å­˜</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Notes/Chapter9-virtual-memory/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Notes/Chapter9-virtual-memory/</id>
    <published>2025-05-13T14:10:28.000Z</published>
    <updated>2025-08-20T11:13:48.870Z</updated>
    
    <content type="html"><![CDATA[<style>img{    width: 80%;}</style><h1 id="é‡èµ°è™šæ‹Ÿè·¯"><a href="#é‡èµ°è™šæ‹Ÿè·¯" class="headerlink" title="é‡èµ°è™šæ‹Ÿè·¯"></a>é‡èµ°è™šæ‹Ÿè·¯</h1><p>è®©æˆ‘ä»¬å°è¯•é‡æ–°å‘æ˜ä¸€éè™šæ‹Ÿå†…å­˜ã€‚</p><h2 id="ä½¿ç”¨è™šæ‹Ÿåœ°å€çš„åŸå› "><a href="#ä½¿ç”¨è™šæ‹Ÿåœ°å€çš„åŸå› " class="headerlink" title="ä½¿ç”¨è™šæ‹Ÿåœ°å€çš„åŸå› "></a>ä½¿ç”¨è™šæ‹Ÿåœ°å€çš„åŸå› </h2><p>æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬åªèƒ½ç”¨ç‰©ç†åœ°å€æ¥å†™ç¨‹åºï¼Œæˆ‘ä»¬å†™å‡ºäº†ä¸‹é¢çš„ä¸œè¥¿ï¼š</p><pre class="line-numbers language-nasm" data-language="nasm"><code class="language-nasm"><span class="token comment">; å‡è®¾ç›®æ ‡æœºå™¨æ˜¯Intel 8080ï¼Œå†…å­˜åœ°å€ä¸ºç‰©ç†åœ°å€</span>ORG <span class="token number">0x0100</span>      <span class="token comment">; ç¨‹åºèµ·å§‹åœ°å€ï¼Œç›´æ¥æŒ‡å®šç‰©ç†åœ°å€0x0100</span>MVI A, <span class="token number">0x05</span>     <span class="token comment">; å°†ç«‹å³æ•°0x05åŠ è½½åˆ°å¯„å­˜å™¨A</span>STA <span class="token number">0x0200</span>      <span class="token comment">; å°†å¯„å­˜å™¨Açš„å€¼å­˜å‚¨åˆ°ç‰©ç†å†…å­˜åœ°å€0x0200</span>HLT             <span class="token comment">; åœæ­¢ç¨‹åº</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸œè¥¿çš„å¯ç§»æ¤æ€§æ˜¾ç„¶å¾ˆå·®ï¼æ‰€ä»¥æˆ‘ä»¬å‘æ˜äº†â€œè™šæ‹Ÿåœ°å€â€ã€‚è¿™æ ·ç¨‹åºå°±èƒ½ç›´æ¥ä½¿ç”¨è™šæ‹Ÿåœ°å€ï¼Œè€Œåœ¨ç¨‹åºæ‰§è¡Œæ—¶ï¼Œè™šæ‹Ÿåœ°å€è¢«æ“ä½œç³»ç»Ÿçš„<strong>MMU</strong>ï¼ˆMemory Management Unitï¼‰å®æ—¶ç¿»è¯‘æˆç‰©ç†åœ°å€ã€‚</p><h2 id="è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„"><a href="#è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„" class="headerlink" title="è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„"></a>è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„</h2><p>è¿™ä¹ˆçœ‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ MMU å½“ä½œä¸€ä¸ªä»è™šæ‹Ÿåœ°å€ç©ºé—´åˆ°ç‰©ç†åœ°å€ç©ºé—´çš„æ˜ å°„ï¼Œé‚£æˆ‘ä»¬è‡ªç„¶è¦ç”¨ä¸€ä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨æ˜ å°„ã€‚</p><p>ä½†æ€ä¹ˆç»„ç»‡è¿™ä¸ªæ•°æ®ç»“æ„å‘¢ï¼Ÿç”¨ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åæ¯ä¸ªè™šæ‹Ÿåœ°å€å¯¹åº”ä¸€ä¸ªç‰©ç†åœ°å€ï¼Ÿå‡è®¾æˆ‘ä»¬æœ‰ $M$ ä¸ªè™šæ‹Ÿåœ°å€ï¼Œæˆ‘ä»¬å°±å­˜ä¸€ä¸ªé•¿åº¦ä¸º $M$ çš„æ•°ç»„ï¼Ÿè¿™æ ·çš„è¯ï¼Œè¿™ä¸ªæ•°ç»„å°±å¤ªå¤§äº†ã€‚å‡è®¾æˆ‘ä»¬æœ‰ $k$ ä¸ªè¿›ç¨‹ï¼ŒæŒ‰è¿™ä¸ªæƒ³æ³•ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡³å°‘ $k\times M \times \text{sizeof(char *)}$ å¤§å°çš„å†…å­˜æ¥å­˜å‚¨è¿™ä¸ªæ•°æ®ç»“æ„ã€‚</p><p>æˆ‘ä»¬é€‰æ‹©æŠŠ $N$ ä¸ªè¿ç»­çš„è™šæ‹Ÿåœ°å€å½“ä½œä¸€ä¸ªè™šæ‹Ÿé¡µï¼ŒåŒæ—¶æŠŠ $N$ ä¸ªè¿ç»­çš„ç‰©ç†åœ°å€å½“ä½œä¸€ä¸ªç‰©ç†é¡µï¼Œè¿™æ ·å¯¹æ¯ä¸ªè¿›ç¨‹ï¼Œæˆ‘ä»¬å°±åªè¦åšç‰©ç†é¡µä¹‹é—´çš„æ˜ å°„ï¼Œå­˜å‚¨ $\frac{M}{N}$ ä¸ªé¡¹å°±å¥½äº†ã€‚è€ƒè™‘åˆ°ç¨‹åºçš„å±€éƒ¨æ€§ï¼Œ æˆ‘ä»¬çš„è¿™ç§é€‰æ‹©æ˜¯åˆç†çš„ã€‚è¿™æ ·çš„ä¸€ä¸ªæ•°æ®ç»“æ„å°±å«åšä¸€ä¸ª<strong>é¡µè¡¨</strong>ã€‚</p><p>åœ¨ä¸‹å›¾çš„<strong>å•çº§é¡µè¡¨</strong>ä¸­ï¼Œæ¯ä¸€é¡¹éƒ½å¸¦æœ‰ä¸€ä¸ªæœ‰æ•ˆä½ï¼ˆç”¨äºæ ‡è®°è¿™ä¸ªè™šæ‹Ÿé¡µå¯¹åº”çš„ç‰©ç†é¡µæ˜¯å¦åœ¨ DRAM ä¸­ï¼‰å’Œå¯¹åº”ç‰©ç†é¡µçš„å¼€å¤´ç‰©ç†åœ°å€ï¼ˆå¦‚æœæ²¡æœ‰å¯¹åº”ç‰©ç†é¡µï¼Œä¸º nullï¼‰ã€‚</p><p>æŠŠè™šæ‹Ÿåœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€çš„å¤§è‡´æ€è·¯æ˜¯æ ¹æ®è™šæ‹Ÿåœ°å€æ‰¾åˆ°é¡µè¡¨ä¸­å¯¹åº”çš„é¡¹ï¼Œä»è€Œæ‰¾åˆ°å¯¹åº”çš„ç‰©ç†é¡µï¼Œç„¶åæ ¹æ®è™šæ‹Ÿåœ°å€çš„æœ€åå‡ ä½ç¡®å®šå…·ä½“çš„ç‰©ç†åœ°å€ã€‚ï¼ˆè¿˜è®°å¾—å—ï¼Œä¸€ä¸ªé¡µç”±å¾ˆå¤šåœ°å€ç»„æˆï¼‰</p><p><img src="/images/learning/open-course/CMU-15213/Notes/Chapter9/singlelvelpagetable.png" alt=""></p><p>ä½†è¿™æ ·çš„é¡µè¡¨è¿˜æ˜¯å¾ˆå¤§å§ã€‚æˆ‘ä»¬æ€»åœ¨è¿›ç¨‹è¢«åˆ›å»ºæ—¶å°±ä¸ºä»–ä»¬åˆ†é…äº†ä¸€ä¸ªè¶…å¤§çš„é¡µè¡¨ï¼Œè€Œå®é™…ä¸Šç»å¤§å¤šæ•°ç¨‹åºéƒ½æ ¹æœ¬ç”¨ä¸åˆ°é‚£ä¹ˆå¤šè™šæ‹Ÿåœ°å€ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½åŠ¨æ€åœ°æ”¹å˜é¡µè¡¨çš„å¤§å°ï¼Œæ¯”å¦‚è¯´ï¼Œåœ¨ç¨‹åºè¯·æ±‚æŸä¸ªè™šæ‹Ÿåœ°å€ï¼Œä½†å®ƒä¸åœ¨é¡µè¡¨ä¸­æ—¶ï¼Œå†å»å¢å¤§é¡µè¡¨ï¼Ÿ</p><p>æ‰€ä»¥æˆ‘ä»¬è¿›ä¸€æ­¥æŠŠé¡µè¡¨åˆ†æˆå¤šçº§ï¼Œåœ¨éœ€è¦çš„æ—¶å€™å†å»æ–°å¢ level è¾ƒé«˜çš„é¡µè¡¨ã€‚</p><p>åœ¨è¿™æ ·çš„<strong>å¤šçº§é¡µè¡¨</strong>ä¸­ï¼Œåªæœ‰ level æœ€é«˜çš„é¡µè¡¨å­˜å‚¨å¯¹åº”é¡µçš„å¼€å¤´ç‰©ç†åœ°å€ï¼Œè€Œå…¶ä»– level çš„é¡µè¡¨å­˜å‚¨ä¸‹ä¸€ä¸ªçº§åˆ«çš„é¡µè¡¨çš„å¼€å§‹åœ°å€ã€‚æˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚è¯¦ç»†è®²è§£å®ƒçš„ç¿»è¯‘è¿‡ç¨‹ã€‚</p><p><img src="/images/learning/open-course/CMU-15213/Notes/Chapter9/twolevelpagetable.png" alt=""></p><p>è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œåœ¨åˆ‡æ¢åˆ°æŸä¸ªè¿›ç¨‹æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæ›´æ–°å­˜å‚¨ç€é¡µè¡¨åœ°å€çš„å¯„å­˜å™¨ï¼ˆåœ¨ RISC-â…¤ ä¸­æ˜¯ satp å¯„å­˜å™¨ï¼‰ã€‚å½“è¿›ç¨‹éœ€è¦è®¿é—®æŸä¸ªè™šæ‹Ÿåœ°å€æ—¶ï¼ŒMMU ä¼šæŠŠè™šæ‹Ÿåœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€ï¼Œç„¶åè®¿é—®ç‰©ç†åœ°å€ã€‚</p><p>è¦ç‰¹åˆ«å¼ºè°ƒçš„æ˜¯ï¼Œæ¯ä¸ª level å¯ä»¥æœ‰å¤šä¸ªé¡µè¡¨ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå¤šçº§é¡µè¡¨çœ‹ä½œæ ‘çŠ¶ç»“æ„ï¼</p><h2 id="è™šæ‹Ÿåœ°å€çš„ç¿»è¯‘"><a href="#è™šæ‹Ÿåœ°å€çš„ç¿»è¯‘" class="headerlink" title="è™šæ‹Ÿåœ°å€çš„ç¿»è¯‘"></a>è™šæ‹Ÿåœ°å€çš„ç¿»è¯‘</h2><p>æˆ‘ä»¬å·²ç»çŸ¥é“äº†è™šæ‹Ÿå†…å­˜å¤§è‡´æ˜¯æ€æ ·çš„äº†ã€‚é‚£ä¹ˆ MMU å…·ä½“æ˜¯æ€ä¹ˆæŠŠè™šæ‹Ÿåœ°å€ç¿»è¯‘æˆç‰©ç†åœ°å€çš„å‘¢ï¼Ÿæˆ‘ä»¬è¿™é‡Œè®¨è®ºå¤šçº§é¡µè¡¨ã€‚</p><p>åœ¨å¤šçº§é¡µè¡¨ä¸­ï¼Œåªæœ‰ level æœ€é«˜çš„é¡µè¡¨å­˜å‚¨å¯¹åº”é¡µçš„å¼€å¤´ç‰©ç†åœ°å€ï¼Œè€Œå…¶ä»– level çš„é¡µè¡¨å­˜å‚¨ä¸‹ä¸€ä¸ªçº§åˆ«çš„é¡µè¡¨çš„å¼€å§‹åœ°å€ã€‚</p><p>è™šæ‹Ÿåœ°å€çš„å‰å‡ ä½åœ¨ç¿»è¯‘è¿‡ç¨‹ä¸­ä¼šèµ·åˆ°â€œé¡µè¡¨ç´¢å¼•â€çš„ä½œç”¨ï¼Œå½“æˆ‘ä»¬åˆ°è¾¾äº†æŸä¸ª level çš„é¡µè¡¨ï¼Œæˆ‘ä»¬ä¼šç”¨å®ƒæ¥ç¡®å®šæˆ‘ä»¬å…·ä½“éœ€è¦è¿™ä¸ªé¡µè¡¨çš„å“ªä¸ªé¡¹ã€‚è€Œè™šæ‹Ÿåœ°å€çš„æœ€åå‡ ä½æ˜¯ä¸€ä¸ª offsetï¼Œè¿˜è®°å¾—å—ï¼Œä¸€ä¸ªè™šæ‹Ÿé¡µå’Œä¸€ä¸ªç‰©ç†é¡µå¯¹åº”ï¼Œæ‰€ä»¥åœ¨æ‰¾åˆ°äº†å¯¹åº”çš„ç‰©ç†é¡µçš„å¼€å¤´åœ°å€åï¼Œæˆ‘ä»¬è¦æ ¹æ® offset å¾—åˆ°çœŸæ­£å¯¹åº”çš„ç‰©ç†åœ°å€ã€‚</p><p>VPN æ˜¯ virtual page numberï¼ŒVPO æ˜¯ virtual page offsetï¼ŒPTE æ˜¯ page table entry</p><p><img src="/images/learning/open-course/CMU-15213/Notes/Chapter9/translation.png" alt=""></p><p>æˆ‘é­”æ”¹äº†ä¸€ä¸‹ä¸Šå›¾ï¼Œå¸Œæœ›è¿™èƒ½è®©â€œæ¯ä¸ª level æœ‰å¤šä¸ªé¡µè¡¨â€è¿™ä»¶äº‹æ˜¾å¾—æ›´æ¸…æ™°ã€‚</p><p><img src="/images/learning/open-course/CMU-15213/Notes/Chapter9/virtual2physic.png" alt=""></p><h2 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h2><p>çœ‹èµ·æ¥å¤šçº§é¡µè¡¨åœ¨å­˜å‚¨æ–¹é¢ä¼˜åŒ–å¾—ä¸é”™ï¼Œä½†é€Ÿåº¦å‘¢ï¼Ÿæ—¢ç„¶æ¯ä¸ªé¡µè¡¨éƒ½æ”¾åœ¨ä¸åŒçš„åœ°å€ï¼Œé‚£å®ƒä¸æ˜¯è¦æ±‚å¤šæ¬¡è®¿é—®ä¸åŒåœ°å€å—ï¼Ÿæ­£æ˜¯å¦‚æ­¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ TLBï¼ˆTranslation Lookaside Bufferï¼‰æ¥ç¼“å­˜æœ€è¿‘ä½¿ç”¨çš„é¡µè¡¨é¡¹ï¼Œæ¥åŠ å¿«åœ°å€ç¿»è¯‘ã€‚</p><h1 id="åŠ¨æ€å†…å­˜åˆ†é…"><a href="#åŠ¨æ€å†…å­˜åˆ†é…" class="headerlink" title="åŠ¨æ€å†…å­˜åˆ†é…"></a>åŠ¨æ€å†…å­˜åˆ†é…</h1><p>å½“æˆ‘ä»¬è°ƒç”¨ malloc å’Œ free æ—¶ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿåœ¨åšå®Œ malloclab ä»¥åï¼Œæˆ‘ä»¬å¯¹æ­¤å·²ç»æœ‰äº†æ¯”è¾ƒæ¸…æ™°çš„ç†è§£ã€‚</p><h2 id="malloc"><a href="#malloc" class="headerlink" title="malloc"></a>malloc</h2><p>è°ƒç”¨ malloc æ—¶ï¼Œæˆ‘ä»¬åœ¨å¯»æ‰¾è¶³å¤Ÿå¤§çš„ç©ºé—²å†…å­˜å—æ¥æä¾›ç»™ç”¨æˆ·ï¼Œå¦‚æœä¸å¤Ÿå¤§å°±æ‰©å®¹ã€‚åœ¨â€œå¯»æ‰¾â€çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šç§ç­–ç•¥å¯ä»¥é€‰ï¼Œè¿™å°±æ˜¯ placement policyï¼ŒåŒ…æ‹¬ä½†ä¸é™äº first fitã€next fitã€best fit.</p><p>è€Œåœ¨æ‰¾åˆ°ç©ºé—²å—ä»¥åï¼Œæœ‰æ—¶ç©ºé—²å—å¯èƒ½æ¯”ç”¨æˆ·çš„éœ€æ±‚å¤§å¾ˆå¤šï¼Œè¿™æ—¶å°±è¦æƒ³æƒ³è¦ä¸è¦åˆ‡å‰²ç©ºé—²å—ï¼Œè¿™å°±æ˜¯ splitting policyã€‚</p><h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><p>è°ƒç”¨ free æ—¶ï¼Œæˆ‘ä»¬ç®€å•åœ°æŠŠä¸€ä¸ªå·²åˆ†é…å†…å­˜å—æ ‡è®°ä¸ºç©ºé—²ã€‚ä½†ç©ºé—²ä¹‹ååˆè¦å†³å®šæ˜¯å¦æŠŠå®ƒå’Œç›¸é‚»çš„ç©ºé—²å—åˆå¹¶ï¼Œè¿™å°±æ˜¯ coalescing policyã€‚</p><h2 id="å—çš„ç»“æ„"><a href="#å—çš„ç»“æ„" class="headerlink" title="å—çš„ç»“æ„"></a>å—çš„ç»“æ„</h2><p>ä¹‹å‰æåˆ°ï¼Œmalloc æ˜¯åœ¨æ‰¾ç©ºé—²å—ï¼Œä½†ä»€ä¹ˆæ˜¯â€œå—â€å‘¢ï¼Ÿå—çš„æ•°æ®ç»“æ„ä¹Ÿæœ‰å¾ˆå¤šç§å¯ä»¥é€‰ï¼Œä¸è¿‡ä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªå—éƒ½è‡³å°‘ä¼šæœ‰ size å’Œ is_alloc æ ‡è®°ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨æ˜¾å¼é“¾è¡¨ç­–ç•¥æ—¶ï¼Œæˆ‘ä»¬çš„å †å¤§æ¦‚é•¿è¿™æ ·ï¼š</p><p><img src="/images/learning/open-course/CMU-15213/Notes/Chapter9/heap.svg" alt=""></p>]]></content>
    
    
      
      
    <summary type="html">&lt;style&gt;
img{
    width: 80%;
}
&lt;/style&gt;

&lt;h1 id=&quot;é‡èµ°è™šæ‹Ÿè·¯&quot;&gt;&lt;a href=&quot;#é‡èµ°è™šæ‹Ÿè·¯&quot; class=&quot;headerlink&quot; title=&quot;é‡èµ°è™šæ‹Ÿè·¯&quot;&gt;&lt;/a&gt;é‡èµ°è™šæ‹Ÿè·¯&lt;/h1&gt;&lt;p&gt;è®©æˆ‘ä»¬å°è¯•é‡æ–°å‘æ˜ä¸€éè™šæ‹Ÿå†…å­˜ã€‚&lt;</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="CMU-15-213" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/"/>
    
    <category term="Notes" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/Notes/"/>
    
    
  </entry>
  
  <entry>
    <title>Malloclabå’Œæˆ‘ä¸å¾—ä¸è¯´çš„é‚£äº›äº‹</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Labs/Malloclab/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Labs/Malloclab/</id>
    <published>2025-05-12T11:28:38.000Z</published>
    <updated>2025-07-20T10:04:20.287Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>malloclab çš„éš¾åº¦å¾ˆå¤§ï¼Œæˆ‘å®ç°äº†ä¹¦ä¸Šçš„åŸºç¡€çš„éšå¼ç©ºé—²é“¾è¡¨å’Œæ˜¾å¼ç©ºé—²é“¾è¡¨ï¼Œç”¨æ—¶çº¦ 16 å°æ—¶ï¼Œå¾—åˆ†å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">Perf index &#x3D; 47 (util) + 40 (thru) &#x3D; 87&#x2F;100<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®ç°çš„é€»è¾‘æœ¬èº«æ˜¯ç®€å•çš„ï¼Œéš¾åº¦æœ€å¤§çš„åœ°æ–¹åœ¨äºè°ƒè¯•ï¼Œæ‰€ä»¥æˆ‘å¹¶æ²¡æœ‰è¿›ä¸€æ­¥å®ç°åˆ†ç¦»çš„ç©ºé—²é“¾è¡¨ï¼Œå› ä¸ºè°ƒè¯•èµ·æ¥å®åœ¨æ˜¯å¤ªéº»çƒ¦äº†ã€‚ç®—æ˜¯ä½“éªŒäº†ä¸€ä¸‹ç³»ç»Ÿçº§ç¼–ç¨‹çš„å¤æ‚æ€§ã€‚</p><p>æœ‰è¶£çš„æ˜¯ï¼Œç”±äº fail fast çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œæˆ‘å–œæ¬¢åœ¨ä»£ç é‡Œåˆ°å¤„æ”¾ assert å’Œ print è¯­å¥ï¼Œè¿™å¸®æˆ‘èŠ‚çœäº†ä¸å°‘è°ƒè¯•æ—¶é—´ï¼Œæˆ‘ç”šè‡³ä¸€æ¬¡ gdb éƒ½æ²¡ç”¨å°±æŠŠæ‰€æœ‰çš„ bug éƒ½ä¿®å®Œäº†ã€‚ï¼ˆè¯è¯´å›æ¥æˆ‘ä¹Ÿä¸çŸ¥é“è¿™ç§ä¸œè¥¿æ€ä¹ˆç”¨ gdb è°ƒè¯•ï¼‰</p><p>æœ¬æ–‡ä¼šè°ˆè°ˆåšè¿™ä¸ª lab æ—¶å­¦åˆ°çš„ä¸€äº›ç¼–ç¨‹æŠ€å·§ï¼Œä¸ä¼šå¤ªå¤šè°ˆ lab æœ¬èº«ï¼Œå› ä¸ºç…§ç€ä¹¦ä¸Šå®ç°å‡ºæ¥å°±å¥½äº†ã€‚</p><h1 id="å®ç¼–ç¨‹"><a href="#å®ç¼–ç¨‹" class="headerlink" title="å®ç¼–ç¨‹"></a>å®ç¼–ç¨‹</h1><p>å®ç¼–ç¨‹æœ€éœ€è¦å…³æ³¨çš„åœ°æ–¹å°±æ˜¯åˆ°å¤„éƒ½è¦åŠ æ‹¬å·ã€‚è®©æˆ‘ä»¬ä»¥ä¸‹é¢è¿™è¡Œä»£ç ä¸ºä¾‹ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">GET</span><span class="token expression"><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span> <span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åƒè¿™ç§å°±æ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºæ²¡ç»™ p åŠ æ‹¬å·ï¼æ¯”å¦‚è¯´ï¼ŒGET((char *)bp - WSIZE) çš„åŸæœ¬æ„å›¾æ˜¯è®© bp å‡å» WSIZEï¼Œä½†æ”¾åˆ° GET é‡Œå°±å¯¼è‡´ bp å…ˆè¢«è½¬æ¢æˆ unsigned int æŒ‡é’ˆï¼Œå†å‡å» WSIZEï¼Œä»è€Œè®© bp å‡å»äº† WSIZE * sizeof(unsigned int)ï¼</p><h1 id="validation-check"><a href="#validation-check" class="headerlink" title="validation_check"></a>validation_check</h1><p>è¿™ä¸ª lab å¯ä»¥çœ‹ä½œåœ¨åˆ›å»ºä¸€ä¸ªç¥å¥‡çš„ç±»ï¼Œæˆ‘ä»¬æ€»ä¼šå¯¹ç±»æœ‰ä¸€äº› validation è¦æ±‚ï¼ˆæ¯”å¦‚è¯´åœ¨è¿™ä¸ª lab ä¸­ï¼Œæˆ‘ä»¬è¦æ±‚å†…å­˜é‡Œä¸èƒ½æœ‰è¿ç»­çš„ç©ºé—²å—ï¼‰ï¼Œè¿™æ—¶æˆ‘ä»¬å°±å¯ä»¥å†™ä¸€ä¸ª validation_check å‡½æ•°ï¼Œå®ƒä¼šæ£€æŸ¥è¿™ä¸ªç±»æ˜¯å¦æ»¡è¶³æˆ‘ä»¬çš„ validation è¦æ±‚ã€‚</p><p>é‚£è¿™ä¸ª validation_check æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿåœ¨è°ƒè¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ’å…¥åˆ°å„ç§åœ°æ–¹ï¼Œç„¶åçœ‹å®ƒåœ¨å“ªé‡Œ failï¼Œè¿™èƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¿«å®šä½ bugã€‚ä¸€ä¸ªå°æŠ€å·§æ˜¯ç”¨äºŒåˆ†çš„æ€è·¯æ¥æ’å…¥ validation_checkã€‚</p><h1 id="å…¶ä»–å°æŠ€å·§"><a href="#å…¶ä»–å°æŠ€å·§" class="headerlink" title="å…¶ä»–å°æŠ€å·§"></a>å…¶ä»–å°æŠ€å·§</h1><p>å†™è¿™ä¸ª lab çš„æ—¶å€™ç”¨åˆ°äº†å¾ˆå¤š 6.102 çš„çŸ¥è¯†ï¼Œæœç„¶è½¯å·¥çŸ¥è¯†è¶…æœ‰ç”¨~æ¯”å¦‚è¯´ï¼Œå†™ä¸€ä¸ªç®€ç»ƒæ¸…æ™°çš„ specification å¾ˆæœ‰å¸®åŠ©ï¼Œfail fast ç‰¹åˆ«æœ‰ç”¨ã€‚</p><p>è¿˜æ³¨æ„åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„åœ°æ–¹ï¼Œ<code>size_t</code> åœ¨æˆ‘çš„ç³»ç»Ÿä¸Šæ˜¯è¿™æ ·æ˜¾ç¤ºçš„ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token class-name">size_t</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ® claude è¯´ï¼Œ<code>size_t</code> çš„å…·ä½“å®šä¹‰å–å†³äºç³»ç»Ÿæ¶æ„ï¼Œè¿™å¯èƒ½æ˜¯ä¸ºäº†å¯ç§»æ¤æ€§è€ƒè™‘ï¼Ÿ</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘è§‰å¾—è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä½œç”¨ï¼Œå°±æ˜¯ç»™ç±»å‹æä¾›â€œåˆ«åâ€ã€‚æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›ç±»å‹æœ‰ä¸€ä¸ªæ›´å…·æè¿°æ€§çš„åç§°ï¼Œè€Œä¸åªæ˜¯â€œintâ€ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h1&gt;&lt;p&gt;malloclab çš„éš¾åº¦å¾ˆå¤§ï¼Œæˆ‘å®ç°äº†ä¹¦ä¸Šçš„åŸºç¡€çš„éšå¼ç©ºé—²é“¾è¡¨å’Œæ˜¾å¼ç©ºé—²é“¾è¡¨ï¼Œç”¨æ—¶çº¦ 16 å°æ—¶ï¼Œå¾—åˆ†å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;p</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="CMU-15-213" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/"/>
    
    <category term="Labs" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/Labs/"/>
    
    
  </entry>
  
  <entry>
    <title>Ludum Dareå‚åŠ æŒ‡å—</title>
    <link href="http://rinevard.github.io/wiki/game-design/ldjam%E5%8F%82%E8%B5%9B%E6%8C%87%E5%8D%97/"/>
    <id>http://rinevard.github.io/wiki/game-design/ldjam%E5%8F%82%E8%B5%9B%E6%8C%87%E5%8D%97/</id>
    <published>2025-04-13T01:36:38.000Z</published>
    <updated>2025-07-20T09:55:53.012Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é›¶ã€åœ¨æ–‡ç« å¼€å§‹ä¹‹å‰"><a href="#é›¶ã€åœ¨æ–‡ç« å¼€å§‹ä¹‹å‰" class="headerlink" title="é›¶ã€åœ¨æ–‡ç« å¼€å§‹ä¹‹å‰"></a>é›¶ã€åœ¨æ–‡ç« å¼€å§‹ä¹‹å‰</h1><p>æœ¬æ–‡åŒ…å«äº†å¯¹ Ludum Dare çš„ä»‹ç»ã€å‚ä¸æµç¨‹åŠä¸ªäººçœ‹æ³•ã€‚å†™ä½œçš„å¥‘æœºæ˜¯å‚ä¸ Ludum Dare åä½“éªŒå¾ˆå¥½ï¼Œä½†åœ¨ä¸­æ–‡äº’è”ç½‘ä¸Šæ²¡æœ‰æ‰¾åˆ°å¾ˆå…¨é¢çš„ä»‹ç»èµ„æ–™ï¼Œåªæ‰¾åˆ°äº† <a href="https://zhuanlan.zhihu.com/p/20337558">è§„åˆ™ä»‹ç»</a>ã€‚åœ¨è§„åˆ™ä»‹ç»ä¹‹å¤–ï¼Œæˆ‘å¸Œæœ›èŠèŠ Ludum Dare çš„ä½“éªŒä¸ºä»€ä¹ˆå¥½ï¼ˆæ¯”èµ·æˆ‘å‚åŠ è¿‡çš„å…¶ä»– gamejamï¼‰ï¼Œå¹¶æŒ‰æ—¶é—´çº¿ä»‹ç»ä¸€ä¸‹å‚ä¸æµç¨‹ã€‚</p><h1 id="ä¸€ã€ä»€ä¹ˆæ˜¯-Ludum-Dare"><a href="#ä¸€ã€ä»€ä¹ˆæ˜¯-Ludum-Dare" class="headerlink" title="ä¸€ã€ä»€ä¹ˆæ˜¯ Ludum Dare"></a>ä¸€ã€ä»€ä¹ˆæ˜¯ Ludum Dare</h1><p>å®˜ç½‘å†™åˆ°ï¼Œâ€Ludum Dare is an event where you create a game from scratch in a weekend based on a theme.â€ï¼ˆå‡ºè‡ª <a href="https://ludumdare.com/resources/archive/rules-2017/">rules</a>ï¼‰ï¼Œå³â€œLudum Dare æ˜¯ä¸€ä¸ªå›´ç»•æŸä¸ªä¸»é¢˜åœ¨ä¸€ä¸ªå‘¨æœ«ä»é›¶å¼€å§‹åšå‡ºä¸€ä¸ªæ¸¸æˆçš„æ´»åŠ¨ã€‚â€æ›´å…·ä½“ä¸€ç‚¹ï¼ŒLudum Dare ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªèµ›é“ï¼Œåˆ†åˆ«æ˜¯å•äºº 48 å°æ—¶åšä¸€ä¸ªæ¸¸æˆå’Œç»„é˜Ÿ 72 å°æ—¶åšä¸€ä¸ªæ¸¸æˆã€‚</p><p>è¿™æ—¶å€™æœ‰ç»éªŒçš„è¯»è€…å°±ä¼šé—®äº†ï¼Œè¿™ä¸å°±æ˜¯ gamejam å—ï¼Ÿæ­£æ˜¯å¦‚æ­¤ï¼Ludum Dare æ˜¯éå¸¸æ—©æœŸçš„ gamejamï¼Œå®ƒè‡ª 2002 å¹´å¼€å§‹ä¸¾åŠï¼Œæ¯å¹´ä¸¾åŠä¸¤æ¬¡ï¼Œåˆ°ä»Šå¤©å·²ç»åŠäº† 57 å±Šã€‚æ¯å±Š Ludum Dare éƒ½ä¼šå¸å¼•å…¨çƒæ•°ä»¥ä¸‡è®¡çš„å¼€å‘è€…ï¼Œå¦‚ 2021 å¹´çš„ 49 å±Šæ”¶åˆ°äº†è¿‘ 3000 æ¬¾æ¸¸æˆæäº¤ï¼Œ 2023 å¹´çš„ç¬¬ 52 å±Šæ”¶åˆ°äº† 1632 æ¬¾æ¸¸æˆæäº¤ï¼ˆ<a href="https://github.blog/open-source/gaming/a-peek-inside-some-of-the-top-games-from-ludum-dare-49/">æ•°æ®æ¥æº</a>ï¼‰ã€‚åœ¨è¿™å¤§é‡çš„æäº¤æ¸¸æˆä¸­ï¼Œä¹Ÿæœ‰è®¸å¤šç²¾å“ä½œå“ä»æ­¤å‘æºï¼Œæ¯”å¦‚é‚ªæ¶é“­åˆ»ï¼ˆinscryptionï¼‰çš„åŸå‹ <a href="https://ldjam.com/events/ludum-dare/43/sacrifices-must-be-made-2">Sacrifices Must Be Made</a> å°±äº Ludum Dare 43 åˆ¶ä½œã€‚</p><h1 id="äºŒã€ä¸ºä»€ä¹ˆå‚åŠ -Ludum-Dare"><a href="#äºŒã€ä¸ºä»€ä¹ˆå‚åŠ -Ludum-Dare" class="headerlink" title="äºŒã€ä¸ºä»€ä¹ˆå‚åŠ  Ludum Dare"></a>äºŒã€ä¸ºä»€ä¹ˆå‚åŠ  Ludum Dare</h1><p>ä¸­å›½æœ‰é‚£ä¹ˆå¤šæœ¬åœŸçš„ gamejamï¼Œé‚£ä¸ºä»€ä¹ˆè¦é¡¶ç€è¯­è¨€éšœç¢å‚åŠ  Ludum Dare å‘¢ï¼Ÿæˆ‘è®¤ä¸ºæœ€é‡è¦çš„ä¸¤ç‚¹æ˜¯æ¸¸æˆè´¨é‡é«˜ã€æ”¶è·åé¦ˆå¤šã€‚</p><p>å…ˆè¯´å‰è€…ï¼Œgamejam æ€»æ˜¯æœ‰ç«èµ›æ€§è´¨çš„ï¼Œåœ¨ Ludum Dare é‡Œæˆ‘ä»¬è¦å’Œå…¨ä¸–ç•Œçš„ä¼˜ç§€å¼€å‘è€…ç«äº‰ï¼Œå•æ˜¯çœ‹ç€è¿™äº›å¼€å‘è€…å›´ç»•ä¸»é¢˜çš„å¥‡æ€å¦™æƒ³å°±å·²ç»è®©äººè§‰å¾—å€¼å›ç¥¨ä»·äº†ï¼ˆå¹¶æ²¡æœ‰ç¥¨ä»·ï¼Œè¿™æ˜¯å…è´¹æ´»åŠ¨ï¼‰ï¼Œè€Œå¦‚æœå–å¾—äº†å¥½æ’ååˆ™æ›´æ˜¯ä¼šç»™äººç›¸å½“çš„æˆå°±æ„Ÿã€‚</p><p>å†è¯´åè€…ï¼Œä»‹äº Ludum Dare çš„ç®—æ³•ï¼Œæ¯ä¸ªæ¸¸æˆåŸºæœ¬éƒ½ä¼šè·å¾— 20 ä¸ªä»¥ä¸Šçš„è¯„åˆ†ï¼Œè€Œä¸”ä½ ç©çš„æ¸¸æˆè¶Šå¤šï¼ŒLudum Dare å°±ä¼šæŠŠä½ çš„æ¸¸æˆæ”¾åœ¨æ¨èæ¦œè¶Šé å‰çš„ä½ç½®ï¼Œä»è€Œå°±ä¼šæœ‰è¶Šå¤šäººç©ä½ çš„æ¸¸æˆã€‚ä»¥æˆ‘çš„ç»éªŒæ¥çœ‹ï¼Œç©çš„æ¸¸æˆæ•°é‡å’Œæ”¶è·çš„è¯„åˆ†æ•°é‡åŸºæœ¬æ¥è¿‘ï¼Œè€Œä¸”å¾ˆå¤šç©äº†æˆ‘ä»¬æ¸¸æˆçš„å¼€å‘è€…ä¼šåœ¨æ¸¸æˆä¸‹ç»™å‡ºè¯„è®ºæ¥åé¦ˆï¼Œéå¸¸åˆ©äºæˆ‘ä»¬äº†è§£è‡ªå·±æ¸¸æˆçš„ä¼˜ç§€ä¹‹å¤„ï¼ˆå¯æƒœçš„æ˜¯è¯„è®ºä¸€èˆ¬ä¸è¯´ç¼ºç‚¹ï¼Œä»¥å¤¸å¤¸å±…å¤šï¼‰ã€‚</p><p>ä¸‹é¢å†ä¸¾å‡ ä¸ª Ludum Dare çš„å…¶ä»–ä¼˜åŠ¿ï¼š</p><ul><li>è¶³ä¸å‡ºæˆ·ï¼šä¸çº¿ä¸‹ gamejam ä¸åŒï¼Œå‚åŠ  Ludum Dare æ— éœ€æŠ¥åï¼Œåªè¦æ³¨å†Œè´¦å·å¹¶åœ¨æäº¤æ—¶é—´æˆªæ­¢å‰æäº¤æ¸¸æˆå³å¯ã€‚</li><li>ç©æ¸¸æˆæ–¹ä¾¿ï¼šå¤§éƒ¨åˆ†å¼€å‘è€…éƒ½ä¼šæä¾›æ¸¸æˆçš„ web ç‰ˆæœ¬ï¼Œå³ä½¿ä¸æä¾› web ç‰ˆæœ¬ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å¯¹åº”çš„æ¸¸æˆé¡µé¢ä¸‹è½½æ¸¸æˆã€‚</li><li>äº¤æµæœºä¼šï¼šæˆ‘ä»¬å¯ä»¥ç»™åˆ«çš„æ¸¸æˆæä¾›åé¦ˆï¼Œä¹Ÿå¯ä»¥åœ¨åˆ«çš„æ¸¸æˆè¯„è®ºåŒºé‡Œè¯¢é—®å¼€å‘è€…çš„è®¾è®¡æ€è·¯ï¼Œä¸€èˆ¬éƒ½ä¼šæ”¶åˆ°ç§¯æçš„å›å¤ã€‚</li><li>å’Œå¤§ç¥åˆå½±ï¼šæ¯å±Šçš„ Ludum Dare éƒ½ä¼šæœ‰ä¸€äº›å¤§ç¥æ¥å‚åŠ ï¼Œå¦‚æœæ°å·§ç¢°ä¸Šäº†è‡ªå·±æ„Ÿå…´è¶£çš„å¤§ç¥ï¼Œå°±æœ‰äº†åœ¨ä»–ä»¬çš„æ¸¸æˆè¯„è®ºåŒºå¤¸å¤¸çš„åˆå½±æœºä¼šï¼</li></ul><h1 id="ä¸‰ã€å‚ä¸æµç¨‹"><a href="#ä¸‰ã€å‚ä¸æµç¨‹" class="headerlink" title="ä¸‰ã€å‚ä¸æµç¨‹"></a>ä¸‰ã€å‚ä¸æµç¨‹</h1><p>Ludum Dare çš„æµç¨‹å¤§æ¦‚æ˜¯ä¸»é¢˜æŠ•ç¥¨ã€åˆ¶ä½œã€è¯„åˆ†ä¸åé¦ˆã€ç»“æœå…¬å¸ƒã€‚ä¸ºäº†é¡ºåˆ©å‚èµ›ï¼Œé¦–å…ˆæˆ‘ä»¬è¦åœ¨ Ludum Dare ä¸Šæ³¨å†Œä¸€ä¸ªè´¦å·ã€‚æ³¨å†Œè´¦å·éœ€è¦é‚€è¯·ç ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Google ä¸Šç”¨ ludum dare invitation code ä¹‹ç±»çš„å…³é”®è¯æˆ–è€…åœ¨<a href="https://ldjam.com/users/pov/feed">ä¸¾åŠè€…çš„ä¸»é¡µ</a>ä¸Šæ‰¾åˆ°é‚€è¯·ç ã€‚æˆ‘æ‰¾åˆ°çš„ç¬¬ 57 å±Šçš„é‚€è¯·ç æœ‰ Time4LD57 å’Œ BirdSiteLD57ã€‚</p><p>åœ¨æ³¨å†ŒæˆåŠŸä¹‹åï¼Œæˆ‘ä»¬è¦æƒ³æƒ³è¿™æ¬¡æ˜¯å•äººå‚èµ›è¿˜æ˜¯ç»„é˜Ÿå‚èµ›ã€‚Ludum Dare æœ‰ä¸‰æ¡èµ›é“ï¼ŒCompoã€Jam å’Œ Extra.</p><p>Compo æ˜¯ç»å…¸æ¨¡å¼ï¼Œè¦æ±‚å•äºº 48 å°æ—¶å†…åšæ¸¸æˆï¼Œæ‰€æœ‰å†…å®¹åŒ…æ‹¬ç¾æœ¯ã€éŸ³æ•ˆç­‰éƒ½éœ€è¦åœ¨ 48 å°æ—¶å†…ä»é›¶å¼€å§‹åšå‡ºï¼Œè€Œä¸”å¿…é¡»å¼€æºæºä»£ç ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»»ä½•å·²ç»å†™è¿‡çš„åŸºç¡€ä»£ç å’Œä»»ä½•å·¥å…·ã€‚å¦‚æœä½ çš„æ¸¸æˆæ”¶åˆ°äº† 20 ä¸ªä»¥ä¸Šçš„è¯„åˆ†ï¼Œä¼šå¾—åˆ°æœ€ç»ˆè¯„åˆ†ã€‚</p><p>Jam ç›¸å¯¹å®½æ¾ï¼Œåªè¦æ±‚ç»„é˜Ÿ 72 å°æ—¶å†…åšæ¸¸æˆï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•å·²ç»å†™è¿‡çš„åŸºç¡€ä»£ç ï¼Œä¹Ÿå…è®¸ä½¿ç”¨éƒ¨åˆ†é¢„åˆ¶ç´ æã€‚è‹¥ç¾æœ¯æˆ–éŸ³æ•ˆéåŸåˆ›ï¼Œéœ€è¦åœ¨æäº¤æ—¶å…³é—­å¯¹åº”ç±»åˆ«çš„æ‰“åˆ†ã€‚æ¯”å¦‚å¦‚æœæˆ‘ä»¬ç”¨äº†ç¬¬ä¸‰æ–¹ç¾æœ¯ï¼Œå°±è¦åœ¨æäº¤æ—¶å…³é—­ Graphics çš„æ‰“åˆ†ã€‚å¦‚æœä½ çš„æ¸¸æˆæ”¶åˆ°äº† 20 ä¸ªä»¥ä¸Šçš„è¯„åˆ†ï¼Œä¼šå¾—åˆ°æœ€ç»ˆè¯„åˆ†ã€‚</p><p>Extra åˆ™æ˜¯è½»æ¾ç»„ï¼Œæ—¶é—´å®½è£•è‡³ 3 å‘¨ï¼Œå•äººæˆ–å›¢é˜Ÿå‡å¯ï¼Œå†…å®¹ä»¥åŸåˆ›ä¸ºä¸»ä½†å…è®¸é¢„åˆ¶ç´ æï¼Œç¾æœ¯æˆ–éŸ³æ•ˆéåŸåˆ›å¯é€€å‡ºå¯¹åº”è¯„åˆ†ç±»åˆ«ï¼Œæºä»£ç æäº¤å¯é€‰ï¼Œä½†æ— æœ€ç»ˆæ’åã€‚</p><p>èµ›é“åœ¨æäº¤æ—¶æ‰éœ€è¦ç¡®å®šï¼Œæ‰€ä»¥å¦‚æœä½ åŸæœ¬æ‰“ç®—å‚åŠ  Compoï¼Œä½†æ²¡æ¥å¾—åŠèµ¶ä¸Š Compo çš„æˆªæ­¢æäº¤æ—¶é—´ï¼Œä¹Ÿå¯ä»¥è½¬å» Jam çš„æäº¤ã€‚</p><p>æƒ³å¥½äº†èµ›é“åï¼Œå°±èƒ½è¿›å…¥ä¹‹åçš„ç¯èŠ‚äº†ã€‚</p><h2 id="ä¸»é¢˜æŠ•ç¥¨"><a href="#ä¸»é¢˜æŠ•ç¥¨" class="headerlink" title="ä¸»é¢˜æŠ•ç¥¨"></a>ä¸»é¢˜æŠ•ç¥¨</h2><p>å®˜æ–¹ä¼šæä¾›å¤§é‡çš„ä¸»é¢˜ï¼ˆç¬¬ 57 å±Šæœ‰ 1000 å¤šä¸ªï¼‰ï¼Œç»è¿‡åˆé€‰è½®ã€å¤é€‰è½®ã€å†³èµ›è½®ï¼Œæœ€ç»ˆå¾—å‡ºä¸€ä¸ªç»“æœä¸»é¢˜ã€‚æˆ‘ä»¬å½“ç„¶ä¸å¿…ç»™æ¯ä¸ªä¸»é¢˜éƒ½æŠ•ç¥¨ï¼Œæˆ‘çš„ä¸ªäººå»ºè®®æ˜¯åœ¨å†³èµ›è½®æŠ•ä¸€ä¸‹å°±è¡Œã€‚è€Œä¸”å³ä½¿ä¸æŠ•ç¥¨ä¹Ÿæ˜¯èƒ½å‚èµ›çš„ï¼å‚èµ›çš„å”¯ä¸€è¦æ±‚å°±æ˜¯åœ¨æäº¤æ—¶é—´æˆªæ­¢å‰æäº¤ä½œå“ã€‚</p><p>æ˜¯å¦å›´ç»•ä¸»é¢˜åšæ¸¸æˆä¹Ÿæ˜¯å¯é€‰çš„ï¼Œä¸»é¢˜åªæ˜¯æœ€ç»ˆè¯„åˆ†ä¸­çš„ä¸€éƒ¨åˆ†ï¼ŒLudum Dare çš„å®—æ—¨æ˜¯é¼“åŠ±å¼€å‘è€…æŠŠæ¸¸æˆåšå‡ºæ¥ã€‚</p><h2 id="åˆ¶ä½œé˜¶æ®µ"><a href="#åˆ¶ä½œé˜¶æ®µ" class="headerlink" title="åˆ¶ä½œé˜¶æ®µ"></a>åˆ¶ä½œé˜¶æ®µ</h2><p>è¿›å…¥åˆ¶ä½œé˜¶æ®µåï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹åšæ¸¸æˆäº†ï¼ç‚¹å‡»å³ä¸Šè§’çš„ join eventï¼Œå°±èƒ½åˆ›å»ºæ¸¸æˆè‰ç¨¿é¡µã€‚æˆ‘ä»¬ä¼šåœ¨ä¸Šä¼ é˜¶æ®µå¡«å……è¿™ä¸ªè‰ç¨¿é¡µã€‚</p><p><img src="/images/game-design/gamejam/ldjamå‚èµ›æŒ‡å—/ldjam-joinevent.png" alt=""></p><p>åˆ¶ä½œæ¸¸æˆéœ€è¦å¤§å®¶å„æ˜¾ç¥é€šï¼Œæˆ‘ç®€å•è°ˆè°ˆä¸ªäººå»ºè®®å§ã€‚</p><ul><li>è®¾è®¡<br>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬è¦å¿«é€Ÿåœ°æ‰¾åˆ°å¤šä¸ªæƒ³æ³•ï¼Œç„¶åé€‰æ‹©è‡ªå·±è§‰å¾—æœ€æœ‰å‰é€”çš„æƒ³æ³•åšä¸‹å»ã€‚ç”±äºåˆ¶ä½œæ—¶é—´å¾ˆç´§ï¼Œæˆ‘ä»¬æ³¨å®šä¸èƒ½åšå¤§åšå…¨ã€‚æ¯”èµ·å¤§è€Œå…¨ï¼Œå°è€Œç¾æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚ä¸€ä¸ªåªæœ‰ä¸‰å…³çš„è®¤çœŸæ‰“ç£¨è¿‡çš„ä½œå“æ¯”ä¸€ä¸ªæœ‰åå…³çš„æ¯å…³éƒ½å¾ˆç²—ç³™çš„ä½œå“è¦å¥½å¾—å¤šã€‚</li><li>ç¨‹åº<br>å°½ç®¡ Ludum Dare å…è®¸è®¾è®¡æ¡Œæ¸¸ä¹ƒè‡³æ›´ä¸è¢«å®šä¹‰çš„æ¸¸æˆï¼ˆæˆ‘è§è¿‡ä¸€ä¸ªç¿»æ–‡ä»¶å¤¹çš„æ¸¸æˆï¼‰ï¼Œä½†æˆ‘ä»¬è¿™é‡Œåªè®¨è®ºç”µå­æ¸¸æˆã€‚ç¨‹åºæ–¹é¢ï¼Œé€‰ç”¨è‡ªå·±æœ€ç†Ÿæ‚‰çš„å·¥å…·å³å¯ã€‚æœ‰ç†Ÿç»ƒçš„æ¸¸æˆå¼•æ“å°±é€‰æ¸¸æˆå¼•æ“ï¼Œå–œæ¬¢ä¸ç”¨å¼•æ“å¼€å‘å°±ä¸ç”¨å¼•æ“å¼€å‘ã€‚</li><li>éŸ³ä¹<br>æˆ‘æ˜¯éŸ³ä¹èŒæ–°ï¼Œè™½ç„¶å¬è¯´è¿‡ FL studio ä¹‹ç±»çš„å·¥ä½œç«™ï¼Œä½†æˆ‘ç°åœ¨è¿˜æ²¡å­¦ä¼šã€‚æ‰€ä»¥æˆ‘è¿™é‡Œæ¨èä¸€ä¸ªç®€å•çš„éŸ³ä¹åˆ¶ä½œç½‘ç«™â€”â€”<a href="https://musiclab.chromeexperiments.com/">Musiclab</a>ï¼Œæˆ‘ä½¿ç”¨é‡Œé¢çš„<a href="https://musiclab.chromeexperiments.com/Song-Maker">SongMaker</a>åšå‡ºäº†èƒ½å¬çš„ä¸œè¥¿ã€‚</li><li>éŸ³æ•ˆ<br><a href="https://sfxr.me/">sfxr</a>æ˜¯å¾ˆç®€å•çš„éŸ³æ•ˆåˆ¶ä½œç½‘ç«™ï¼Œæˆ‘çœ‹ä¸æ‡‚å‚æ•°ï¼Œæ‰€ä»¥æˆ‘çš„å·¥ä½œæµæ˜¯æŠŠæˆ‘æƒ³è¦çš„æ•ˆæœå‘Šè¯‰ AIï¼ŒAI å‘Šè¯‰æˆ‘æ€ä¹ˆè°ƒå‚ï¼Œæ•ˆæœå‡ºä¹æ„æ–™åœ°è¿˜ç®—ä¸é”™ã€‚</li><li>ç¾æœ¯<br>æˆ‘ç”¨<a href="https://www.piskelapp.com/">Piskel</a>ç”»ç®€å•çš„åƒç´ ç”»ï¼Œå¶å°”ä¹Ÿç”¨<a href="https://krita.org/">Krita</a>æ¥ç”»åˆ«çš„ä¸œè¥¿ã€‚</li></ul><p>æŠ›å¼€ Extra èµ›é“ä¸è°ˆï¼Œè¿™ä¸ªé˜¶æ®µæŒç»­ 48 å°æ—¶æˆ– 72 å°æ—¶ï¼Œæˆ‘æœ€åçš„å»ºè®®æ˜¯åœ¨å‚ä¸çš„åŒæ—¶ä¿æŒå……è¶³çš„ç¡çœ ï¼Œå¥½å¥½ç¡è§‰å¥½å¥½åƒé¥­å¾ˆé‡è¦ï¼</p><h2 id="ä¸Šä¼ é˜¶æ®µ"><a href="#ä¸Šä¼ é˜¶æ®µ" class="headerlink" title="ä¸Šä¼ é˜¶æ®µ"></a>ä¸Šä¼ é˜¶æ®µ</h2><p>åœ¨åˆ¶ä½œé˜¶æ®µç»“æŸåï¼Œä¼šç»™<strong>é¢å¤–çš„ä¸€å°æ—¶</strong>æ¥ä¸Šä¼ ã€‚å°½ç®¡å®˜ç½‘ç»™äº†é¢å¤–ä¸€å°æ—¶çš„ä¸Šä¼ æ—¶é—´ï¼Œæˆ‘è¿˜æ˜¯å»ºè®®å¤§å®¶åœ¨åˆ¶ä½œé˜¶æ®µçš„æœ«å°¾å°±å¼€å§‹ç ”ç©¶æ€ä¹ˆä¸Šä¼ æ¸¸æˆï¼Œä»¥é˜²ä¸‡ä¸€å˜›ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åœ¨è¿™æ®µæ—¶é—´é‡Œå¡«å……å³ä¸Šè§’ My Game çš„è‰ç¨¿é¡µï¼ŒæŒ‰ç€é¡µé¢è¦æ±‚å¡«å†™å³å¯ã€‚</p><p><img src="/images/game-design/gamejam/ldjamå‚èµ›æŒ‡å—/mygame.png" alt=""></p><p>æˆ‘ä»¬å¯ä»¥æŠŠæ¸¸æˆå‹ç¼©åŒ…ä¸Šä¼ åˆ°é¡µé¢ä¸Šï¼ŒåŒæ—¶ Ludum Dare æ”¯æŒ Embed HTML5ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æ ¹æ®<a href="https://ludumdare.com/resources/guides/embedding/">Embedding Guide</a>ç›´æ¥æŠŠæ¸¸æˆçš„ç½‘é¡µç‰ˆä¸Šä¼ åˆ°å®˜ç½‘çš„æ¸¸æˆé¡µé¢ä¸Šã€‚å»ºè®®å¤§å®¶åŒæ—¶æŠŠç½‘é¡µç‰ˆä¸Šä¼ åˆ° itch ä¸Šï¼Œæ¯•ç«Ÿå®˜ç½‘çš„ç½‘é¡µç‰ˆæ¸¸æˆæ”¯æŒåšå¾—ä¸ç®—å¾ˆå®Œç¾ã€‚</p><p>è®°å¾—é€€å‡ºè‡ªå·±ä¸ç¬¦åˆ/ä¸æƒ³è¦çš„æ‰“åˆ†é€‰é¡¹ã€‚</p><p><img src="/images/game-design/gamejam/ldjamå‚èµ›æŒ‡å—/opt.png" alt=""></p><h2 id="è¯„åˆ†é˜¶æ®µ"><a href="#è¯„åˆ†é˜¶æ®µ" class="headerlink" title="è¯„åˆ†é˜¶æ®µ"></a>è¯„åˆ†é˜¶æ®µ</h2><p>è‡³æ­¤ï¼Œæ­å–œä½ åšå‡ºäº†è‡ªå·±çš„æ¸¸æˆï¼</p><p>è¯„åˆ†é˜¶æ®µæŒç»­ä¸‰å‘¨ï¼Œåœ¨è¯„åˆ†é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥è¯•ç©åˆ«äººçš„æ¸¸æˆå¹¶æ‰“åˆ†ï¼Œä½ æ‰“åˆ†çš„æ¸¸æˆè¶Šå¤šï¼Œæ¨èç®—æ³•ç»™ä½ çš„æ¸¸æˆçš„æ¨èä¼˜å…ˆçº§å°±è¶Šé«˜ã€‚åŒæ—¶é«˜è´¨é‡è¯„è®ºä¹Ÿèƒ½æé«˜ä½ æ¸¸æˆçš„æ¨èä¼˜å…ˆçº§ã€‚</p><p>è¯„åˆ†é˜¶æ®µå…è®¸ç»§ç»­ç¼–è¾‘é¡µé¢ï¼Œæ¯”å¦‚å¦‚æœä½ å‘ç°æ¸¸æˆé¡µé¢çš„æè¿°æœ‰é—®é¢˜ï¼Œéšæ—¶å¯ä»¥è¿›è¡Œä¿®æ”¹ã€‚ä¿®æ¸¸æˆå†…çš„ bug ä¹Ÿæ˜¯è¢«å…è®¸çš„ï¼Œä½†è¦æ±‚åœ¨ä¿® bug ä»¥åæ˜¾å¼åœ°åœ¨æ¸¸æˆé¡µé¢æ ‡å‡ºè‡ªå·±åšçš„ä¿®æ”¹ï¼ˆå†™ä¸€ä¸ªç®€è¦çš„ devlogï¼‰ï¼Œè€Œä¸”ä¸èƒ½å¢åŠ æ–°åŠŸèƒ½ã€‚</p><p><img src="/images/game-design/gamejam/ldjamå‚èµ›æŒ‡å—/scores.png" alt=""></p><h2 id="ç»“æœå…¬å¸ƒ"><a href="#ç»“æœå…¬å¸ƒ" class="headerlink" title="ç»“æœå…¬å¸ƒ"></a>ç»“æœå…¬å¸ƒ</h2><p>æ¸¸æˆä¼šæ ¹æ®æ‰“åˆ†æ¥æ’åã€‚æ²¡æœ‰å¥–å“ï¼Œä½ çš„æ¸¸æˆå°±æ˜¯æœ€å¥½çš„å¥–å“ï¼</p><h1 id="å››ã€å…¶ä»–èµ„æ–™"><a href="#å››ã€å…¶ä»–èµ„æ–™" class="headerlink" title="å››ã€å…¶ä»–èµ„æ–™"></a>å››ã€å…¶ä»–èµ„æ–™</h1><p>å¯ä»¥åœ¨<a href="https://ludumdare.com/resources/archive/rules-2017/">rules</a>é¡µé¢æ‰¾åˆ°è¯¦ç»†çš„å‚åŠ è§„åˆ™ï¼Œ<strong>å¼ºçƒˆå»ºè®®åœ¨å‚åŠ å‰é˜…è¯»</strong>ã€‚</p><p>å¯ä»¥åœ¨è¿™ç¯‡<a href="https://zhuanlan.zhihu.com/p/20337558">è§„åˆ™ä»‹ç»</a>æ‰¾åˆ°ä¸­æ–‡çš„è§„åˆ™ä»‹ç»ï¼Œä½†ä¸å¦‚ä¸Šé¢é‚£ä¸ªå…¨é¢ã€‚</p><p>æœ¬æ–‡çš„ç»“æ„å‚è€ƒäº† <a href="https://zhuanlan.zhihu.com/p/27330699">Google ç¼–ç¨‹ä¹‹å¤(GSoC)ï¼šæµ·é‡ä¼˜è´¨é¡¹ç›®ï¼Œä¸°åšæŠ¥é…¬ï¼Œä½ ç«Ÿç„¶è¿˜ä¸çŸ¥é“ï¼Ÿ</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;é›¶ã€åœ¨æ–‡ç« å¼€å§‹ä¹‹å‰&quot;&gt;&lt;a href=&quot;#é›¶ã€åœ¨æ–‡ç« å¼€å§‹ä¹‹å‰&quot; class=&quot;headerlink&quot; title=&quot;é›¶ã€åœ¨æ–‡ç« å¼€å§‹ä¹‹å‰&quot;&gt;&lt;/a&gt;é›¶ã€åœ¨æ–‡ç« å¼€å§‹ä¹‹å‰&lt;/h1&gt;&lt;p&gt;æœ¬æ–‡åŒ…å«äº†å¯¹ Ludum Dare çš„ä»‹ç»ã€å‚ä¸æµç¨‹åŠä¸ªäººçœ‹æ³•ã€‚å†™ä½œçš„å¥‘æœºæ˜¯å‚ä¸ L</summary>
      
    
    
    
    <category term="gamejam" scheme="http://rinevard.github.io/categories/gamejam/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¬¬åç« â€”â€”ç³»ç»Ÿçº§I/O</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Notes/Chapter10-system-io/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Notes/Chapter10-system-io/</id>
    <published>2025-04-11T02:00:00.000Z</published>
    <updated>2025-08-20T11:13:48.877Z</updated>
    
    <content type="html"><![CDATA[<style>img{    width: 75%;}</style><h1 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h1><p>æ‰€æœ‰çš„ I/O è®¾å¤‡éƒ½è¢«è§†ä¸ºæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬èƒ½ç”¨ä¸€è‡´çš„æ–¹å¼å¤„ç†å„ç§è¾“å…¥è¾“å‡ºã€‚</p><p>æ–‡ä»¶ç±»å‹åˆ†ä¸ºä»¥ä¸‹å‡ ç±»</p><ul><li>æ™®é€šæ–‡ä»¶ï¼šåŒ…å«ç”¨æˆ·æ•°æ®ï¼Œå¯ä»¥æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼ˆå¦‚.txtï¼‰æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå¦‚.jpgã€.exeï¼‰</li><li>ç›®å½•ï¼šåŒ…å«ä¸€ç³»åˆ—é“¾æ¥ï¼Œæ¯ä¸ªè¿æ¥å°†ä¸€ä¸ªæ–‡ä»¶åæ˜ å°„åˆ°ä¸€ä¸ªæ–‡ä»¶</li><li>å¥—æ¥å­—ï¼ˆsocketï¼‰ï¼šè·¨ç½‘ç»œé€šä¿¡ç”¨çš„æ–‡ä»¶</li></ul><h1 id="è¯»å†™æ–‡ä»¶"><a href="#è¯»å†™æ–‡ä»¶" class="headerlink" title="è¯»å†™æ–‡ä»¶"></a>è¯»å†™æ–‡ä»¶</h1><h2 id="æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile-descriptorï¼‰"><a href="#æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile-descriptorï¼‰" class="headerlink" title="æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰"></a>æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptorï¼‰</h2><p>æ–‡ä»¶æè¿°ç¬¦æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œä»£è¡¨è¿›ç¨‹æ‰“å¼€çš„æ–‡ä»¶çš„æ ‡è¯†ç¬¦ã€‚åœ¨è¿›ç¨‹ä¸­ï¼Œæ¯å½“æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ†é…ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ç»™å®ƒã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ0 è¡¨ç¤ºæ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰ï¼Œ1 è¡¨ç¤ºæ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰ï¼Œ2 è¡¨ç¤ºæ ‡å‡†é”™è¯¯ï¼ˆstderrï¼‰ã€‚é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ openï¼‰æ‰“å¼€æ–‡ä»¶åï¼Œä¼šè¿”å›ä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¦‚ 3ã€4 ç­‰ï¼‰ï¼Œå…·ä½“å€¼å–å†³äºå½“å‰è¿›ç¨‹ä¸­å·²ä½¿ç”¨çš„æè¿°ç¬¦æƒ…å†µã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>open</code> ç³»ç»Ÿè°ƒç”¨çš„ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å¹¶è·å–æ–‡ä»¶æè¿°ç¬¦ï¼š</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ‰“å¼€æ–‡ä»¶ "example.txt"ï¼Œä»¥åªè¯»æ¨¡å¼</span>    <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"example.txt"</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fd <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"æ–‡ä»¶æè¿°ç¬¦: %d\\n"</span><span class="token punctuation">,</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œæ“ä½œï¼ˆå¦‚è¯»å–ï¼‰</span>    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token class-name">ssize_t</span> bytes_read <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>bytes_read <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"read failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å…³é—­æ–‡ä»¶æè¿°ç¬¦</span>    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸è¶³å€¼ï¼ˆshort-countï¼‰"><a href="#ä¸è¶³å€¼ï¼ˆshort-countï¼‰" class="headerlink" title="ä¸è¶³å€¼ï¼ˆshort countï¼‰"></a>ä¸è¶³å€¼ï¼ˆshort countï¼‰</h2><p>â€œä¸è¶³å€¼â€æ˜¯æŒ‡åœ¨è¯»å†™æ“ä½œä¸­ï¼Œå®é™…è¯»å–æˆ–å†™å…¥çš„å­—èŠ‚æ•°å°‘äºè¯·æ±‚çš„å­—èŠ‚æ•°ã€‚åŸå› æœ‰é‡åˆ° EOFã€ä»ç»ˆç«¯è¯»æ–‡æœ¬è¡Œï¼ˆå¦‚æœè¯»ç»ˆç«¯ï¼Œread ä¸€æ¬¡åªä¼ è¾“ä¸€ä¸ªæ–‡æœ¬è¡Œï¼‰ã€è¯»å†™ç½‘ç»œå¥—æ¥å­—ã€‚</p><p>æ¯”å¦‚è°ƒç”¨ read(fd, buffer, 100)è¯·æ±‚è¯»å– 100 å­—èŠ‚ï¼Œä½†æ–‡ä»¶åªå‰© 50 å­—èŠ‚å¯ç”¨ï¼Œåˆ™è¿”å› 50ï¼ˆä¸è¶³å€¼ï¼‰ã€‚</p><p>æˆ‘ä»¬éœ€è¦æ£€æŸ¥è¿”å›å€¼ï¼Œç¡®è®¤å®é™…è¯»å†™å­—èŠ‚æ•°ï¼Œå¹¶æ ¹æ®éœ€è¦è°ƒæ•´é€»è¾‘ï¼ˆå¦‚å¾ªç¯è¯»å–å‰©ä½™æ•°æ®ï¼‰ã€‚</p><h2 id="æè¿°ç¬¦è¡¨ã€æ–‡ä»¶è¡¨ã€v-node-è¡¨"><a href="#æè¿°ç¬¦è¡¨ã€æ–‡ä»¶è¡¨ã€v-node-è¡¨" class="headerlink" title="æè¿°ç¬¦è¡¨ã€æ–‡ä»¶è¡¨ã€v-node è¡¨"></a>æè¿°ç¬¦è¡¨ã€æ–‡ä»¶è¡¨ã€v-node è¡¨</h2><p>æ“ä½œç³»ç»Ÿåœ¨å†…æ ¸ä¸­ç»´æŠ¤äº†ä¸‰å±‚æ•°æ®ç»“æ„æ¥ç®¡ç†æ–‡ä»¶ï¼š</p><ul><li><strong>æè¿°ç¬¦è¡¨</strong>ï¼šæ¯ä¸ªè¿›ç¨‹ç‹¬æœ‰ï¼Œè®°å½•è¯¥è¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦åŠå…¶å¯¹åº”çš„æ–‡ä»¶è¡¨é¡¹ã€‚</li><li><strong>æ–‡ä»¶è¡¨</strong>ï¼šæ‰€æœ‰è¿›ç¨‹å…±äº«ï¼Œè¡¨é¡¹åŒ…æ‹¬åç§»å€¼ã€å¼•ç”¨è®¡æ•°ï¼ˆå³å½“å‰æŒ‡å‘è¯¥è¡¨çš„æè¿°ç¬¦è¡¨é¡¹æ•°ï¼‰ã€æŒ‡å‘ v-node è¡¨ä¸­å¯¹åº”é¡¹çš„æŒ‡é’ˆã€‚å…³é—­ä¸€ä¸ªæè¿°ç¬¦ä¼šå‡å°‘ç›¸åº”çš„æ–‡ä»¶è¡¨è¡¨é¡¹çš„å¼•ç”¨è®¡æ•°ï¼Œå‡åˆ°é›¶ä¼šåˆ é™¤ã€‚</li><li><strong>v-node è¡¨</strong>ï¼ˆæˆ– inode è¡¨ï¼‰ï¼šä¸å…·ä½“æ–‡ä»¶ç³»ç»Ÿç›¸å…³ï¼Œè®°å½•æ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆå¦‚æ–‡ä»¶å¤§å°ã€æƒé™ã€å­˜å‚¨ä½ç½®ï¼‰ã€‚æ¯ä¸ªæ–‡ä»¶åœ¨ v-node è¡¨ä¸­æœ‰ä¸€ä¸ªå”¯ä¸€æ¡ç›®ã€‚</li></ul><h3 id="è°ƒç”¨-open-æ‰“å¼€æ–‡ä»¶çš„å…·ä½“è¿‡ç¨‹"><a href="#è°ƒç”¨-open-æ‰“å¼€æ–‡ä»¶çš„å…·ä½“è¿‡ç¨‹" class="headerlink" title="è°ƒç”¨ open æ‰“å¼€æ–‡ä»¶çš„å…·ä½“è¿‡ç¨‹"></a>è°ƒç”¨ open æ‰“å¼€æ–‡ä»¶çš„å…·ä½“è¿‡ç¨‹</h3><p>å½“è°ƒç”¨ <code>open</code> ç³»ç»Ÿè°ƒç”¨æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>éªŒè¯å’ŒæŸ¥æ‰¾æ–‡ä»¶</strong>ï¼š<ul><li>å†…æ ¸æ£€æŸ¥æ–‡ä»¶è·¯å¾„ã€æƒé™ç­‰ï¼Œç¡®å®šæ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”è¿›ç¨‹æœ‰æƒè®¿é—®ã€‚</li><li>æ‰¾åˆ°æ–‡ä»¶å¯¹åº”çš„ v-nodeï¼ˆæˆ– inodeï¼‰ï¼Œå¦‚æœæ–‡ä»¶å·²åœ¨ v-node è¡¨ä¸­ï¼Œåˆ™å¤ç”¨ï¼Œå¦åˆ™åˆ›å»ºæ–°æ¡ç›®ã€‚</li></ul></li><li><strong>åˆ†é…æ–‡ä»¶è¡¨é¡¹</strong>ï¼š<ul><li>å†…æ ¸åœ¨æ–‡ä»¶è¡¨ï¼ˆfile tableï¼‰ä¸­åˆ›å»ºä¸€ä¸ªæ–°è¡¨é¡¹ï¼Œè®°å½•æ–‡ä»¶çš„åç§»é‡ï¼ˆåˆå§‹ä¸º 0ï¼‰ã€è®¿é—®æ¨¡å¼ï¼ˆå¦‚åªè¯»ã€è¯»å†™ï¼‰ã€å¼•ç”¨è®¡æ•°ï¼ˆåˆå§‹ä¸º 1ï¼‰ä»¥åŠæŒ‡å‘å¯¹åº” v-node çš„æŒ‡é’ˆã€‚</li></ul></li><li><strong>æ›´æ–°æè¿°ç¬¦è¡¨</strong>ï¼š<ul><li>å†…æ ¸åœ¨è°ƒç”¨è¿›ç¨‹çš„æè¿°ç¬¦è¡¨ï¼ˆfile descriptor tableï¼‰ä¸­åˆ†é…ä¸€ä¸ªæœªä½¿ç”¨çš„æœ€å°æè¿°ç¬¦ç¼–å·ï¼ˆå¦‚ 3ï¼Œè‹¥ 0ã€1ã€2 å·²å ç”¨ï¼‰ã€‚</li><li>å°†è¯¥æè¿°ç¬¦æŒ‡å‘æ–°åˆ›å»ºçš„æ–‡ä»¶è¡¨é¡¹ã€‚</li></ul></li><li><strong>è¿”å›æ–‡ä»¶æè¿°ç¬¦</strong>ï¼š<ul><li><code>open</code> è°ƒç”¨è¿”å›åˆ†é…çš„æ–‡ä»¶æè¿°ç¬¦ç»™è¿›ç¨‹ï¼Œä¾›åç»­æ“ä½œï¼ˆå¦‚ <code>read</code>ã€<code>write</code>ï¼‰ä½¿ç”¨ã€‚</li></ul></li></ol><h3 id="open-ä¸¤æ¬¡ï¼š"><a href="#open-ä¸¤æ¬¡ï¼š" class="headerlink" title="open ä¸¤æ¬¡ï¼š"></a><strong>open ä¸¤æ¬¡ï¼š</strong></h3><p><img src="/images/learning/open-course/CMU-15213/Notes/Chapter10/opentwice.png" alt=""></p><h3 id="forkï¼š"><a href="#forkï¼š" class="headerlink" title="forkï¼š"></a><strong>forkï¼š</strong></h3><p><img src="/images/learning/open-course/CMU-15213/Notes/Chapter10/fork.png" alt=""></p><h1 id="åŸºäºç¼“å†²åŒºçš„è¯»å†™"><a href="#åŸºäºç¼“å†²åŒºçš„è¯»å†™" class="headerlink" title="åŸºäºç¼“å†²åŒºçš„è¯»å†™"></a>åŸºäºç¼“å†²åŒºçš„è¯»å†™</h1><p>åŸºäºç¼“å†²åŒºçš„è¯»å†™å°†æ•°æ®å…ˆå†™å…¥å†…å­˜ç¼“å†²åŒºï¼Œç­‰ç¼“å†²åŒºæ»¡æˆ–æ˜¾å¼åˆ·æ–°ï¼ˆå¦‚ fflushï¼‰æ—¶å†ä¸€æ¬¡æ€§ä¸åº•å±‚è®¾å¤‡åšæ•°æ®äº¤æ¢ï¼Œé™ä½äº† I/O å¼€é”€ã€‚</p><p>åœ¨ä½¿ç”¨è¯»å†™æ—¶ï¼Œæˆ‘ä»¬åº”å°½å¯èƒ½ä½¿ç”¨ stdio æ ‡å‡†åº“ã€‚stdioï¼ˆæ ‡å‡†è¾“å…¥è¾“å‡ºåº“ï¼‰æä¾›äº†åŸºäºç¼“å†²åŒºçš„ I/O æ“ä½œï¼ˆå¦‚ fopenã€freadã€fwriteã€printf ç­‰ï¼‰ï¼Œç›¸æ¯”ç›´æ¥ä½¿ç”¨ä½çº§ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚ readã€writeï¼‰ï¼Œå®ƒçš„<strong>æ•ˆç‡æ›´é«˜</strong>è€Œä¸”æ›´ä¸æ˜“å‡ºé”™ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;style&gt;
img{
    width: 75%;
}
&lt;/style&gt;

&lt;h1 id=&quot;æ–‡ä»¶&quot;&gt;&lt;a href=&quot;#æ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;æ–‡ä»¶&quot;&gt;&lt;/a&gt;æ–‡ä»¶&lt;/h1&gt;&lt;p&gt;æ‰€æœ‰çš„ I/O è®¾å¤‡éƒ½è¢«è§†ä¸ºæ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬èƒ½ç”¨ä¸€è‡´çš„æ–¹å¼å¤„</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="CMU-15-213" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/"/>
    
    <category term="Notes" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/Notes/"/>
    
    
  </entry>
  
  <entry>
    <title>Shlabè°ƒè¯•è®°å½•å’Œä¸€é”®æµ‹è¯•è„šæœ¬</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Labs/Shlab/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Labs/Shlab/</id>
    <published>2025-04-03T09:04:28.000Z</published>
    <updated>2025-04-03T09:15:49.780Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><p>ç”¨æ—¶ 10h30min, é€šè¿‡æ‰€æœ‰æµ‹è¯•ã€‚è¿™ä¸ª lab è¿˜æ˜¯æ¯”è¾ƒç›´æ¥çš„, æŒ‰ç€ trace çš„é¡ºåºé€æ­¥å®ç°å³å¯, éš¾ç‚¹ä¸»è¦åœ¨è°ƒè¯•å’Œä¸ç†Ÿæ‚‰ç³»ç»Ÿè°ƒç”¨è¯­æ³•ä¸Šã€‚æˆ‘åœ¨å†™ä»£ç çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸¤ä¸ªè°ƒäº†è›®ä¹…çš„ bug, åˆ†åˆ«åœ¨ trace13 å’Œ trace16 ä¸Š, ä¸‹é¢ç®€è¦å¤ç›˜ä¸€ä¸‹ã€‚</p><h1 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h1><h2 id="trace16"><a href="#trace16" class="headerlink" title="trace16"></a>trace16</h2><p>å…ˆè¯´ trace16 çš„ bug, è¿™ä¸ªè°ƒäº†åŠå°æ—¶ã€‚trace16 æµ‹è¯•çš„æ˜¯ shell èƒ½å¦å¤„ç†å­è¿›ç¨‹è¢«å¤–éƒ¨ä¿¡å·ä¸­æ–­æˆ–åœæ­¢çš„æƒ…å†µã€‚æˆ‘é‡åˆ°çš„é—®é¢˜æ˜¯ trace16 åœ¨ <code>./mystop</code> é‚£é‡Œå¡ä½äº†, äºæ˜¯çŒœæµ‹åŸå› æ˜¯ jobs æ²¡èƒ½æ­£ç¡®æ›´æ–°å­è¿›ç¨‹çš„æš‚åœçŠ¶æ€ã€‚åé¢åŠ äº†ç‚¹è°ƒè¯•è¯­å¥å‘ç°æœç„¶å¦‚æ­¤ã€‚é‚£ä¹ˆä¿®å¤æ€è·¯å°±æ˜¯åœ¨å­è¿›ç¨‹æš‚åœåæŠŠå®ƒå¯¹åº”çš„ job çŠ¶æ€è¿›è¡Œæ›´æ–°ã€‚ä½†æ€ä¹ˆçŸ¥é“å­è¿›ç¨‹ä»€ä¹ˆæ—¶å€™æš‚åœå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ sigchld_handler.</p><p>æˆ‘ä¸€å¼€å§‹ä»¥ä¸º sigchld_handler åªä¼šåœ¨æŸä¸ªå­è¿›ç¨‹ç»ˆæ­¢åè¢«è°ƒç”¨, æ‰€ä»¥åªåœ¨ sigchld_handler é‡Œå†™äº†å›æ”¶å·²ç»ç»ˆæ­¢çš„å­è¿›ç¨‹çš„é€»è¾‘ã€‚åæ¥å‘ç°<strong>å­è¿›ç¨‹åªè¦çŠ¶æ€å‘ç”Ÿå˜åŒ–å°±ä¼šå‘ SIGCHLD ä¿¡å·ç»™çˆ¶è¿›ç¨‹, å­è¿›ç¨‹ç»ˆæ­¢åªæ˜¯ä¸€ç§æƒ…å†µ, æš‚åœã€æ¢å¤ä¹Ÿä¼šå‘é€è¿™ä¸ªä¿¡å·</strong>ã€‚æ‰€ä»¥è®© sigchld_handler æ£€æŸ¥å·²ç»åœæ­¢çš„å­è¿›ç¨‹, å¹¶æ›´æ–°å®ƒä»¬å¯¹åº”çš„ jobs çŠ¶æ€å°±ä¿®å¤äº†è¿™ä¸ª bug.</p><h2 id="trace13"><a href="#trace13" class="headerlink" title="trace13"></a>trace13</h2><p>ç„¶åæ˜¯ trace13 çš„ bug, è¿™ä¸ªè°ƒäº†ä¸¤å°æ—¶åŠã€‚è¿™é‡Œçš„é—®é¢˜æ˜¯åœ¨ <code>fg %1</code> å¡ä½ã€‚ç¬¬ä¸€ä¸ªçŒœæµ‹è‡ªç„¶æ˜¯è¿›ç¨‹æ²¡èƒ½è¢«æ­£ç¡®ç§»åˆ°å‰å°, ä½†åŠ äº†è°ƒè¯•è¯­å¥åå‘ç°å®ƒç¡®å®è¢«ç§»åˆ°å‰å°äº†ã€‚ä¹‹åçš„çŒœæµ‹å°±æ˜¯ waitfg çš„å®ç°æœ‰è¯¯, è¿™ä¸ªçŒœæµ‹çœ‹èµ·æ¥å¾ˆåˆç†, æ¯•ç«Ÿ handout é‡Œå†™ waitfg å¤§æ¦‚éœ€è¦ 20 è¡Œ, è€Œæˆ‘åªç”¨äº† 4 è¡Œã€‚ä½†æµ‹äº†åŠå¤©å‘ç° waitfg ä¹Ÿæ²¡é—®é¢˜ã€‚</p><p>è¿›ä¸€æ­¥åŠ å…¥å„ç§è°ƒè¯•è¯­å¥, å‘ç°åœ¨ fg %1 ä¹‹å, è¿›ç¨‹ç¡®å®è¢«é¡ºåˆ©ç§»åˆ°äº†å‰å°, jobs ä¹Ÿæ­£ç¡®æ›´æ–°äº†, waitfg åªæ˜¯å› ä¸ºå®ƒæ²¡ç»“æŸ, æ‰€ä»¥ä¸€ç›´å¾ªç¯ç€ç­‰ç€å®ƒã€‚å¥½å§, é‚£æˆ‘çŒœæ˜¯ sigchld_handler æ²¡èƒ½æ­£ç¡®å›æ”¶å®ƒã€‚æˆ‘æ£€æŸ¥äº†ä¸€ä¸‹, å‘ç°ç»ˆæ­¢çš„è¿›ç¨‹ä¹Ÿéƒ½è¢«æ­£ç¡®å›æ”¶äº†ã€‚é‚£è¿˜èƒ½æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿéš¾é“å®ƒè¢«æš‚åœäº†, ä½†æ²¡æœ‰è¢«æ­£ç¡®å¯åŠ¨, å¯¼è‡´æˆ‘ä»¬çš„ shell è¯¯ä»¥ä¸ºè¿™ä¸ªæš‚åœç€çš„è¿›ç¨‹æ˜¯å‰å°è¿›ç¨‹, ä»è€Œå¡ä½äº†ï¼Ÿè¿™å¬èµ·æ¥å°±åƒæ˜¯ä¸€ä¸ªå¹¶è¡Œå¯¼è‡´çš„é—®é¢˜, äºæ˜¯æˆ‘åˆè°ƒè¯•äº†å¥½ä¹…, æœ€åå‘ç°å®ƒç¡®å®è¢«æ­£ç¡®å¯åŠ¨äº†, è¿™ä¸ªè¿›ç¨‹åªæ˜¯å•çº¯åœ°è¿˜æ²¡æœ‰ç»ˆæ­¢è€Œå·²ã€‚</p><p>é‚£è¿™æ€ä¹ˆå¯èƒ½å‘¢ï¼Ÿå‡­ä»€ä¹ˆå®ƒåœ¨ tshref é‡Œå‡ ç§’é’Ÿå°±æ‰§è¡Œå®Œäº†, åœ¨æˆ‘çš„å®ç°é‡Œäº”åˆ†é’Ÿäº†éƒ½æ²¡æ‰§è¡Œå®Œï¼ŸåŸæ¥æ˜¯æˆ‘çš„â€œå¯åŠ¨â€å†™é”™äº†ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯ <code>kill(job-&gt;pid, SIGCONT)</code>, <strong>è¿™ä¸ªä»£ç åªæŠŠå¯åŠ¨ä¿¡å·å‘ç»™äº†è¿™ä¸€ä¸ªå­è¿›ç¨‹, è€Œä¸æ˜¯å‘ç»™å®ƒæ‰€åœ¨çš„è¿›ç¨‹ç»„</strong>, ä»è€Œè®©è¿™ä¸ªå­è¿›ç¨‹æ‰€åœ¨ç»„çš„åˆ«çš„è¿›ç¨‹æ²¡æœ‰è¢«æ­£ç¡®å¯åŠ¨ã€‚è€Œçœ‹çœ‹ <code>mysplit.c</code> çš„ä»£ç , ä¼šå‘ç°å®ƒç­‰å¾…å®ƒçš„å­è¿›ç¨‹æ‰§è¡Œå®Œæ‰ä¼šç»ˆæ­¢, æ‰€ä»¥æˆ‘ä»¬æŠŠä»£ç æ”¹æˆ <code>kill(-job-&gt;pid, SIGCONT)</code> å°±è§£å†³äº†è¿™ä¸ª bug.</p><p>å°±å› ä¸ºè¿™ä¸€ä¸ªè´Ÿå·, æˆ‘è°ƒè¯•äº†ä¸¤ä¸ªåŠå°æ—¶, è€Œä¸”æˆ‘æ„Ÿè§‰æˆ‘ä¸€è·¯ä¸‹æ¥çš„å„ç§çŒœæƒ³ä¹Ÿéƒ½å¾ˆåˆç†, åªèƒ½æ„Ÿå¹ç³»ç»Ÿçº§ä»£ç çœŸéš¾è°ƒè¯•å•Šã€‚</p><h2 id="æ„Ÿæƒ³"><a href="#æ„Ÿæƒ³" class="headerlink" title="æ„Ÿæƒ³"></a>æ„Ÿæƒ³</h2><p>ä¹Ÿç®—æ˜¯å­¦åˆ°äº†å‡ æ‹›å§ï¼š</p><ol><li>åœ¨è°ƒç”¨ç³»ç»Ÿå‡½æ•°æ—¶ä¸€å®šè¦æ£€æŸ¥è¿”å›å€¼, ä¸ç„¶ä¼šæŠ¥ä¸€äº›å¾ˆéš¾è°ƒè¯•çš„é”™è¯¯</li><li>åœ¨ä¿®æ”¹å…¨å±€å˜é‡æ—¶ä¸€å®šè¦ç”¨ sigprocmask æ‹¦æˆªåˆ«çš„ä¿¡å·, é¿å…å†²çª</li><li>å­è¿›ç¨‹åªè¦çŠ¶æ€å‘ç”Ÿå˜åŒ–å°±ä¼šå‘ SIGCHLD ä¿¡å·ç»™çˆ¶è¿›ç¨‹, ç»ˆæ­¢ã€æš‚åœã€æ¢å¤éƒ½ä¼šå‘é€è¿™ä¸ªä¿¡å·</li><li>å¯ä»¥ç”¨ waitpid æ¥æ£€æŸ¥å­è¿›ç¨‹çš„å˜åŒ–çŠ¶æ€, å®ƒä¼šå›æ”¶ç»ˆæ­¢çš„å­è¿›ç¨‹</li><li>åªåœ¨ä¿¡å·å¤„ç†ç¨‹åºä¸­è°ƒç”¨å¼‚æ­¥å®‰å…¨çš„å‡½æ•°</li><li>è°ƒè¯•æ—¶å¤§èƒ†çŒœæƒ³, å°å¿ƒæ±‚è¯</li></ol><h1 id="ä¸€é”®æµ‹è¯•è„šæœ¬"><a href="#ä¸€é”®æµ‹è¯•è„šæœ¬" class="headerlink" title="ä¸€é”®æµ‹è¯•è„šæœ¬"></a>ä¸€é”®æµ‹è¯•è„šæœ¬</h1><p>æˆ‘è®© AI å†™äº†ä¸€ä»½ä¸€é”®æµ‹è¯•è„šæœ¬, æ¯”å®˜æ–¹çš„å½¢å¦‚ <code>make test13</code> çš„æµ‹è¯•æ–¹ä¾¿ä¸å°‘ã€‚è„šæœ¬çš„åŠŸèƒ½æ˜¯åœ¨ traceA åˆ° traceBï¼ˆè¦æ±‚ A &lt; Bï¼‰ä¸Šåˆ†åˆ«è¿è¡Œ tsh å’Œ tshref, å¹¶æŠŠè¾“å‡ºç»“æœæ”¾åˆ°ä¸¤ä¸ªæ–‡ä»¶ä¸­ã€‚æ¯”å¦‚è¯´, å¦‚æœæˆ‘ä»¬è¾“å…¥ <code>./test_traces.sh 1 5</code>, å°±èƒ½æµ‹è¯• <code>trace01.txt</code> åˆ° <code>trace05.txt</code>, å¹¶å°†ç»“æœåˆ†åˆ«ä¿å­˜åˆ° <code>_tshref_output.txt</code> å’Œ <code>_tsh_output.txt</code>ã€‚ä¹‹åç”¨å„ç§ç¼–è¾‘å™¨è‡ªå¸¦çš„æ¯”è¾ƒæ–‡ä»¶åŠŸèƒ½å°±èƒ½å¾ˆæ–¹ä¾¿çš„æ¯”è¾ƒè¾“å‡ºå¼‚åŒã€‚</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment"># è„šæœ¬åç§°ï¼štest_traces.sh</span><span class="token comment"># æ˜¾ç¤ºç”¨æ³•</span><span class="token function-name function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token builtin class-name">echo</span> <span class="token string">"ç”¨æ³•: <span class="token variable">$0</span> lower upper"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"  lower: å¼€å§‹çš„ trace æ–‡ä»¶ç¼–å· (1-16)"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"  upper: ç»“æŸçš„ trace æ–‡ä»¶ç¼–å· (1-16)"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"ç¤ºä¾‹: <span class="token variable">$0</span> 1 5"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"  è¿™å°†æµ‹è¯• trace01.txt åˆ° trace05.txtï¼Œå¹¶å°†è¾“å‡ºåˆ†åˆ«ä¿å­˜åˆ° _tshref_output.txt å’Œ _tsh_output.txt"</span><span class="token punctuation">&#125;</span><span class="token comment"># æ£€æŸ¥æ˜¯å¦æä¾›äº†ä¸¤ä¸ªå‚æ•°</span><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$#</span>"</span> <span class="token parameter variable">-ne</span> <span class="token number">2</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>    <span class="token builtin class-name">echo</span> <span class="token string">"é”™è¯¯: è¯·æä¾› lower å’Œ upper ä¸¤ä¸ªå‚æ•°"</span>    usage    <span class="token builtin class-name">exit</span> <span class="token number">1</span><span class="token keyword">fi</span><span class="token assign-left variable">lower</span><span class="token operator">=</span><span class="token variable">$1</span><span class="token assign-left variable">upper</span><span class="token operator">=</span><span class="token variable">$2</span><span class="token assign-left variable">ref_output_file</span><span class="token operator">=</span><span class="token string">"_tshref_output.txt"</span><span class="token assign-left variable">tsh_output_file</span><span class="token operator">=</span><span class="token string">"_tsh_output.txt"</span><span class="token comment"># æ¸…ç©ºè¾“å‡ºæ–‡ä»¶ï¼ˆå¦‚æœå·²å­˜åœ¨ï¼‰</span><span class="token operator">></span> <span class="token string">"<span class="token variable">$ref_output_file</span>"</span><span class="token operator">></span> <span class="token string">"<span class="token variable">$tsh_output_file</span>"</span><span class="token comment"># è·å–å½“å‰å·¥ä½œç›®å½•ï¼ˆæ¨¡ä»¿ make çš„ Entering directory æ ¼å¼ï¼‰</span><span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span><span class="token comment"># å¾ªç¯è¿è¡ŒæŒ‡å®šèŒƒå›´çš„ trace æ–‡ä»¶</span><span class="token keyword">for</span> <span class="token variable"><span class="token punctuation">((</span>i<span class="token operator">=</span>lower<span class="token punctuation">;</span> i<span class="token operator">&lt;=</span>upper<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>    <span class="token comment"># è¡¥é½ä¸¤ä½æ•°æ ¼å¼ï¼ˆä¾‹å¦‚ 01, 02, ..., 16ï¼‰</span>    <span class="token assign-left variable">trace_num</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">printf</span> <span class="token string">"%02d"</span> $i<span class="token variable">)</span></span>    <span class="token comment"># è¾“å‡º make æ ·å¼çš„è¿›å…¥ç›®å½•ä¿¡æ¯ï¼ˆä»…ç¬¬ä¸€æ¬¡å¾ªç¯æ—¶ï¼‰</span>    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$i</span> <span class="token parameter variable">-eq</span> <span class="token variable">$lower</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>        <span class="token builtin class-name">echo</span> <span class="token string">"make[1]: Entering directory \`<span class="token variable">$directory</span>'"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$ref_output_file</span>"</span>        <span class="token builtin class-name">echo</span> <span class="token string">"make[1]: Entering directory \`<span class="token variable">$directory</span>'"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$tsh_output_file</span>"</span>    <span class="token keyword">fi</span>    <span class="token comment"># ä¸º tshref è¾“å‡ºæ·»åŠ åˆ†éš”ç¬¦å’Œå†…å®¹</span>    <span class="token builtin class-name">echo</span> <span class="token string">"===== Trace <span class="token variable">$trace_num</span> ====="</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$ref_output_file</span>"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"./sdriver.pl -t trace<span class="token variable">$trace_num</span>.txt -s ./tshref -a <span class="token entity" title="\&quot;">\"</span>-p<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$ref_output_file</span>"</span>    <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token string">"trace<span class="token variable">$trace_num</span>.txt"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$ref_output_file</span>"</span>    ./sdriver.pl <span class="token parameter variable">-t</span> <span class="token string">"trace<span class="token variable">$trace_num</span>.txt"</span> <span class="token parameter variable">-s</span> ./tshref <span class="token parameter variable">-a</span> <span class="token string">"-p"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$ref_output_file</span>"</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span>    <span class="token builtin class-name">echo</span> <span class="token string">""</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$ref_output_file</span>"</span>  <span class="token comment"># æ·»åŠ ç©ºè¡Œä½œä¸ºé—´éš”</span>    <span class="token comment"># ä¸º tsh è¾“å‡ºæ·»åŠ åˆ†éš”ç¬¦å’Œå†…å®¹</span>    <span class="token builtin class-name">echo</span> <span class="token string">"===== Trace <span class="token variable">$trace_num</span> ====="</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$tsh_output_file</span>"</span>    <span class="token builtin class-name">echo</span> <span class="token string">"./sdriver.pl -t trace<span class="token variable">$trace_num</span>.txt -s ./tsh -a <span class="token entity" title="\&quot;">\"</span>-p<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$tsh_output_file</span>"</span>    <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token string">"trace<span class="token variable">$trace_num</span>.txt"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$tsh_output_file</span>"</span>    ./sdriver.pl <span class="token parameter variable">-t</span> <span class="token string">"trace<span class="token variable">$trace_num</span>.txt"</span> <span class="token parameter variable">-s</span> ./tsh <span class="token parameter variable">-a</span> <span class="token string">"-p"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$tsh_output_file</span>"</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span>    <span class="token builtin class-name">echo</span> <span class="token string">""</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$tsh_output_file</span>"</span>  <span class="token comment"># æ·»åŠ ç©ºè¡Œä½œä¸ºé—´éš”</span><span class="token keyword">done</span><span class="token builtin class-name">echo</span> <span class="token string">"æµ‹è¯•å®Œæˆã€‚å‚è€ƒå®ç°ç»“æœå·²ä¿å­˜åˆ° <span class="token variable">$ref_output_file</span>ï¼Œå­¦ç”Ÿå®ç°ç»“æœå·²ä¿å­˜åˆ° <span class="token variable">$tsh_output_file</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç”¨æ³•ç®€è¿°"><a href="#ç”¨æ³•ç®€è¿°" class="headerlink" title="ç”¨æ³•ç®€è¿°"></a>ç”¨æ³•ç®€è¿°</h2><ol><li>ä¿å­˜è„šæœ¬ï¼š<ul><li>å°†ä¸Šè¿°ä»£ç ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚ <code>test_traces.sh</code>ã€‚</li></ul></li><li>èµ‹äºˆæ‰§è¡Œæƒé™ï¼š<ul><li>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¸ºè„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™ï¼š<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> +x test_traces.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li>è¿™ä¸€æ­¥æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºåœ¨ Linux/Unix ç³»ç»Ÿä¸­ï¼Œè„šæœ¬é»˜è®¤æ²¡æœ‰æ‰§è¡Œæƒé™ï¼Œéœ€è¦æ‰‹åŠ¨èµ‹äºˆã€‚</li></ul></li><li>è¿è¡Œè„šæœ¬ï¼š<ul><li>ä½¿ç”¨ä»¥ä¸‹æ ¼å¼è¿è¡Œè„šæœ¬ï¼š<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./test_traces.sh lower upper<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>lower</code>ï¼šèµ·å§‹çš„ trace æ–‡ä»¶ç¼–å·ï¼ˆ1-16ï¼‰ã€‚</li><li><code>upper</code>ï¼šç»“æŸçš„ trace æ–‡ä»¶ç¼–å·ï¼ˆ1-16ï¼‰ã€‚</li></ul></li><li>ç¤ºä¾‹ï¼š<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./test_traces.sh <span class="token number">1</span> <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>è¿™å°†æµ‹è¯• <code>trace01.txt</code> åˆ° <code>trace05.txt</code>ï¼Œå¹¶å°†ç»“æœåˆ†åˆ«ä¿å­˜åˆ° <code>_tshref_output.txt</code> å’Œ <code>_tsh_output.txt</code>ã€‚</li></ul></li></ul></li><li>æ£€æŸ¥è¾“å‡ºï¼š<ul><li>æµ‹è¯•å®Œæˆåï¼Œæ¯”è¾ƒ <code>_tshref_output.txt</code>ï¼ˆå‚è€ƒå®ç°ç»“æœï¼‰å’Œ <code>_tsh_output.txt</code>ï¼ˆå­¦ç”Ÿå®ç°ç»“æœï¼‰ã€‚</li><li>ç”¨å„ç§ç¼–è¾‘å™¨è‡ªå¸¦çš„æ¯”è¾ƒæ–‡ä»¶åŠŸèƒ½å°±èƒ½å¾ˆæ–¹ä¾¿çš„æ¯”è¾ƒè¾“å‡ºå¼‚åŒã€‚</li></ul></li></ol><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ul><li>ç¯å¢ƒè¦æ±‚ï¼šç¡®ä¿å½“å‰ç›®å½•ä¸‹æœ‰ <code>sdriver.pl</code>ã€<code>tshref</code>ã€<code>tsh</code> ä»¥åŠå¯¹åº”çš„ <code>traceXX.txt</code> æ–‡ä»¶ï¼Œå¦åˆ™è„šæœ¬ä¼šæŠ¥é”™ã€‚</li><li>è¦†ç›–è¾“å‡ºï¼šæ¯æ¬¡è¿è¡Œè„šæœ¬æ—¶ï¼Œè¾“å‡ºæ–‡ä»¶ï¼ˆ<code>_tshref_output.txt</code> å’Œ <code>_tsh_output.txt</code>ï¼‰ä¼šè¢«æ¸…ç©ºå¹¶é‡æ–°ç”Ÿæˆã€‚</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h1&gt;&lt;p&gt;ç”¨æ—¶ 10h30min, é€šè¿‡æ‰€æœ‰æµ‹è¯•ã€‚è¿™ä¸ª lab è¿˜æ˜¯æ¯”è¾ƒç›´æ¥çš„, æŒ‰ç€ trace çš„é¡ºåºé€æ­¥å®ç°å³å¯, éš¾ç‚¹ä¸»è¦åœ¨è°ƒ</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="CMU-15-213" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/"/>
    
    <category term="Labs" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/Labs/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¬¬å…«ç« â€”â€”å¼‚å¸¸æ§åˆ¶æµ</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Notes/Chapter8-exception-control-flow/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Notes/Chapter8-exception-control-flow/</id>
    <published>2025-03-31T03:26:01.000Z</published>
    <updated>2025-08-20T11:13:48.869Z</updated>
    
    <content type="html"><![CDATA[<style>img{    width: 70%;}</style><p>å½“æˆ‘ä»¬åœ¨ç¨‹åºæ‰§è¡Œæ—¶æŒ‰ä¸‹ ctrl+c ï¼Œç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿä¸ºè§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥<strong>å¼‚å¸¸æ§åˆ¶æµ</strong>ï¼ˆexceptional control flowï¼ŒECFï¼‰çš„æ¦‚å¿µã€‚å¼‚å¸¸æ§åˆ¶æµå…è®¸æˆ‘ä»¬å°†æ§åˆ¶è½¬ç§»åˆ°å…¶ä»–ç¨‹åºï¼Œä»è€Œå®ç°ä¸€äº›ç¥å¥‡çš„æ•ˆæœï¼Œæ¯”å¦‚ä¸­æ–­ç¨‹åºã€ä¸Šä¸‹æ–‡åˆ‡æ¢ã€è°ƒç”¨ç³»ç»Ÿå‡½æ•°ã€‚</p><h1 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a><strong>å¼‚å¸¸</strong></h1><p>å¼‚å¸¸æ˜¯å¼‚å¸¸æ§åˆ¶æµçš„ä¸€ç§å½¢å¼ï¼Œåˆ†ä¸ºå››ç±»ï¼š</p><div class="table-container"><table><thead><tr><th>ç±»åˆ«</th><th>å¼‚æ­¥/åŒæ­¥</th><th>äº§ç”ŸåŸå› </th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>ä¸­æ–­ï¼ˆinterruptï¼‰</td><td>å¼‚æ­¥</td><td>å¤–éƒ¨äº‹ä»¶</td><td>å¤–éƒ¨æ—¶é’Ÿï¼ˆtimer interruptï¼‰</td></tr><tr><td>é™·é˜±ï¼ˆtrapï¼‰</td><td>åŒæ­¥</td><td>æ‰§è¡Œå†…éƒ¨æŒ‡ä»¤</td><td>ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callsï¼‰</td></tr><tr><td>æ•…éšœï¼ˆfaultï¼‰</td><td>åŒæ­¥</td><td>æ‰§è¡Œå†…éƒ¨æŒ‡ä»¤</td><td>é™¤ä»¥é›¶</td></tr><tr><td>ç»ˆæ­¢ï¼ˆabortï¼‰</td><td>åŒæ­¥</td><td>æ‰§è¡Œå†…éƒ¨æŒ‡ä»¤</td><td>ç¡¬ä»¶é”™è¯¯</td></tr></tbody></table></div><p><strong>æ³¨æ„ï¼šä¸€å®šè¦æ£€æŸ¥ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼ï¼Œä¸ç„¶ä¼šå‡ºç°ä¸€äº›å¾ˆéš¾è°ƒè¯•çš„é”™è¯¯ï¼</strong></p><p>å¼‚å¸¸å‘ç”Ÿåï¼Œæ§åˆ¶ä¼šè½¬ç§»ç»™å¼‚å¸¸å¤„ç†ç¨‹åºã€‚åœ¨å¤„ç†å®Œæˆåï¼Œæ ¹æ®å¼‚å¸¸çš„å…·ä½“å†…å®¹å¯èƒ½ä¼šè¿”å›åˆ°åŸç¨‹åºçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œä¹Ÿå¯èƒ½è¿”å›åˆ°åŸç¨‹åºçš„å½“å‰æŒ‡ä»¤ï¼Œä¹Ÿå¯èƒ½ä¸è¿”å›ã€‚ï¼š</p><p><img src="/images/learning/open-course/CMU-15213/Notes/Chapter8/exception-control-shift.png" alt=""></p><h1 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a><strong>è¿›ç¨‹</strong></h1><h2 id="å¹¶å‘å’Œä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#å¹¶å‘å’Œä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="å¹¶å‘å’Œä¸Šä¸‹æ–‡åˆ‡æ¢"></a>å¹¶å‘å’Œä¸Šä¸‹æ–‡åˆ‡æ¢</h2><p>æˆ‘ä»¬å¯ä»¥å¹¶å‘åœ°æ‰§è¡Œå¤šä¸ªè¿›ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/images/learning/open-course/CMU-15213/Notes/Chapter8/concurrency.png" alt=""></p><p>ä½†æˆ‘ä»¬æ˜¯æ€ä¹ˆå®ç°è¿™ç§å¹¶å‘çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ä¸‹å›¾å±•ç°äº†å•æ ¸ CPU çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡ã€‚</p><p>ä¸Šä¸‹æ–‡åˆ‡æ¢çš„åŸå› å¤šç§å¤šæ ·ï¼Œä¸¾ä¸¤ä¸ªå¸¸è§ä¾‹å­ï¼šç”¨æˆ·å¯èƒ½æ‰§è¡Œç³»ç»Ÿè°ƒç”¨è€Œç­‰å¾…æŸä¸ªäº‹ä»¶ï¼ˆæ¯”å¦‚ç”¨ waitpid ç­‰å¾…å­è¿›ç¨‹ç»ˆæ­¢ï¼‰ï¼Œè¿™æ—¶å†…æ ¸å°±å¯ä»¥è®©å½“å‰è¿›ç¨‹ä¼‘çœ å¹¶åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ï¼›ç³»ç»Ÿæ¯éš”è‹¥å¹²æ¯«ç§’ä¹Ÿä¼šäº§ç”Ÿä¸€æ¬¡å®šæ—¶å™¨ä¸­æ–­çš„å¼‚å¸¸ï¼Œå¹¶åˆ‡æ¢åˆ°æ–°çš„è¿›ç¨‹ã€‚</p><p><img src="/images/learning/open-course/CMU-15213/Notes/Chapter8/content-change.png" alt=""></p><h2 id="è¿›ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢å’Œå›æ”¶"><a href="#è¿›ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢å’Œå›æ”¶" class="headerlink" title="è¿›ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢å’Œå›æ”¶"></a>è¿›ç¨‹çš„åˆ›å»ºã€ç»ˆæ­¢å’Œå›æ”¶</h2><p>æˆ‘ä»¬å¯ä»¥ç”¨ fork æ¥åˆ›å»ºä¸€ä¸ªå½“å‰è¿›ç¨‹çš„å¤åˆ¶â€”â€”å®ƒæ‰§è¡Œä¸€æ¬¡ï¼Œè¿”å›ä¸¤æ¬¡ï¼Œåˆ†åˆ«è¿”å›åˆ°çˆ¶è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹çš„å­è¿›ç¨‹ä¸­ã€‚å¯¹çˆ¶è¿›ç¨‹ï¼Œå®ƒè¿”å›å­è¿›ç¨‹çš„ pidï¼›å¯¹å­è¿›ç¨‹ï¼Œå®ƒè¿”å› 0.</p><p>å­è¿›ç¨‹åœ¨ç»ˆæ­¢åä¸ä¼šè‡ªåŠ¨è¢«æ¸…æ¥šï¼Œè€Œæ˜¯è¿›å…¥â€œåƒµæ­»è¿›ç¨‹â€çŠ¶æ€ï¼Œç›´åˆ°è¢«çˆ¶è¿›ç¨‹å›æ”¶ã€‚å¦‚æœçˆ¶è¿›ç¨‹ç»ˆæ­¢äº†ï¼Œinit è¿›ç¨‹ä¼šæˆä¸ºå®ƒçš„å­¤å„¿è¿›ç¨‹çš„å…»çˆ¶ã€‚å¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œæœ‰æ½œåœ¨çš„å†…å­˜æ³„æ¼ã€‚é‚£ä¹ˆï¼Œæ€ä¹ˆå›æ”¶å­è¿›ç¨‹å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ waitpid æ¥ç­‰å¾…å­è¿›ç¨‹ç»ˆæ­¢ï¼Œåœ¨ waitpid è¿”å›åï¼Œè¿™ä¸ªç»ˆæ­¢çš„å­è¿›ç¨‹ä¼šè¢«å›æ”¶ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ execve æ¥åŠ è½½å¹¶è¿è¡Œç¨‹åºã€‚execve å‡½æ•°åœ¨å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­åŠ è½½å¹¶è¿è¡Œä¸€ä¸ªæ–°ç¨‹åºï¼Œåªæœ‰åœ¨å‡ºç°é”™è¯¯æ—¶ï¼Œå®ƒæ‰ä¼šè¿”å›åˆ°è°ƒç”¨ç¨‹åºã€‚æ³¨æ„ï¼Œå®ƒå¹¶æ²¡æœ‰åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œè€Œæ˜¯åœ¨å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­åŠ è½½å¹¶è¿è¡Œæ–°ç¨‹åºã€‚</p><p>æ¥çœ‹ä¸€ä¸ªç»¼åˆè¿ç”¨ä¸Šé¢çš„ä¸œè¥¿çš„ä¾‹å­å§ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/wait.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    pid_t pid<span class="token punctuation">;</span>    pid <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fork failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å­è¿›ç¨‹</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Child process (PID: %d) running...\n"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä½¿ç”¨ execve åŠ è½½å¹¶è¿è¡Œ "ls" ç¨‹åº</span>        <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"/bin/ls"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// å‚æ•°åˆ—è¡¨</span>        <span class="token keyword">char</span> <span class="token operator">*</span>envp<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token constant">NULL</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token comment">// ç¯å¢ƒå˜é‡åˆ—è¡¨</span>        <span class="token function">execve</span><span class="token punctuation">(</span><span class="token string">"/bin/ls"</span><span class="token punctuation">,</span> argv<span class="token punctuation">,</span> envp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¦‚æœ execve è¿”å›ï¼Œè¯´æ˜æ‰§è¡Œå¤±è´¥</span>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"execve failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// çˆ¶è¿›ç¨‹</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Parent process (PID: %d), waiting for child (PID: %d)...\n"</span><span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä½¿ç”¨ waitpid ç­‰å¾…å­è¿›ç¨‹ç»ˆæ­¢å¹¶å›æ”¶</span>        <span class="token keyword">int</span> status<span class="token punctuation">;</span>        <span class="token function">waitpid</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>status<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é˜»å¡ç­‰å¾…å­è¿›ç¨‹ pid ç»“æŸ</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">WIFEXITED</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Child exited with status %d\n"</span><span class="token punctuation">,</span> <span class="token function">WEXITSTATUS</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="ä¿¡å·"><a href="#ä¿¡å·" class="headerlink" title="ä¿¡å·"></a><strong>ä¿¡å·</strong></h1><p>ä¿¡å·å…è®¸å†…æ ¸å¼‚æ­¥é€šçŸ¥ç›®æ ‡è¿›ç¨‹å‘ç”Ÿäº†ç‰¹å®šäº‹ä»¶ã€‚</p><h2 id="å‘é€å’Œæ¥æ”¶ä¿¡å·"><a href="#å‘é€å’Œæ¥æ”¶ä¿¡å·" class="headerlink" title="å‘é€å’Œæ¥æ”¶ä¿¡å·"></a>å‘é€å’Œæ¥æ”¶ä¿¡å·</h2><p><strong>å‘é€ä¿¡å·</strong><br>ä¿¡å·å¯ä»¥ç”±å†…æ ¸è‡ªåŠ¨ç”Ÿæˆï¼Œä¾‹å¦‚ï¼š</p><ul><li>å½“æŸä¸ªå­è¿›ç¨‹çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆæ¯”å¦‚ç»ˆæ­¢ã€æš‚åœã€æ¢å¤ï¼‰ï¼Œå†…æ ¸ä¼šå‘é€ä¸€ä¸ª <code>SIGCHLD</code> ä¿¡å·ç»™çˆ¶è¿›ç¨‹ï¼›</li><li>å½“æŸä¸ªè¿›ç¨‹å°è¯•é™¤ä»¥ 0 æ—¶ï¼Œå†…æ ¸ä¼šå‘é€ä¸€ä¸ª <code>SIGFPE</code> ä¿¡å·ç»™è¯¥è¿›ç¨‹ã€‚<br>æ­¤å¤–ï¼Œè¿›ç¨‹ä¹Ÿå¯ä»¥é€šè¿‡ <code>kill</code> å‡½æ•°æ‰‹åŠ¨è¯·æ±‚å†…æ ¸å‘å…¶ä»–è¿›ç¨‹å‘é€ä¿¡å·ã€‚</li></ul><p><strong>æ¥æ”¶ä¿¡å·</strong><br>å½“å†…æ ¸å°†ä¿¡å·ä¼ é€’ç»™ç›®æ ‡è¿›ç¨‹ï¼Œå¹¶è¿«ä½¿è¿›ç¨‹å¯¹æ­¤ä¿¡å·é‡‡å–è¡ŒåŠ¨ï¼ˆä¾‹å¦‚æ‰§è¡Œä¿¡å·å¤„ç†ç¨‹åºæˆ–é»˜è®¤è¡Œä¸ºï¼‰æ—¶ï¼Œè¿›ç¨‹å°±æ¥æ”¶äº†è¯¥ä¿¡å·ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¿¡å·è¢«é˜»å¡æˆ–æš‚æ—¶æœªå¤„ç†ï¼Œå®ƒä¸ä¼šè¢«è§†ä¸ºâ€œå·²æ¥æ”¶â€ï¼Œè€Œæ˜¯è¿›å…¥å¾…å¤„ç†çŠ¶æ€ã€‚</p><p>æˆ‘ä»¬èƒ½ç”¨ <code>signal</code> å‡½æ•°ä¿®æ”¹æ¥æ”¶ä¿¡å·åçš„è¡Œä¸ºã€‚</p><p><strong>æœªæ¥æ”¶çš„ä¿¡å·ä¼šæ€æ ·ï¼Ÿ</strong><br>å¦‚æœä¿¡å·å‘å‡ºåæœªè¢«ç«‹å³æ¥æ”¶ï¼Œå®ƒä¼šå˜æˆä¸€ä¸ªå¾…å¤„ç†ä¿¡å·ã€‚å†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªè¡¨ç¤ºå¾…å¤„ç†ä¿¡å·çš„ä½å‘é‡ï¼ˆpending signal bit vectorï¼‰ï¼Œç”¨ä»¥è¿½è¸ªæœ‰å“ªäº›ä¿¡å·å°šæœªå¤„ç†ã€‚ç”±äºä¿¡å·ä¸æ’é˜Ÿï¼ŒåŒä¸€æ—¶åˆ»åŒä¸€ç±»å‹çš„å¾…å¤„ç†ä¿¡å·æœ€å¤šåªæœ‰ä¸€ä¸ªï¼ˆå³ä½å‘é‡ä¸­è¯¥ä½è¢«ç½®ä¸º 1ï¼‰ã€‚å¦‚æœæŸä¸ªç±»å‹å·²ç»æœ‰äº†å¾…å¤„ç†ä¿¡å·ï¼Œè¢«å‘é€è¿‡æ¥çš„åŒç±»ä¿¡å·ä¼šè¢«ç®€å•åœ°ä¸¢å¼ƒã€‚æ­¤å¤–ï¼Œå†…æ ¸è¿˜ä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªè¡¨ç¤ºè¢«é˜»å¡ä¿¡å·çš„ä½å‘é‡ï¼ˆblocked signal bit vectorï¼‰ï¼Œç”¨æ¥è®°å½•å½“å‰è¢«å±è”½ã€ä¸å…è®¸ä¼ é€’çš„ä¿¡å·ã€‚</p><h2 id="å¼‚æ­¥çš„é£é™©"><a href="#å¼‚æ­¥çš„é£é™©" class="headerlink" title="å¼‚æ­¥çš„é£é™©"></a>å¼‚æ­¥çš„é£é™©</h2><p>ä¸‹é¢çš„ä¾‹å­å¾ˆå¥½åœ°è¯´æ˜äº†å¼‚æ­¥çš„é£é™©</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"csapp.h"</span></span><span class="token keyword">volatile</span> sig_atomic_t pid<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">sigchld_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> olderrno <span class="token operator">=</span> errno<span class="token punctuation">;</span>    pid <span class="token operator">=</span> <span class="token function">waitpid</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨å­è¿›ç¨‹ç»ˆæ­¢åæ›´æ–°pid</span>    errno <span class="token operator">=</span> olderrno<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">sigint_handler</span><span class="token punctuation">(</span><span class="token keyword">int</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    sigset_t mask<span class="token punctuation">,</span> prev<span class="token punctuation">;</span>    <span class="token function">Signal</span><span class="token punctuation">(</span>SIGCHLD<span class="token punctuation">,</span> sigchld_handler<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨å­è¿›ç¨‹ç»ˆæ­¢åæ›´æ–°pid</span>    <span class="token function">Signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span> sigint_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Sigemptyset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">Sigaddset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>mask<span class="token punctuation">,</span> SIGCHLD<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">Sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Block SIGCHLD */</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* Child */</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">/* Parent */</span>        pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// æˆ‘ä»¬ block ä¿¡å·ï¼Œè¿™æ ·å³ä½¿å­è¿›ç¨‹åœ¨è¿™æ¡è¯­å¥å‰ç»ˆæ­¢ï¼Œpidä¹Ÿèƒ½æ­£ç¡®æ›´æ–°</span>        <span class="token function">Sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Unblock SIGCHLD */</span>        <span class="token comment">/* Wait for SIGCHLD to be received (wasteful) */</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>pid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ½œåœ¨çš„ç«äº‰ï¼</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">/* Do some work after receiving SIGCHLD */</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…ˆæ¥çœ‹çœ‹ä¸‹é¢çš„å±€éƒ¨ä»£ç ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">Sigprocmask</span><span class="token punctuation">(</span>SIG_BLOCK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mask<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Block SIGCHLD */</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">/* Child */</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* Parent */</span>pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// æˆ‘ä»¬ block ä¿¡å·ï¼Œè¿™æ ·å³ä½¿å­è¿›ç¨‹åœ¨è¿™æ¡è¯­å¥å‰ç»ˆæ­¢ï¼Œpidä¹Ÿèƒ½æ­£ç¡®æ›´æ–°</span><span class="token function">Sigprocmask</span><span class="token punctuation">(</span>SIG_SETMASK<span class="token punctuation">,</span> <span class="token operator">&amp;</span>prev<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* Unblock SIGCHLD */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä¸ä½¿ç”¨ blockï¼Œè€Œå­è¿›ç¨‹åœ¨ pid=0 è¿™æ¡è¯­å¥å‰ç»ˆæ­¢ï¼Œé‚£ä¹ˆä¿¡å·å¤„ç†ç¨‹åºä¼šå…ˆæŠŠ pid è®¾ç½®ä¸ºå­è¿›ç¨‹ pidï¼Œç„¶å pid è¢«é‡ç½®ä¸º 0ï¼Œå¯¼è‡´æˆ‘ä»¬æ²¡èƒ½æ­£ç¡®è®°å½• pidã€‚è¿™å°±æ˜¯<strong>é˜»å¡ä¿¡å·</strong>çš„é‡è¦æ€§ã€‚</p><p>å†æ¥çœ‹çœ‹è¿™é‡Œï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>pid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ½œåœ¨çš„ç«äº‰ï¼</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬çš„åŸæ„æ˜¯åœ¨æ²¡æœ‰æ¥æ”¶åˆ°ä¿¡å·æ—¶æš‚åœï¼Œä»¥é¿å…ç©ºå¾ªç¯æµªè´¹å¤„ç†å™¨èµ„æºã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨æ”¶åˆ°å­è¿›ç¨‹ç»ˆæ­¢çš„ä¿¡å·å pause çŠ¶æ€ä¼šç»“æŸï¼Œç„¶åæ‰§è¡Œä¿¡å·å¤„ç†ä»£ç ï¼Œç„¶åè¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯ã€‚</p><p>ä½†è¿™ä¸ª pause å¸¦æ¥äº†æ½œåœ¨çš„ç«äº‰ã€‚æ¯”å¦‚è¯´ï¼Œå¦‚æœåœ¨ while æµ‹è¯•åå’Œ pause å‰æ”¶åˆ°ä¿¡å·ï¼Œä¹‹ååˆæ²¡æœ‰åˆ«çš„ä¿¡å·ï¼Œpause å°±ä¼šè¿›å…¥æ°¸ä¹…ç¡çœ ã€‚è¿™å°±æ˜¯<strong>ç«äº‰çš„é£é™©</strong>ã€‚</p><p>å¯¹è¿™ä¸ªä¾‹å­ï¼Œè§£å†³åŠæ³•æ˜¯ç”¨ sigsuspend æ›¿æ¢ pauseï¼Œæˆ‘ä»¬ä¸å¤šè¯´äº†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;style&gt;
img{
    width: 70%;
}
&lt;/style&gt;

&lt;p&gt;å½“æˆ‘ä»¬åœ¨ç¨‹åºæ‰§è¡Œæ—¶æŒ‰ä¸‹ ctrl+c ï¼Œç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿä¸ºè§£ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥&lt;strong&gt;å¼‚å¸¸æ§åˆ¶æµ&lt;/strong&gt;ï¼ˆexceptional control flowï¼ŒECFï¼‰çš„æ¦‚å¿µã€‚</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="CMU-15-213" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/"/>
    
    <category term="Notes" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/Notes/"/>
    
    
  </entry>
  
  <entry>
    <title>Cachelabç†è®ºåˆ†æ</title>
    <link href="http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Labs/Cachelab/"/>
    <id>http://rinevard.github.io/wiki/learning/open-course/CMU-15-213/Labs/Cachelab/</id>
    <published>2025-03-26T10:37:28.000Z</published>
    <updated>2025-08-20T11:13:48.877Z</updated>
    
    <content type="html"><![CDATA[<style>img{    width: 60%;}</style><p>å…ˆæ”¾ä¸€ä¸ªæœ€ç»ˆç»“æœåœ¨è¿™é‡Œ</p><p><img src="/images/learning/open-course/CMU-15213/Labs/Cachelab/result.png" alt=""></p><h1 id="Part-A-æ¨¡æ‹Ÿ-cache"><a href="#Part-A-æ¨¡æ‹Ÿ-cache" class="headerlink" title="Part A æ¨¡æ‹Ÿ cache"></a>Part A æ¨¡æ‹Ÿ cache</h1><p>ç”¨æ—¶ 3h.</p><p>ä¸€å¼€å§‹å› ä¸º 16 è¿›åˆ¶è¸©äº†å‘ã€‚æˆ‘ç¬¬ä¸€ä¸ªçœ‹çš„ trace æ–‡ä»¶æ˜¯ yi.traceï¼Œæˆ‘æŠŠé‡Œé¢çš„åœ°å€å½“æˆäº†åè¿›åˆ¶ï¼Œåˆ†æäº†åŠå¤©æ€»æ„Ÿè§‰ä¸å¯¹ï¼Œåæ¥æƒŠé†’è¿™æ˜¯åå…­è¿›åˆ¶ã€‚</p><p>part A ä¸éš¾ï¼Œæ­£å¸¸æ¨¡æ‹Ÿä¸€éå°±å¥½ã€‚ç”±äº handout é‡Œè¯´ï¼Œâ€œyou should assume that memory accesses are aligned properly, such that a single memory access never crosses block boundariesâ€ï¼Œæ‰€ä»¥å¯¹æ¯è¡Œè®°å½•ï¼Œæˆ‘ä»¬åªè¦è€ƒè™‘å…¶æŒ‡ä»¤ç±»å‹å’Œåœ°å€å³å¯ï¼Œä¸å¿…è€ƒè™‘æ“ä½œå¤§å°ã€‚æˆ‘ä½¿ç”¨äº†è¿™æ ·çš„æ•°æ®ç»“æ„ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> valid<span class="token punctuation">;</span>    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> lineTag<span class="token punctuation">;</span>    <span class="token keyword">int</span> lruCount<span class="token punctuation">;</span> <span class="token comment">// è®°å½•ä¸Šä¸€æ¬¡è®¿é—®åˆ°ç°åœ¨çš„æ—¶é—´</span><span class="token punctuation">&#125;</span> CacheLine<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>    CacheLine <span class="token operator">*</span>lines<span class="token punctuation">;</span><span class="token punctuation">&#125;</span> CacheSet<span class="token punctuation">;</span>CacheSet <span class="token operator">*</span>sets <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> s<span class="token punctuation">)</span><span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CacheSet<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ ¸å¿ƒå¾ªç¯é‡Œï¼Œå¯¹æŸä¸ªç»™å®šçš„ setï¼Œæˆ‘ä»¬åœ¨éå†è¿‡ç¨‹ä¸­ä»å‰å¾€åå¡«å……æ¯ä¸ª set çš„ lineï¼Œæ€è·¯å¦‚ä¸‹ï¼š</p><p>å¯¹æ¯ä¸ªåœ°å€ï¼Œç”¨ä½è¿ç®—å¾—åˆ°å…¶ setIdx å’Œ tagï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„ setï¼Œéå†é‡Œé¢çš„æ‰€æœ‰ line. å¦‚æœæ‰¾åˆ°äº†ç©º lineï¼Œç›´æ¥å¡«å……è¿›å»ï¼›å¦‚æœæ‰¾åˆ°äº†å¯¹åº”çš„ tagï¼Œå°± hit äº†ï¼›å¦‚æœæ²¡æ‰¾åˆ°å¯¹åº” tagï¼Œè¯´æ˜éœ€è¦é©±é€æŸä¸ª lineï¼Œæ‰¾åˆ° lru æœ€å¤§çš„ lineï¼ˆå³æœ€ä¹…æ²¡æœ‰è®¿é—®è¿‡çš„ lineï¼‰å¹¶æŠŠå®ƒæ¢æ‰å³å¯ã€‚</p><p>æ³¨æ„æ­£ç¡®æ›´æ–°éå†çš„ set é‡Œçš„æ¯ä¸ª line çš„ lruCount.</p><p>ç”¨ä¸‹é¢çš„ä½è¿ç®—å°±èƒ½å¾—åˆ° setIdx å’Œ tagï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">unsigned</span> <span class="token keyword">long</span> mask <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>mask <span class="token operator">=</span> <span class="token operator">~</span><span class="token punctuation">(</span>mask <span class="token operator">&lt;&lt;</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 000...11 (s ä¸ª 1)</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> setIdx <span class="token operator">=</span> <span class="token punctuation">(</span>address <span class="token operator">>></span> b<span class="token punctuation">)</span> <span class="token operator">&amp;</span> mask<span class="token punctuation">;</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> tag <span class="token operator">=</span> address <span class="token operator">>></span> <span class="token punctuation">(</span>b <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿˜æœ‰ä¸€ä¸ªå° trick æ˜¯å¯ä»¥ç”¨è¿™æ ·çš„å†™æ³•æ¥ç®€åŒ–ä»£ç ï¼Œæ¯•ç«Ÿæˆ‘ä»¬å¹¶ä¸å…³å¿ƒæ“ä½œåœ¨ç±»å‹ä¸Šçš„å·®å¼‚ï¼Œåªå…³å¿ƒæ“ä½œçš„åœ°å€ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">switch</span> <span class="token punctuation">(</span>operation<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> <span class="token char">'M'</span><span class="token operator">:</span>        <span class="token comment">// M = L + S, å…¶ 'S' æ€»ä¼šå‘½ä¸­</span>        hits<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token comment">// fall through</span>    <span class="token keyword">case</span> <span class="token char">'L'</span><span class="token operator">:</span>        <span class="token comment">// fall through</span>    <span class="token keyword">case</span> <span class="token char">'S'</span><span class="token operator">:</span>        <span class="token comment">// çœŸæ­£çš„å·¥ä½œ</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Part-B"><a href="#Part-B" class="headerlink" title="Part B"></a>Part B</h1><p>ç”¨æ—¶ 7 hï¼Œæ‹¼å°½å…¨åŠ›ä¹Ÿåªèƒ½æŠŠ 64x64 æ‹¿åˆ° 1411 missï¼Œä¸Šç½‘æ‰¾äº†æ‰¾åˆ«äººçš„æ€è·¯ï¼Œæœ€åå¾—åˆ°äº† 1179 miss. æœ€åç»“æœå¦‚ä¸‹ï¼š</p><p>Points Max pts Misses<br>Trans perf 32x32 8.0 8 287<br>Trans perf 64x64 8.0 8 1179<br>Trans perf 61x67 10.0 10 1997</p><p>æˆ‘å‚è€ƒçš„æ–‡ç« æ˜¯è¿™ç¯‡ï¼š <a href="https://zhuanlan.zhihu.com/p/387662272">CSAPP - Cache Lab çš„æ›´(æœ€)ä¼˜ç§€çš„è§£æ³• - çŸ¥ä¹</a>ï¼Œä½œè€…ç›´æ¥æ‹¿åˆ°äº† 64x64 çš„ç†è®ºæœ€ä¼˜è§£ï¼Œéå¸¸å¼ºå¤§ã€‚ä¸è¿‡æˆ‘æ²¡æœ‰åœ¨å¯¹è§’çº¿ä¸Šåšå¾®è°ƒï¼Œè€Œæ˜¯åªå‚è€ƒäº†ä½œè€…å¯¹ä¸€èˆ¬å—çš„è¯»å†™é¡ºåºã€‚</p><p>æˆ‘çš„ä¸‰ä¸ªè½¬ç½®éƒ½æ²¡æœ‰ç‰¹åˆ«è€ƒè™‘å¯¹è§’çº¿çš„æƒ…å†µã€‚ä¸€æ–¹é¢æ˜¯å› ä¸ºå«Œéº»çƒ¦ï¼Œå¦ä¸€æ–¹é¢æ˜¯å› ä¸ºæˆ‘è§‰å¾—è¿™ç§â€œä¸¤ä¸ªå†…å­˜å—ä½ç½®æ°å¥½å·® 2 çš„å¹‚æ¬¡å¯¼è‡´ç¼“å­˜æŠ–åŠ¨â€çš„äº‹æƒ…å¤ªç‰¹æ®Šï¼Œæ‰€ä»¥æ²¡é¢å¤–å¤„ç†ã€‚</p><h2 id="åˆ†å—å¤§å°çš„ç¡®å®š"><a href="#åˆ†å—å¤§å°çš„ç¡®å®š" class="headerlink" title="åˆ†å—å¤§å°çš„ç¡®å®š"></a>åˆ†å—å¤§å°çš„ç¡®å®š</h2><p>é¦–å…ˆï¼Œåˆ†å—ä¼˜åŒ–æ˜¯ä¸€å®šè¦åšçš„ã€‚ä½†åˆ†æˆå¤šå¤§çš„å—å‘¢ï¼Ÿæœ€æœ´ç´ çš„æƒ³æ³•æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›å—å°½å¯èƒ½å¤§æ¥è£…æ»¡ cacheï¼Œä½†ä¸è¦å¤ªå¤§ä»¥è‡³äº cache è£…ä¸ä¸‹ã€‚</p><p>æˆ‘ä»¬æœ‰ $2^5 = 32$ ä¸ª setsï¼Œæ¯ä¸ª set ä¸€ä¸ª lineï¼Œæ¯ä¸ª line å­˜ 8 ä¸ª intï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æœ€å¤šèƒ½å­˜ $32 \times 8 = 256 = 2^8$ ä¸ª int. æˆ‘ä»¬å¸Œæœ›åŒæ—¶æŠŠ A çš„å—å’Œ B çš„å—æ”¾åˆ° cache ä¸­ï¼Œä¸¤ä¸ªå—å¤§å°åº”å½“ç›¸åŒï¼Œæ‰€ä»¥æ¯ä¸ªå—å¯ä»¥æ”¾ $256/2 = 128$ ä¸ª int. 128 ä¸æ˜¯å®Œå…¨å¹³æ–¹æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ†å—æˆ 8x8.</p><h2 id="åˆç‰ˆä»£ç "><a href="#åˆç‰ˆä»£ç " class="headerlink" title="åˆç‰ˆä»£ç "></a>åˆç‰ˆä»£ç </h2><p>å›åˆ°ä¹‹å‰çš„ 8x8 åˆ†å—çš„è®¨è®ºä¸Šæ¥ã€‚æ€»ä¹‹ï¼Œæˆ‘å†™å‡ºäº†æˆ‘çš„åˆç‰ˆä»£ç ã€‚æ€è·¯å°±æ˜¯åˆ†å—ï¼Œç„¶åæŠŠ A çš„å—å­˜åˆ° tmp æ•°ç»„é‡Œï¼Œç„¶åå¤åˆ¶åˆ° B é‡Œã€‚ä¸ºä»€ä¹ˆè¦ç”¨ tmp åšä¸­è½¬å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸ºäº†é¿å…ç¼“å­˜å†²çªï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">transpose_submit</span><span class="token punctuation">(</span><span class="token keyword">int</span> M<span class="token punctuation">,</span> <span class="token keyword">int</span> N<span class="token punctuation">,</span> <span class="token keyword">int</span> A<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> B<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> blockSize <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> rowBlock<span class="token punctuation">,</span> colBlock<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>    <span class="token comment">// å‘ä¸Šå–æ•´, è®¡ç®—å‡ºæ€» block æ•°.</span>    <span class="token comment">// å¯èƒ½ä¼šå«æœ‰ä¸æ˜¯æ­£æ–¹å½¢çš„ block</span>    <span class="token keyword">int</span> rowBlocks <span class="token operator">=</span> <span class="token punctuation">(</span>N <span class="token operator">+</span> blockSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockSize<span class="token punctuation">;</span>    <span class="token keyword">int</span> colBlocks <span class="token operator">=</span> <span class="token punctuation">(</span>M <span class="token operator">+</span> blockSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockSize<span class="token punctuation">;</span>    <span class="token keyword">int</span> tmp<span class="token punctuation">[</span>blockSize<span class="token punctuation">]</span><span class="token punctuation">[</span>blockSize<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// cachelabä¸å…è®¸å¼€æ•°ç»„</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>rowBlock <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> rowBlock <span class="token operator">&lt;</span> rowBlocks<span class="token punctuation">;</span> rowBlock<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>colBlock <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> colBlock <span class="token operator">&lt;</span> colBlocks<span class="token punctuation">;</span> colBlock<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> rowBlock <span class="token operator">*</span> blockSize<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>rowBlock <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> blockSize <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> colBlock <span class="token operator">*</span> blockSize<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>colBlock <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> blockSize <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    tmp<span class="token punctuation">[</span>j <span class="token operator">-</span> colBlock <span class="token operator">*</span> blockSize<span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">-</span> rowBlock <span class="token operator">*</span> blockSize<span class="token punctuation">]</span> <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> colBlock <span class="token operator">*</span> blockSize<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token punctuation">(</span>colBlock <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> blockSize <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> rowBlock <span class="token operator">*</span> blockSize<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>rowBlock <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> blockSize <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">[</span>j <span class="token operator">-</span> colBlock <span class="token operator">*</span> blockSize<span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">-</span> rowBlock <span class="token operator">*</span> blockSize<span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœå¾ˆä¸é”™ï¼š</p><p>Cache Lab summary:<br>Points Max pts Misses<br>Trans perf 32x32 8.0 8 261<br>Trans perf 64x64 8.0 8 1029<br>Trans perf 61x67 10.0 10 1725</p><p>æ­£å½“æˆ‘è§‰å¾— cachelab ä¸è¿‡å¦‚æ­¤çš„æ—¶å€™ï¼Œå¿½ç„¶å‘ç° handout é‡Œå†™äº†ä¸å…è®¸å¼€æ•°ç»„ï¼ˆå“ˆå“ˆï¼Œä½ æƒ³å¾—åˆ°çš„ cmu è€å¸ˆæƒ³ä¸åˆ°å—ï¼‰ï¼Œäºæ˜¯è¢«è¿«æ‰‹åŠ¨å±•å¼€äº† j å¾ªç¯ï¼Œä½¿ç”¨ 8 ä¸ªå˜é‡æ¥è¯»å–æ¯è¡Œçš„å€¼ã€‚è¿™å°±å¾—åˆ°äº†ä¸‹é¢çš„ç»“æœï¼š</p><p>Cache Lab summary:<br>Points Max pts Misses<br>Trans perf 32x32 8.0 8 287<br>Trans perf 64x64 0.0 8 4611<br>Trans perf 61x67 10.0 10 1997</p><p>ä¹Ÿè¿˜ç®—ä¸é”™å§ï¼Œæ¯•ç«Ÿ 32x32 å’Œ 61x67 éƒ½æ»¡åˆ†äº†ã€‚å”¯ä¸€çš„é—®é¢˜æ˜¯ 64x64 çš„æ€§èƒ½å¥‡å·®æ— æ¯”ã€‚</p><h2 id="åˆ†æ-64x64-çŸ©é˜µçš„-miss-æ¬¡æ•°"><a href="#åˆ†æ-64x64-çŸ©é˜µçš„-miss-æ¬¡æ•°" class="headerlink" title="åˆ†æ 64x64 çŸ©é˜µçš„ miss æ¬¡æ•°"></a>åˆ†æ 64x64 çŸ©é˜µçš„ miss æ¬¡æ•°</h2><p>è¿™æ—¶å€™å°±è¦ç†è®ºåˆ†æäº†ã€‚å¯¹ 64x64 çš„çŸ©é˜µï¼ŒæŒ‰æˆ‘ä»¬ä¹‹å‰çš„åšæ³•ï¼Œæ¯ä¸ª 8x8 çš„å—å¤§çº¦å‘ç”Ÿäº†å¤šå°‘æ¬¡ miss å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ 72 æ¬¡ã€‚A æä¾›äº† 8 æ¬¡ missï¼ŒB æä¾›äº† 64 æ¬¡ miss</p><p>éªŒè¯ä¸€ä¸‹ç»“æœå¯¹ä¸å¯¹ï¼š64x64 çš„çŸ©é˜µå…±æœ‰ 64 ä¸ª 8x8 çš„å—ï¼Œ64 ä¸ªå—æ¯ä¸ªå— 72 æ¬¡ missï¼Œæ€»è®¡çº¦ $64 \times 72=4608$ æ¬¡ missï¼Œå’Œç»“æœ 4611 æ¬¡ miss ç›¸å·®æ— å‡ ã€‚</p><p>è¿™ä¸ª miss æ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„å‘¢ï¼Ÿè®©æˆ‘ä»¬çœ‹çœ‹ä¸‹å›¾ï¼š</p><p><img src="/images/learning/open-course/CMU-15213/Labs/Cachelab/64x64bad.png" alt=""></p><p>å¯¹ 64x64 çš„çŸ©é˜µæ¥è¯´ï¼ŒB[x][y] å’Œ B[x+4][y] çš„ setIdx ç›¸åŒï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬ä¹‹å‰çš„æ–¹æ³•ä¸æ–­é©±é€æ—§ line. å®šé‡åœ°è¯´ï¼Œæ¯è¯» A çš„å—çš„ä¸€è¡Œï¼Œå¤§çº¦æ˜¯ 1 ä¸ª missï¼ŒA çš„å—å…±æœ‰ 8 è¡Œï¼Œæ‰€ä»¥ A çš„æ¯ä¸ªå—æä¾› 8 æ¬¡ missï¼›æ¯å¯¹ B çš„å—å†™å…¥ä¸€ä¸ªå€¼ï¼Œéƒ½é©±é€äº†ä¸€æ¬¡æ—§ lineï¼ˆå› ä¸º B[x+4][y] ä¼šé©±é€ B[x][y]ï¼‰ï¼Œæ‰€ä»¥ B çš„æ¯ä¸ªå—æä¾› 64 æ¬¡ miss.</p><p>ä¹‹åçš„å·¥ä½œå°±æ˜¯æ‰¾åˆ°æ–¹æ³•æ¥é¿å…è¿™ç§é©±é€äº†ã€‚</p><h2 id="å¯¹-64x64-çŸ©é˜µçš„ç¬¬ä¸€æ¬¡ä¼˜åŒ–â€”â€”1699"><a href="#å¯¹-64x64-çŸ©é˜µçš„ç¬¬ä¸€æ¬¡ä¼˜åŒ–â€”â€”1699" class="headerlink" title="å¯¹ 64x64 çŸ©é˜µçš„ç¬¬ä¸€æ¬¡ä¼˜åŒ–â€”â€”1699"></a>å¯¹ 64x64 çŸ©é˜µçš„ç¬¬ä¸€æ¬¡ä¼˜åŒ–â€”â€”1699</h2><p>ä¸€å¼€å§‹æˆ‘çš„æ€è·¯æ˜¯ç›´æ¥ç”¨ 4x4 çš„å—ï¼Œè¿™ç¡®å®æœ‰ä¸å°ä¼˜åŒ–ï¼Œä½†ç¦»æ»¡åˆ†è¿˜å¾ˆè¿œã€‚è¯»è€…å¯ä»¥è¯•ç€åšä¸€ä¸ªç†è®ºåˆ†æçœ‹çœ‹ 4x4 çš„ç»“æœå¤§æ¦‚æ˜¯å¤šå°‘ missã€‚æˆ‘åˆ†æå‡ºæ¥ä¼šå¾—åˆ° 1536 ä¸ª missï¼Œå®é™…ç»“æœæ˜¯ 1699 ä¸ª missï¼Œä¹Ÿå·®ä¸å¤šå§ã€‚</p><p>å¥½å§ï¼Œè¿™ä¸ªç†è®ºåˆ†æçœ‹èµ·æ¥å€¼å¾—è¯¦ç»†è®²è§£ä¸€ä¸‹ã€‚ä¸è¿‡åœ¨å†™ä¹‹å‰ï¼Œå¸Œæœ›è¯»è€…è‡ªå·±åˆ†æä¸€ä¸‹ï¼Œçœ‹çœ‹å¾—åˆ°çš„ç»“æœæ˜¯ä¸æ˜¯ 2048ï¼Œå¹¶æƒ³æƒ³å“ªé‡Œå‡ºé”™äº†ï¼š</p><p>å¦‚æœå—çš„å¤§å°æ˜¯ 4x4ï¼Œæ¯ä¸ªå—å‘ç”Ÿ 4 æ¬¡ missï¼Œæ¯ä¸ªçŸ©é˜µ 256 ä¸ªå—ï¼Œä¸€å…± 2048 æ¬¡ missï¼Œçœ‹èµ·æ¥å¾ˆåˆç†ã€‚ä½†è¿™æ˜¯ç†è®ºæœ€ä¼˜è§£ï¼Œä¸ºä»€ä¹ˆç†è®ºæœ€ä¼˜ï¼ˆ2048ï¼‰æ¯”å®é™…ç»“æœï¼ˆ1699ï¼‰è¿˜å·®å‘¢ï¼Ÿéš¾é“è¯´æ•°å­¦çš„å¤§å¦å´©å¡Œäº†ï¼Ÿ</p><p>å¹¶éå¦‚æ­¤ã€‚äº‹å®ä¸Šï¼Œåœ¨æˆ‘ä»¬æŠŠæŸä¸ª 4x4 çš„å—æ”¾å…¥ cache æ—¶ï¼Œæˆ‘ä»¬ä¹ŸåŒæ—¶æŠŠå®ƒçš„å³è¾¹çš„é‚£ä¸ª 4x4 çš„å—æ”¾å…¥äº† cacheã€‚è¿™æ˜¯å› ä¸º cache çš„æ¯ä¸ª line èƒ½è£… 8 ä¸ª int.</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨å¤„ç† 4x8 çš„å—ã€‚å¯¹æ¯ä¸ª 4x8 çš„å—ï¼ŒA æä¾›äº† 4 æ¬¡ missï¼ŒB æä¾›äº† 8 æ¬¡ missï¼Œæ€»è®¡ $64 <em> 4 + 64 </em> 8 = 1536$ æ¬¡ miss.</p><h2 id="å¯¹-64x64-çŸ©é˜µçš„ç¬¬äºŒæ¬¡ä¼˜åŒ–â€”â€”1411"><a href="#å¯¹-64x64-çŸ©é˜µçš„ç¬¬äºŒæ¬¡ä¼˜åŒ–â€”â€”1411" class="headerlink" title="å¯¹ 64x64 çŸ©é˜µçš„ç¬¬äºŒæ¬¡ä¼˜åŒ–â€”â€”1411"></a>å¯¹ 64x64 çŸ©é˜µçš„ç¬¬äºŒæ¬¡ä¼˜åŒ–â€”â€”1411</h2><p>åˆ†æäº†é‚£ä¹ˆå¤šï¼Œè¿˜æ˜¯æ²¡æ‹¿åˆ°æ»¡åˆ†ã€‚æˆ‘çš„åç»­æ€è·¯æ˜¯æŠŠ 8x8 çš„å—å†åˆ†æˆå››ä¸ªå°å—ï¼Œå¹¶æŒ‰ä¸‹é¢çš„é¡ºåºæ¥å†™å…¥ Bï¼š</p><p><img src="/images/learning/open-course/CMU-15213/Labs/Cachelab/64x64normal.png" alt=""></p><p>ç†è®ºåˆ†æä¸€ä¸‹ï¼ŒæŠŠ A1 å†™å…¥ B1 æ—¶ï¼ŒA miss 4 æ¬¡ï¼ŒB miss 4 æ¬¡ï¼›</p><p>æŠŠ A2 å†™å…¥ B2 æ—¶ï¼ŒA miss 4 æ¬¡ï¼ŒB æ²¡æœ‰ missï¼ˆå› ä¸ºå†™å…¥ B1 æ—¶æŠŠ B2 æ”¾è¿›äº† cacheï¼‰ï¼›</p><p>æŠŠ A3 å†™å…¥ B3 æ—¶ï¼ŒA æ²¡æœ‰ missï¼ŒB miss 4 æ¬¡ï¼›ï¼ˆå› ä¸ºè¯» A2 æ—¶æŠŠ A3 æ”¾å…¥äº† cacheï¼‰ï¼›</p><p>æŠŠ A4 å†™å…¥ B4 æ—¶ï¼ŒA miss 4 æ¬¡ï¼ŒB æ²¡æœ‰ missï¼ˆå› ä¸ºå†™å…¥ B3 æ—¶æŠŠ B4 æ”¾è¿›äº† cacheï¼‰</p><p>æ€»è®¡ 20 æ¬¡ missï¼Œç†è®ºæœ€ä¼˜è§£ 1280ï¼Œå®é™…ç»“æœ 1411ï¼Œæˆ‘çŒœé—®é¢˜å‡ºåœ¨å¯¹è§’çº¿ä¸Šï¼Œæˆ‘ä¹Ÿæ‡’å¾—åœ¨è¿™ä¸ªåŸºç¡€ä¸Šç»§ç»­ä¼˜åŒ–äº†ã€‚ä¼˜åŒ–å¯¹è§’çº¿è¿™ç§äº‹æƒ…çœ‹èµ·æ¥å°±å¾ˆéº»çƒ¦ï¼Œè€Œä¸”æ„Ÿè§‰ç°å®é‡Œå‡ ä¹ä¸ä¼šé‡è§è¿™ç§æƒ…å†µã€‚</p><h2 id="å¯¹-64x64-çŸ©é˜µçš„ç¬¬äºŒæ¬¡ä¼˜åŒ–â€”â€”1179"><a href="#å¯¹-64x64-çŸ©é˜µçš„ç¬¬äºŒæ¬¡ä¼˜åŒ–â€”â€”1179" class="headerlink" title="å¯¹ 64x64 çŸ©é˜µçš„ç¬¬äºŒæ¬¡ä¼˜åŒ–â€”â€”1179"></a>å¯¹ 64x64 çŸ©é˜µçš„ç¬¬äºŒæ¬¡ä¼˜åŒ–â€”â€”1179</h2><p>æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç›´æ¥çœ‹ <a href="https://zhuanlan.zhihu.com/p/387662272">CSAPP - Cache Lab çš„æ›´(æœ€)ä¼˜ç§€çš„è§£æ³• - çŸ¥ä¹</a> å’Œä»£ç å§ã€‚è¿™ç¯‡æ–‡ç« çš„ä½œè€…æ‹¿åˆ°äº† 64x64 çš„ç†è®ºæœ€ä¼˜è§£ï¼Œéå¸¸å¼ºå¤§ã€‚ä¸è¿‡æˆ‘æ²¡æœ‰åœ¨å¯¹è§’çº¿ä¸Šåšå¾®è°ƒï¼Œè€Œæ˜¯åªå‚è€ƒäº†ä½œè€…å¯¹ä¸€èˆ¬å—çš„è¯»å†™é¡ºåºã€‚</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">transpose_submit_64x64</span><span class="token punctuation">(</span><span class="token keyword">int</span> M<span class="token punctuation">,</span> <span class="token keyword">int</span> N<span class="token punctuation">,</span> <span class="token keyword">int</span> A<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> B<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> blockSize <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> rowBlock<span class="token punctuation">,</span> colBlock<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>    <span class="token keyword">int</span> rowBlocks <span class="token operator">=</span> <span class="token punctuation">(</span>N <span class="token operator">+</span> blockSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockSize<span class="token punctuation">;</span>    <span class="token keyword">int</span> colBlocks <span class="token operator">=</span> <span class="token punctuation">(</span>M <span class="token operator">+</span> blockSize <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockSize<span class="token punctuation">;</span>    <span class="token keyword">int</span> tmp0<span class="token punctuation">,</span> tmp1<span class="token punctuation">,</span> tmp2<span class="token punctuation">,</span> tmp3<span class="token punctuation">,</span> tmp4<span class="token punctuation">,</span> tmp5<span class="token punctuation">,</span> tmp6<span class="token punctuation">,</span> tmp7<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>rowBlock <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> rowBlock <span class="token operator">&lt;</span> rowBlocks<span class="token punctuation">;</span> rowBlock<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>colBlock <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> colBlock <span class="token operator">&lt;</span> colBlocks<span class="token punctuation">;</span> colBlock<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// Aä¸Š</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> rowBlock <span class="token operator">*</span> blockSize<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// è¯»å–Açš„ä¸€è¡Œ</span>                tmp0 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize<span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp1 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp2 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp3 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp4 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp5 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp6 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp7 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment">// å¡«å……Bå·¦ä¸Š</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp0<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp1<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp2<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp3<span class="token punctuation">;</span>                <span class="token comment">// å¡«å……Bå³ä¸Š, è¿™ä¸€éƒ¨åˆ†æœªæ¥ä¼šè¢«æ”¾åˆ°Bå·¦ä¸‹</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize<span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp4<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp5<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp6<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp7<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">// Aå·¦ä¸‹, æ³¨æ„è¿™é‡ŒæŒ‰åˆ—éå†</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> colBlock <span class="token operator">*</span> blockSize<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> M<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// è¯»å– A çš„å·¦ä¸‹å°å—çš„ä¸€åˆ—</span>                tmp0 <span class="token operator">=</span> A<span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp1 <span class="token operator">=</span> A<span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp2 <span class="token operator">=</span> A<span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp3 <span class="token operator">=</span> A<span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment">// è¯»å– B çš„å³ä¸Šå°å—çš„ä¸€è¡Œ</span>                tmp4 <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp5 <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp6 <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp7 <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment">// æŠŠä» A å·¦ä¸‹è¯»åˆ°çš„å†…å®¹å†™åˆ° B å³ä¸Š</span>                B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp0<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp1<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp2<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp3<span class="token punctuation">;</span>                <span class="token comment">// æŠŠ B å³ä¸Šçš„å†…å®¹å†™åˆ° B å·¦ä¸‹</span>                B<span class="token punctuation">[</span>j <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize<span class="token punctuation">]</span> <span class="token operator">=</span> tmp4<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>j <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp5<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>j <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp6<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>j <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp7<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">// Aå³ä¸‹</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> rowBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>rowBlock <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> blockSize <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// è¯»å–Açš„ä¸€è¡Œ</span>                tmp0 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp1 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp2 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                tmp3 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment">// å¡«å……B</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp0<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp1<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp2<span class="token punctuation">;</span>                B<span class="token punctuation">[</span>colBlock <span class="token operator">*</span> blockSize <span class="token operator">+</span> blockSize <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp3<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="Future-work"><a href="#Future-work" class="headerlink" title="Future work"></a>Future work</h1><p>å†™æ–‡ç« çš„æ—¶å€™çªç„¶æƒ³åˆ°æˆ‘ä»¬ä¼¼ä¹å¯ä»¥åˆ†é•¿æ–¹å½¢çš„ 16x8 çš„å—ï¼Œå› ä¸º $16<em>8</em>2 = 256$ å¯ä»¥å®Œå…¨å¡«æ»¡ cache. ç®€å•å†™äº†ä¸‹ä»£ç å¾—åˆ°äº†ä¸‹é¢çš„ç»“æœï¼š</p><p>[16x8]<br>Points Max pts Misses<br>Trans perf 32x32 8.0 8 287<br>Trans perf 61x67 10.0 10 1811<br>çœ‹èµ·æ¥æ•ˆæœå‡ºä¹æ„æ–™åœ°ä¸é”™ï¼Ÿç”šè‡³æ¯”æˆ‘çš„ 8x8 åˆ†å—æ•ˆæœæ›´å¥½ã€‚è¿™é‡Œæ²¡æœ‰æ”¾è¿›æ¥ 64x64 è½¬ç½®çš„ç»“æœï¼Œå› ä¸ºæˆ‘æ²¡æœ‰åšåˆ†å°å—çš„ä¼˜åŒ–ã€‚æ‰€ä»¥è¯´ï¼Œè¿™ç§æ–¹æ³•è¯´ä¸å®šè¿˜æœ‰ä¸å°æ¢ç´¢ç©ºé—´ï¼Ÿ</p><p>ä¸‹é¢æ˜¯æˆ‘çš„ 8x8 åˆ†å—çš„ç»“æœï¼Œå¯ä»¥ç”¨æ¥å’Œä¸Šé¢çš„ç»“æœåšæ¯”è¾ƒã€‚ä¸¤ä¸ªä»£ç éƒ½åªç”¨äº†ç®€å•çš„åˆ†å—å’Œ 8 ä¸ª tmp å˜é‡ï¼Œæ²¡æœ‰é¢å¤–ä¼˜åŒ–ã€‚</p><p>[8x8]</p><p>Points Max pts Misses<br>Trans perf 32x32 8.0 8 287<br>Trans perf 61x67 10.0 10 1997</p><p>è¿™é‡Œæ˜¯æˆ‘ä½¿ç”¨çš„ 16x8 çš„åˆ†å—ä»£ç ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">transpose_submit</span><span class="token punctuation">(</span><span class="token keyword">int</span> M<span class="token punctuation">,</span> <span class="token keyword">int</span> N<span class="token punctuation">,</span> <span class="token keyword">int</span> A<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> B<span class="token punctuation">[</span>M<span class="token punctuation">]</span><span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> blockRow <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>    <span class="token comment">// å—çš„è¡Œæ•°</span>    <span class="token keyword">int</span> blockCol <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>   <span class="token comment">// å—çš„åˆ—æ•°</span>    <span class="token keyword">int</span> rowBlock<span class="token punctuation">,</span> colBlock<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>    <span class="token comment">// å‘ä¸Šå–æ•´, è®¡ç®—å‡ºæ€» block æ•°</span>    <span class="token keyword">int</span> rowBlocks <span class="token operator">=</span> <span class="token punctuation">(</span>N <span class="token operator">+</span> blockRow <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockRow<span class="token punctuation">;</span>    <span class="token keyword">int</span> colBlocks <span class="token operator">=</span> <span class="token punctuation">(</span>M <span class="token operator">+</span> blockCol <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> blockCol<span class="token punctuation">;</span>    <span class="token keyword">int</span> tmp0<span class="token punctuation">,</span> tmp1<span class="token punctuation">,</span> tmp2<span class="token punctuation">,</span> tmp3<span class="token punctuation">,</span> tmp4<span class="token punctuation">,</span> tmp5<span class="token punctuation">,</span> tmp6<span class="token punctuation">,</span> tmp7<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>rowBlock <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> rowBlock <span class="token operator">&lt;</span> rowBlocks<span class="token punctuation">;</span> rowBlock<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>colBlock <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> colBlock <span class="token operator">&lt;</span> colBlocks<span class="token punctuation">;</span> colBlock<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> rowBlock <span class="token operator">*</span> blockRow<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span>rowBlock <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> blockRow <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// å±•å¼€jå¾ªç¯ï¼Œæ¯æ¬¡å¤„ç†8ä¸ªå…ƒç´ </span>                j <span class="token operator">=</span> colBlock <span class="token operator">*</span> blockCol<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> tmp0 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> tmp1 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> tmp2 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> tmp3 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> tmp4 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> tmp5 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> tmp6 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">7</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> tmp7 <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment">// å†™å…¥BçŸ©é˜µ</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp0<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> B<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp1<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> B<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp2<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> B<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp3<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> B<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp4<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">5</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> B<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp5<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">6</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> B<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp6<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">+</span> <span class="token number">7</span> <span class="token operator">&lt;</span> M<span class="token punctuation">)</span> B<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tmp7<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;style&gt;
img{
    width: 60%;
}
&lt;/style&gt;

&lt;p&gt;å…ˆæ”¾ä¸€ä¸ªæœ€ç»ˆç»“æœåœ¨è¿™é‡Œ&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/learning/open-course/CMU-15213/Labs/Cachelab/result.png&quot; al</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å…¬å¼€è¯¾" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/"/>
    
    <category term="CMU-15-213" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/"/>
    
    <category term="Labs" scheme="http://rinevard.github.io/categories/%E5%AD%A6%E4%B9%A0/%E5%85%AC%E5%BC%80%E8%AF%BE/CMU-15-213/Labs/"/>
    
    
  </entry>
  
</feed>
