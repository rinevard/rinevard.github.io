<!DOCTYPE html>
<html lang=zh>

    <head>
        <meta charset="utf-8">
        
            <title>
                
                    Note 3 Shading | 
                            Rinevard
            </title>
            
                
                    <meta name="keywords" content="Note 3 Shading" />
                    
                        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
                        <meta name="description" content="יְהִי אוֹר起初，计算机的世界尚未渲染，显示器中空虚混沌，渊面黑暗。 唯有顶点与多边形悬于虚空，不见其形，不辨其色。 那声音说：“要有光。” 就有了光。 光是好的，于是那声音将光与暗分开了。光所照之处，物体的正面得以显现；光所不至的背面，则归于阴影。从此，三维的世界有了明暗与层次。 这光并非一体。 那普照万物，均匀散开，使物体显其本色的，称之为漫反射。 那汇于一点，锐利夺目，使光滑之物尽显">
<meta property="og:type" content="article">
<meta property="og:title" content="Note 3 Shading">
<meta property="og:url" content="http://rinevard.github.io/wiki/learning/open-course/GAMES101/Notes/Note3-Shading/index.html">
<meta property="og:site_name" content="Rinevard">
<meta property="og:description" content="יְהִי אוֹר起初，计算机的世界尚未渲染，显示器中空虚混沌，渊面黑暗。 唯有顶点与多边形悬于虚空，不见其形，不辨其色。 那声音说：“要有光。” 就有了光。 光是好的，于是那声音将光与暗分开了。光所照之处，物体的正面得以显现；光所不至的背面，则归于阴影。从此，三维的世界有了明暗与层次。 这光并非一体。 那普照万物，均匀散开，使物体显其本色的，称之为漫反射。 那汇于一点，锐利夺目，使光滑之物尽显">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://rinevard.github.io/images/learning/open-course/GAMES101/Notes/note3/specular.png">
<meta property="og:image" content="http://rinevard.github.io/images/learning/open-course/GAMES101/Notes/note3/normal-map.jpg">
<meta property="og:image" content="http://rinevard.github.io/images/learning/open-course/GAMES101/Notes/note3/shading-freq.png">
<meta property="og:image" content="http://rinevard.github.io/images/learning/open-course/GAMES101/Notes/note3/pipeline.png">
<meta property="og:image" content="http://rinevard.github.io/images/learning/open-course/GAMES101/Notes/note3/mag-minification.png">
<meta property="og:image" content="http://rinevard.github.io/images/learning/open-course/GAMES101/Notes/note3/upsample.png">
<meta property="og:image" content="http://rinevard.github.io/images/learning/open-course/GAMES101/Notes/note3/downsample.png">
<meta property="article:published_time" content="2025-09-17T04:10:28.000Z">
<meta property="article:modified_time" content="2025-09-17T04:03:13.842Z">
<meta property="article:author" content="Rinevard">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://rinevard.github.io/images/learning/open-course/GAMES101/Notes/note3/specular.png">
                            

                                

                                        
                                            <link rel="icon" href="/images/jurorara.png" />
                                            

                                                
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

                                                    
<link rel="stylesheet" href="/libs/open-sans/styles.css">

                                                        
<link rel="stylesheet" href="/libs/source-code-pro/styles.css">


                                                            
<link rel="stylesheet" href="/css/style.css">


                                                                <!-- TOC Sidebar CSS -->
                                                                
                                                                    
<link rel="stylesheet" href="/css/toc-sidebar.css">

                                                                        

                                                                            <!-- Medium Zoom CSS -->
                                                                            
<link rel="stylesheet" href="/css/medium-zoom.css">


                                                                                
<script src="/libs/jquery/2.1.3/jquery.min.js"></script>


                                                                                    <script
                                                                                        src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>
                                                                                    <script>
                                                                                        if (Cookies.get('sidebarHidden') === 'true') {
                                                                                            document.documentElement.classList.add('sidebar-hidden');
                                                                                        }
                                                                                    </script>

                                                                                    
    
                
                            
                                        
                                                
                                                            
                                                                                        

                                                                                                <!-- PrismJS assets -->
                                                                                                <!-- use light theme -->
                                                                                                <link rel="stylesheet"
                                                                                                    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" />
                                                                                                <link rel="stylesheet"
                                                                                                    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.css" />
                                                                                                <script defer
                                                                                                    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
                                                                                                <script defer
                                                                                                    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
                                                                                                <link rel="stylesheet"
                                                                                                    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" />
                                                                                                <script defer
                                                                                                    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js"></script>
                                                                                                <script defer
                                                                                                    src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script>
                                                                                                <!-- Custom Prism copy button styling -->
                                                                                                
<link rel="stylesheet" href="/css/prism-copy-button.css">

                                                                                                    <!-- configure autoloader before it loads -->
                                                                                                    <script>
                                                                                                        window.Prism = window.Prism || {};
                                                                                                        Prism.plugins = Prism.plugins || {};
                                                                                                        Prism.plugins.autoloader = Prism.plugins.autoloader || {};
                                                                                                        Prism.plugins.autoloader.languages_path = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/';
                                                                                                    </script>
                                                                                                    <script defer
                                                                                                        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
                                                                                                    <!-- Custom Prism copy button JavaScript -->
                                                                                                    <script defer
                                                                                                        src="/js/prism-copy-button.js"></script>

                                                                                                    <!-- Medium Zoom for Images -->
                                                                                                    <script defer
                                                                                                        src="/libs/medium-zoom/medium-zoom.min.js"></script>
                                                                                                    <script defer
                                                                                                        src="/js/medium-zoom-init.js"></script>
    <meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Rinevard" type="application/atom+xml">
</head>

    <body>
        <div id="container">
            <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">Rinevard</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/">首页</a>
                
                    <a class="main-nav-link" href="/archives">文章历史</a>
                
                    <a class="main-nav-link" href="/about">关于我</a>
                
            </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>


</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/">首页</a></td>
                
                    <td><a class="main-nav-link" href="/archives">文章历史</a></td>
                
                    <td><a class="main-nav-link" href="/about">关于我</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

                <div class="outer">
                    
                                <section id="main"><article id="post-learning/open-course/GAMES101/Notes/Note3-Shading" class="article article-type-post" itemscope
    itemprop="blogPost">
    <div class="article-inner">
        
                    
                        <header class="article-header">
                            
                                <div class="article-meta">
                                    
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/%E5%85%AC%E5%BC%80%E8%AF%BE/">公开课</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/%E5%85%AC%E5%BC%80%E8%AF%BE/GAMES101/">GAMES101</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/%E5%85%AC%E5%BC%80%E8%AF%BE/GAMES101/Notes/">Notes</a>
    </div>

                                        
                                            
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/wiki/learning/open-course/GAMES101/Notes/Note3-Shading/">
            <time datetime="2025-09-17T04:10:28.000Z" itemprop="datePublished">2025-09-17</time>
        </a>
    </div>


                                                
                                                        
                                </div>
                                
                                    
    
        <h1 class="article-title" itemprop="name">
            Note 3 Shading
        </h1>
    

                        </header>
                        
                            
                                <div class="article-entry" itemprop="articleBody">
                                    
                                        
                                                                                                                
                                                                                                                    <!-- 原始目录隐藏，但保留供JS获取结构 -->
                                                                                                                    <div id="toc"
                                                                                                                        class="toc-article"
                                                                                                                        style="display: none;">
                                                                                                                        <strong
                                                                                                                            class="toc-title">
                                                                                                                            文章目录
                                                                                                                        </strong>
                                                                                                                        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%D7%99%D6%B0%D7%94%D6%B4%D7%99-%D7%90%D7%95%D6%B9%D7%A8"><span class="toc-number">1.</span> <span class="toc-text">יְהִי אוֹר</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%AB%E5%8F%8D%E5%B0%84%EF%BC%88Diffuse-Reflection%EF%BC%89"><span class="toc-number">1.1.</span> <span class="toc-text">漫反射（Diffuse Reflection）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E9%9D%A2%E5%8F%8D%E5%B0%84%EF%BC%88Specular-Reflection%EF%BC%89"><span class="toc-number">1.2.</span> <span class="toc-text">镜面反射（Specular Reflection）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%85%89%EF%BC%88Ambient-Lighting%EF%BC%89"><span class="toc-number">1.3.</span> <span class="toc-text">环境光（Ambient Lighting）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%AF%E6%B0%8F%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.4.</span> <span class="toc-text">冯氏光照模型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UV%E6%98%A0%E5%B0%84"><span class="toc-number">2.</span> <span class="toc-text">UV映射</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9D%80%E8%89%B2%E6%96%B9%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">着色方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B3%E9%9D%A2%E7%9D%80%E8%89%B2%EF%BC%88Flat-Shading%EF%BC%89"><span class="toc-number">3.1.</span> <span class="toc-text">平面着色（Flat Shading）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%90%E9%A1%B6%E7%82%B9%E7%9D%80%E8%89%B2%EF%BC%88Gouraud-Shading%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">逐顶点着色（Gouraud Shading）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%90%E5%83%8F%E7%B4%A0%E7%9D%80%E8%89%B2%EF%BC%88Phong-Shading%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">逐像素着色（Phong Shading）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF"><span class="toc-number">4.</span> <span class="toc-text">渲染管线</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BA%B9%E7%90%86%E6%94%BE%E5%A4%A7%E5%92%8C%E7%BA%B9%E7%90%86%E7%BC%A9%E5%B0%8F"><span class="toc-number">5.</span> <span class="toc-text">纹理放大和纹理缩小</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%B9%E7%90%86%E6%94%BE%E5%A4%A7"><span class="toc-number">5.1.</span> <span class="toc-text">纹理放大</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%B9%E7%90%86%E7%BC%A9%E5%B0%8F"><span class="toc-number">5.2.</span> <span class="toc-text">纹理缩小</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%B0%8F%E7%9F%A5%E8%AF%86"><span class="toc-number">6.</span> <span class="toc-text">其他小知识</span></a></li></ol>
                                                                                                                    </div>
                                                                                                                    
                                                                                                                        <h1 id="יְהִי-אוֹר"><a href="#יְהִי-אוֹר" class="headerlink" title="יְהִי אוֹר"></a>יְהִי אוֹר</h1><p>起初，计算机的世界尚未渲染，显示器中空虚混沌，渊面黑暗。</p>
<p>唯有顶点与多边形悬于虚空，不见其形，不辨其色。</p>
<p>那声音说：<strong>“要有光。”</strong></p>
<p>就有了光。</p>
<p>光是好的，于是那声音将光与暗分开了。光所照之处，物体的正面得以显现；光所不至的背面，则归于阴影。从此，三维的世界有了明暗与层次。</p>
<p>这光并非一体。</p>
<p>那普照万物，均匀散开，使物体显其本色的，称之为<strong>漫反射</strong>。</p>
<p>那汇于一点，锐利夺目，使光滑之物尽显其耀的，称之为<strong>镜面反射</strong>。</p>
<p>那弥漫于环境，充盈于阴影，使黑暗不至完全吞噬一切的，称之为<strong>环境光</strong>。</p>
<p>有漫反射，有镜面反射，有环境光，共同构成了这虚拟世界的第一个白昼。</p>
<h2 id="漫反射（Diffuse-Reflection）"><a href="#漫反射（Diffuse-Reflection）" class="headerlink" title="漫反射（Diffuse Reflection）"></a>漫反射（<strong>Diffuse Reflection）</strong></h2><p>在漫反射中，光向四面八方散去，所以物体漫反射出的光与摄像机位置无关，而仅与以下几项有关：</p>
<ol>
<li>光强 $c_l$.</li>
<li>物体材质 $c_r$. 不同物体对光的反射率是不同的，即使是同一个物体也对不同颜色的光有不同反射率。</li>
<li>物体表面法线 $\mathbf{n}$.</li>
<li>光源方向 $\mathbf{l}$.</li>
</ol>
<p>最终结果可以写成 </p>
<script type="math/tex; mode=display">
L_d = c_r c_l \max (0, \mathbf{n} \cdot \mathbf{l})</script><p>由于光强一般随距离衰减，所以 $c_l$ 一般反比于距离的平方 $r^2$. </p>
<h2 id="镜面反射（Specular-Reflection）"><a href="#镜面反射（Specular-Reflection）" class="headerlink" title="镜面反射（Specular Reflection）"></a>镜面反射（Specular Reflection）</h2><p>镜面反射中，光主要向一个方向反射，所以镜面反射的光与摄像机位置有关。</p>
<script type="math/tex; mode=display">
L_s = c_pc_l\max(0, \mathbf n \cdot \mathbf h)^p</script><p>其中 $c_p$ 是自定义的 RGB 值，允许我们控制高光颜色，指数 $p$ 是为了保证我们只在小范围内看到高光，$p$ 越大这个高光可见范围越小，而 $\mathbf h$ 的定义如下：</p>
<script type="math/tex; mode=display">
\mathbf h = (\mathbf e + \mathbf l).\text{normalized()}</script><p>还有一种写法把 $\mathbf n \cdot \mathbf h$ 换成了 $\mathbf r \cdot \mathbf e$，简单计算可以发现 $\mathbf<br>n$ 和 $\mathbf h$ 的夹角是 $\mathbf r$ 和 $\mathbf e$ 的夹角的一半，所以这两个写法在思路上是一样的，都在考虑反射光方向和摄像机方向的夹角，不过在数值上会略有差别。本文采用 $\mathbf n \cdot \mathbf h$ 的写法。</p>
<p><img src="/images/learning/open-course/GAMES101/Notes/note3/specular.png" alt=""></p>
<h2 id="环境光（Ambient-Lighting）"><a href="#环境光（Ambient-Lighting）" class="headerlink" title="环境光（Ambient Lighting）"></a>环境光（Ambient Lighting）</h2><p>如果只考虑漫反射和镜面反射，我们会发现没有面朝光源的物体完全是黑色的，但现实里显然不是如此。这是因为在现实里，光经过多次反射而照亮了那些没有面朝光源的物体。我们可以近似地认为有一种充斥着整个空间的光，并把它叫做环境光，公式如下：</p>
<script type="math/tex; mode=display">
L_a=c_r c_a</script><p>其中 $c_a$ 是环境光的强度。</p>
<h2 id="冯氏光照模型"><a href="#冯氏光照模型" class="headerlink" title="冯氏光照模型"></a>冯氏光照模型</h2><p>综合来看，我们就得到了<strong>冯氏光照模型</strong>，公式如下：</p>
<script type="math/tex; mode=display">
L=c_r(c_a+c_l\max{(0,\mathbf n \cdot \mathbf l)})+c_pc_l\max(0, \mathbf n \cdot \mathbf h)^p</script><p>其中 </p>
<ol>
<li>$c_r$ 是物体材质，表示物体对光的反射率，一般是一个 Vector3f 类型的值，因为物体对不同颜色的光有不同反射率；</li>
<li>$c_a$ 是环境光强，一般是一个 Vector3f 类型的值；</li>
<li>$c_l$ 是光强，一般与物体和光源的距离成反比，一般是一个 Vector3f 类型的值；</li>
<li>$c_p$ 是高光颜色，一般也是一个 Vector3f 类型的值。</li>
</ol>
<h1 id="UV映射"><a href="#UV映射" class="headerlink" title="UV映射"></a>UV映射</h1><p>为了把贴图贴到模型上，需要有一个 $(x, y, z) \rightarrow (u, v)$ 的函数 $\phi$. 我们期望这个函数有这些性质：</p>
<ol>
<li>单射：我们不希望两个 3D 点映射到同一个 2D 点上</li>
<li>大小不变性：在 3D 模型上的三角形多大，我们希望 2D 的三角形也差不多大小</li>
<li>形状不变性：3D 模型的三角形映射到 2D 上后，两个三角形应尽量相似</li>
<li>连续：如果两个点在 3D 世界模型上相近，我们希望它们在 2D 上也相近</li>
</ol>
<p>贴图有许多应用，最容易想到的是颜色贴图，它直接把颜色贴到模型上，也被称作漫反射贴图。</p>
<p>法线贴图、金属度贴图、粗糙度贴图则进一步决定了模型的各种属性。比如法线贴图定义了每一点的法线，在计算光照时会借助这个法线来得到更真实的结果。</p>
<p><img src="/images/learning/open-course/GAMES101/Notes/note3/normal-map.jpg" alt=""></p>
<h1 id="着色方法"><a href="#着色方法" class="headerlink" title="着色方法"></a>着色方法</h1><p>模型由三角形划分来表示，那么每个三角形用怎样的颜色呢？</p>
<h2 id="平面着色（Flat-Shading）"><a href="#平面着色（Flat-Shading）" class="headerlink" title="平面着色（Flat Shading）"></a>平面着色（Flat Shading）</h2><p>我们通过光照计算颜色，而计算光照需要法线。平面着色直接求这个三角形的法线，然后按光照公式计算这个三角形的颜色。这种方法得到的每个三角形都是单色的。</p>
<h2 id="逐顶点着色（Gouraud-Shading）"><a href="#逐顶点着色（Gouraud-Shading）" class="headerlink" title="逐顶点着色（Gouraud Shading）"></a>逐顶点着色（Gouraud Shading）</h2><p>逐顶点着色则求三角形顶点的法线，并为三角形顶点着色，然后对内部的每个点插值内部颜色。</p>
<p>那么顶点的法线是什么呢？一个顶点一般在多个面上，把这些面的法线做加权平均就好，权值可以是面的面积。</p>
<h2 id="逐像素着色（Phong-Shading）"><a href="#逐像素着色（Phong-Shading）" class="headerlink" title="逐像素着色（Phong Shading）"></a>逐像素着色（Phong Shading）</h2><p>逐像素着色同样求三角形顶点的法线，然后对内部的每个点插值内部法线，从法线再求各个点的颜色。</p>
<p>插值是通过重心坐标来插值。对三角形 $ABC$ 内的某一点 $P$，它可以表示为</p>
<script type="math/tex; mode=display">
P=\frac{S_{APB}C+S_{BPC}A+S_{CPA}B}{S_{ABC}}</script><p>这里的 $S$ 是面积，这里的形如 $S<em>{APB}/S</em>{ABC}$ 的式子就是各个点的权值。</p>
<p>在插值时，我们希望在世界空间 / 摄像机空间做插值，即在 viewing transformation 前进行插值，而不是 viewing transformation 后。</p>
<p>但我们一般在光栅化时才进行插值，这时已经把物体变换到了 NDC 空间，所以我们还要进行透视矫正。公式如下，具体推导可以参考 Homework 3 的笔记。</p>
<script type="math/tex; mode=display">
\begin{align*}
&\alpha = \frac{\alpha' / w_0}{\alpha' / w_0 + \beta' / w_1 + \gamma' / w_2}
\\
&\beta= \frac{\beta' / w_1}{\alpha' / w_0 + \beta' / w_1 + \gamma' / w_2}
\\
&\gamma= \frac{\gamma' / w_2}{\alpha' / w_0 + \beta' / w_1 + \gamma' / w_2}
\end{align*}</script><p>其中 $\alpha’,\beta’,\gamma’$ 是屏幕空间的重心坐标，$\alpha,\beta,\gamma$ 是世界空间的重心坐标。我们用世界空间的重心坐标作为权重来插值。</p>
<p><img src="/images/learning/open-course/GAMES101/Notes/note3/shading-freq.png" alt=""></p>
<h1 id="渲染管线"><a href="#渲染管线" class="headerlink" title="渲染管线"></a>渲染管线</h1><p>渲染流程基本如下：</p>
<ol>
<li>Input：输入 3D 世界的顶点</li>
<li>Vertex Processing：用各种变换矩阵把顶点变换到屏幕空间</li>
<li>Triangle Processing：根据传入的顶点连接方式在屏幕空间连接三角形</li>
<li>Rasterization：把三角形转化成片元 / 像素</li>
<li>Fragement Processing：应用贴图、光照等</li>
<li>Framebuffer Operations：深度测试等</li>
</ol>
<p><img src="/images/learning/open-course/GAMES101/Notes/note3/pipeline.png" alt=""></p>
<h1 id="纹理放大和纹理缩小"><a href="#纹理放大和纹理缩小" class="headerlink" title="纹理放大和纹理缩小"></a>纹理放大和纹理缩小</h1><p>在做纹理映射时，贴图太小和贴图太大都会有问题。</p>
<p><img src="/images/learning/open-course/GAMES101/Notes/note3/mag-minification.png" alt=""></p>
<h2 id="纹理放大"><a href="#纹理放大" class="headerlink" title="纹理放大"></a>纹理放大</h2><p>贴图太小时要做纹理放大，对采样点做双线性插值即可。</p>
<p><img src="/images/learning/open-course/GAMES101/Notes/note3/upsample.png" alt=""></p>
<h2 id="纹理缩小"><a href="#纹理缩小" class="headerlink" title="纹理缩小"></a>纹理缩小</h2><p>贴图太大时直觉上比贴图太小更好处理，但恰恰相反。还记得频谱吗，贴图太大代表高频有更多信息，我们会因采样频率不足而无法正确反映高频信息，导致结果出现锯齿、摩尔纹等走样问题。</p>
<p>最常用的缓解方法是 Mipmapping。基本思路是，我们分析屏幕上每个像素在贴图上覆盖的像素数量，对那些覆盖较多的，就让他们去被缩小的贴图上采样，这样就能缓解欠采样问题。</p>
<p>首先我们要创建“缩小的贴图”，Mipmap链包含一系列纹理 $D_0, D_1, D_2, \ldots, D_N$，其中 $D_i$ 的分辨率为 $\frac{W}{2^i} \times \frac{H}{2^i}$，直到最内层为 $1 \times 1$ 像素。</p>
<p>然后我们要分析单个屏幕像素覆盖了多少纹理像素，大致思路是计算屏幕空间的相邻点映射到贴图空间后的距离。贴图空间里相邻像素距离为 $1$，所以如果屏幕空间的相邻点映射到贴图空间后的距离为 $x$，我们就认为它覆盖了 $x$ 个像素。</p>
<p>这个“单个屏幕像素覆盖了多少纹理像素”的估算被记作 $\rho$，公式如下：</p>
<script type="math/tex; mode=display">
\rho = \max\left( \sqrt{\left(\frac{\partial u}{\partial x}\right)^2 + \left(\frac{\partial v}{\partial x}\right)^2}, \sqrt{\left(\frac{\partial u}{\partial y}\right)^2 + \left(\frac{\partial v}{\partial y}\right)^2} \right)</script><p>取 $\max$ 是为了尽可能取层级更低的 Mipmap。一个屏幕像素覆盖的纹理像素越多，它对应的 Mipmap 层级就越小。总之，我们宁可模糊，也不要欠采样。</p>
<p>最后用 $\lambda = \log_2{\rho}$ 就能算出这个屏幕像素对应的纹理层级。比如当 $\lambda = 0$ 时，表示一个屏幕像素恰好对应一个纹理像素，应使用原始纹理 $D_0$.</p>
<p><img src="/images/learning/open-course/GAMES101/Notes/note3/downsample.png" alt=""></p>
<p>计算出层级 $\lambda$ 后还要做采样。显然 $\lambda$ 大多数时候都不是整数，所以有两种常见的采样方法：</p>
<ol>
<li><p>最近邻Mipmap滤波（Nearest Mipmap Filtering）</p>
<p> 选择最接近 $\lambda$ 的整数层级 $d = \text{round}(\lambda)$ 做采样，在这一层可以是最近邻或双线性滤波。</p>
</li>
<li><p>三线性滤波（Trilinear Filtering）</p>
<p> 确定 $\lambda$ 两侧的两个整数层级：$d_1 = \lfloor\lambda\rfloor$ 和 $d_2 = \lceil\lambda\rceil = d_1 + 1$，在这两层分别做双线性滤波采样得到颜色 $C_1$ 和 $C_2$，然后得到最终颜色</p>
<script type="math/tex; mode=display">
 C = (1 - f) \cdot C_1 + f \cdot C_2</script><p> 其中 $f = \lambda - \lfloor\lambda\rfloor$ 为 $\lambda$ 的小数部分。</p>
</li>
</ol>
<h1 id="其他小知识"><a href="#其他小知识" class="headerlink" title="其他小知识"></a>其他小知识</h1><p>虎书提到的planar projection、spherical coordinates、cylindrical coordinates、cubemaps本质上都是把3d表面投影到一个理想的简单几何体上，然后把简单几何体展开成平面。</p>

                                                                                                                            
                                                                                                                                
                                </div>
                                <footer class="article-footer">
                                </footer>
    </div>
</article>


    
<nav id="article-nav">
    
        <a href="/wiki/learning/open-course/GAMES101/Notes/Note4-Geometry/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    Note 4 Geometry
                
            </div>
        </a>
    
    
        <a href="/wiki/learning/open-course/GAMES101/Hw/Hw3-pipeline-and-shading/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">Assignment 3 Pipeline and Shading</div>
        </a>
    
</nav>


        

            
                 
<section id="comments">
  <div class="giscus"></div>
  <script src="https://giscus.app/client.js" data-repo="rinevard/rinevard.github.io"
    data-repo-id="R_kgDOLkoe9A" data-category="Announcements"
    data-category-id="DIC_kwDOLkoe9M4CjJnR" data-mapping="pathname" data-reactions-enabled="1"
    data-emit-metadata="0" data-input-position="top" data-theme="preferred_color_scheme" data-lang="zh-CN"
    data-loading="lazy" crossorigin="anonymous" async></script>
  </section>
 

                    

                        
                            <!-- baidu url auto push script -->
                            <script type="text/javascript">
                                !function () { var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi, r = window.location.href, o = document.referrer; if (!e.test(r)) { var n = "//api.share.baidu.com/s.gif"; o ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r); var t = new Image; t.src = n } }(window);
                            </script>
                            </section>
                                
                                    <aside id="sidebar">
    <div class="sidebar-content">
        
            
    <div class="widget-wrap" id='categories'>
        <h3 class="widget-title">
            <span>文章</span>
        </h3>

        <div class="widget categories-widget">
            

                

                        
                            
                                
                    <ul class="unstyled" id="tree" >
                            
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        gamejam
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                    <li class="file">
                                        <a href="/wiki/game-design/ldjam%E5%8F%82%E8%B5%9B%E6%8C%87%E5%8D%97/">
                                            <i class="fa fa-file-text-o"></i>
                                            Ludum Dare参加指南
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                                <li class="directory open">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder-open"></i>
                                        公开课
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        CMU-15-213
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        Labs
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Labs/Datalab/">
                                            <i class="fa fa-file-text-o"></i>
                                            Datalab解析
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Labs/Bomblab/">
                                            <i class="fa fa-file-text-o"></i>
                                            Bomblab感想
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Labs/Attacklab/">
                                            <i class="fa fa-file-text-o"></i>
                                            Attackblab记录
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Labs/Cachelab/">
                                            <i class="fa fa-file-text-o"></i>
                                            Cachelab理论分析
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Labs/Shlab/">
                                            <i class="fa fa-file-text-o"></i>
                                            Shlab调试记录和一键测试脚本
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Labs/Malloclab/">
                                            <i class="fa fa-file-text-o"></i>
                                            Malloclab和我不得不说的那些事
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        Notes
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Notes/Chapter2-data-representation/">
                                            <i class="fa fa-file-text-o"></i>
                                            第二章——计算机内的信息表示
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Notes/Chapter3-machine-level-program/">
                                            <i class="fa fa-file-text-o"></i>
                                            第三章——程序的机器级别表示
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Notes/Chapter5-optimization/">
                                            <i class="fa fa-file-text-o"></i>
                                            第五章——性能优化
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Notes/Chapter6-memory-and-cache/">
                                            <i class="fa fa-file-text-o"></i>
                                            第六章——存储器层次结构
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Notes/Chapter8-exception-control-flow/">
                                            <i class="fa fa-file-text-o"></i>
                                            第八章——异常控制流
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Notes/Chapter10-system-io/">
                                            <i class="fa fa-file-text-o"></i>
                                            第十章——系统级I/O
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/CMU-15-213/Notes/Chapter9-virtual-memory/">
                                            <i class="fa fa-file-text-o"></i>
                                            第九章——虚拟内存
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                    </ul>
                    
                                </li>
                                
                                <li class="directory open">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder-open"></i>
                                        GAMES101
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        Assignments
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/GAMES101/Hw/Hw1-transformation/">
                                            <i class="fa fa-file-text-o"></i>
                                            Assignment 1 Transformation
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/GAMES101/Hw/Hw2-rasterizing/">
                                            <i class="fa fa-file-text-o"></i>
                                            Assignment 2 Rasterizing
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/GAMES101/Hw/Hw3-pipeline-and-shading/">
                                            <i class="fa fa-file-text-o"></i>
                                            Assignment 3 Pipeline and Shading
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/GAMES101/Hw/Hw4-geometry/">
                                            <i class="fa fa-file-text-o"></i>
                                            Assignment 4 Geometry
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/GAMES101/Hw/Hw5-raytracing/">
                                            <i class="fa fa-file-text-o"></i>
                                            Assignment 5 Raytracing
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                                <li class="directory open">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder-open"></i>
                                        Notes
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/GAMES101/Notes/Note1-transformation/">
                                            <i class="fa fa-file-text-o"></i>
                                            Note 1 Transformation
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/GAMES101/Notes/Note2-Rasterizing/">
                                            <i class="fa fa-file-text-o"></i>
                                            Note 2 Rasterizing
                                        </a>
                                    </li>
                                    
                                    <li class="file active">
                                        <a href="/wiki/learning/open-course/GAMES101/Notes/Note3-Shading/">
                                            <i class="fa fa-file-text-o"></i>
                                            Note 3 Shading
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/GAMES101/Notes/Note4-Geometry/">
                                            <i class="fa fa-file-text-o"></i>
                                            Note 4 Geometry
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                    </ul>
                    
                                </li>
                                
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        MIT-6.S081
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        Labs
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/MIT-6.S081/Labs/lab1-util/">
                                            <i class="fa fa-file-text-o"></i>
                                            Lab1 Xv6 and Unix utilities
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/MIT-6.S081/Labs/lab2-syscall/">
                                            <i class="fa fa-file-text-o"></i>
                                            Lab2 System calls
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        Notes
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/MIT-6.S081/Notes/note1-sys-interface/">
                                            <i class="fa fa-file-text-o"></i>
                                            第一章——系统接口
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/MIT-6.S081/Notes/little-fish/">
                                            <i class="fa fa-file-text-o"></i>
                                            看我看我
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/MIT-6.S081/Notes/note2-organization-overview/">
                                            <i class="fa fa-file-text-o"></i>
                                            第二章——操作系统概述
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/MIT-6.S081/BeforeStory/">
                                            <i class="fa fa-file-text-o"></i>
                                            在开始之前
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                                    <li class="file">
                                        <a href="/wiki/learning/open-course/%E8%BF%99%E6%98%AF%E5%93%AA%E9%87%8C/">
                                            <i class="fa fa-file-text-o"></i>
                                            这里有什么？
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        杂谈
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        二次元
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                    <li class="file">
                                        <a href="/wiki/others/animation/%E6%AF%8D%E9%B8%A1%E5%8D%A1%E7%9A%84%E5%90%84%E7%A7%8D%E7%A5%9E%E5%A5%87%E5%81%87%E8%8D%AF/">
                                            <i class="fa fa-file-text-o"></i>
                                            母鸡卡的各种神奇假药
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        碎碎念
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                    <li class="file">
                                        <a href="/wiki/others/thoughts/datalab%E5%92%8C%E6%88%91/">
                                            <i class="fa fa-file-text-o"></i>
                                            _Datalab和我
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/others/thoughts/%E7%8E%A9%E4%B9%90%E7%9A%84%E4%BA%BA/">
                                            <i class="fa fa-file-text-o"></i>
                                            _玩乐的人
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/others/thoughts/%E7%BD%91%E4%B8%8A%E5%86%B2%E6%B5%AA/">
                                            <i class="fa fa-file-text-o"></i>
                                            慢慢地冲浪
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/others/thoughts/%E6%88%91%E4%B9%9F%E6%83%B3%E5%81%9A%E5%87%BA%E4%BC%98%E7%A7%80%E7%9A%84%E4%BD%9C%E5%93%81/">
                                            <i class="fa fa-file-text-o"></i>
                                            _我也想做出优秀的作品
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                    </ul>
                    
                                </li>
                                
                                <li class="directory">
                                    <a href="#" data-role="directory">
                                        <i
                                            class="fa fa-folder"></i>
                                        游戏设计
                                    </a>
                                    
                    <ul class="unstyled" id="tree" >
                            
                                    <li class="file">
                                        <a href="/wiki/game-design/%E5%AF%B9%E6%8E%A2%E7%B4%A2%E7%B1%BB%E6%B8%B8%E6%88%8F%E7%9A%84%E6%80%9D%E8%80%83/">
                                            <i class="fa fa-file-text-o"></i>
                                            对探索类游戏的思考
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/game-design/%E5%86%B0%E5%B1%B1%E4%B9%8B%E4%B8%8B%E7%9A%84%E6%B7%B1%E5%BA%A6/">
                                            <i class="fa fa-file-text-o"></i>
                                            技巧的分类，冰山之下的深度
                                        </a>
                                    </li>
                                    
                                    <li class="file">
                                        <a href="/wiki/game-design/%E6%9D%80%E6%88%AE%E5%B0%96%E5%A1%94%E6%A1%86%E6%9E%B6/">
                                            <i class="fa fa-file-text-o"></i>
                                            杀戮尖塔的框架如此自洽，我们能离开它吗？
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                </li>
                                
                                    <li class="file">
                                        <a href="/">
                                            <i class="fa fa-file-text-o"></i>
                                            欢迎！
                                        </a>
                                    </li>
                                    
                    </ul>
                    
                                    
        </div>
    </div>

    <script>
        $(document).ready(function () {
            var iconFolderOpenClass = 'fa-folder-open';
            var iconFolderCloseClass = 'fa-folder';

            // Handle directory-tree expansion:
            // 左键单独展开目录
            $(document).on('click', '#categories a[data-role="directory"]', function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var subtree = $(this).siblings('ul');
                icon.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);

                if (expanded) {
                    if (typeof subtree != 'undefined') {
                        subtree.slideUp({ duration: 100 });
                    }
                    icon.addClass(iconFolderCloseClass);
                } else {
                    if (typeof subtree != 'undefined') {
                        subtree.slideDown({ duration: 100 });
                    }
                    icon.addClass(iconFolderOpenClass);
                }
            });

            // 右键展开下属所有目录
            $('#categories a[data-role="directory"]').bind("contextmenu", function (event) {
                event.preventDefault();

                var icon = $(this).children('.fa');
                var expanded = icon.hasClass(iconFolderOpenClass);
                var listNode = $(this).siblings('ul');
                var subtrees = $.merge(listNode.find('li ul'), listNode);
                var icons = $.merge(listNode.find('.fa'), icon);
                icons.removeClass(iconFolderOpenClass).removeClass(iconFolderCloseClass);

                if (expanded) {
                    subtrees.slideUp({ duration: 100 });
                    icons.addClass(iconFolderCloseClass);
                } else {
                    subtrees.slideDown({ duration: 100 });
                    icons.addClass(iconFolderOpenClass);
                }
            });
        });
    </script>
    
        
    </div>
</aside>
                                        
                </div>
                <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            Rinevard &copy; 2025
                    <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a>
                    <br> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme - <a
                        href="https://github.com/rinevard" target="_blank">Rinekitten</a>
                    
        </div>
    </div>
</footer>
                    
    
                                                                
                                                                                                            
                                                                                                                        
                                                                                                                            <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true,
            TeX: {
                equationNumbers: {
                  autoNumber: 'AMS'
                }
            }
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
                                                                                                                                
                                                                                                                                    

        <!-- Custom Scripts -->
        
<script src="/js/main.js"></script>

            
                <!-- Notion风格目录JS -->
                
<script src="/js/toc-sidebar.js"></script>

                    
                        
<script src="/js/sidebar.js"></script>

        </div>

        <!-- 固定在左下角的侧边栏切换按钮 -->
        <div id="sidebar-toggle-btn">
            <i class="fa fa-angle-double-left"></i>
        </div>

        <!-- 回到顶部按钮 -->
        <div id="toTop" title="回到顶部">
            <i class="fa fa-arrow-up"></i>
        </div>

        <script>
            $(document).ready(function () {
                // 回到顶部按钮功能
                $(window).scroll(function () {
                    if ($(this).scrollTop() > 200) {
                        $('#toTop').fadeIn();
                    } else {
                        $('#toTop').fadeOut();
                    }
                });

                $('#toTop').click(function () {
                    $('html, body').animate({
                        scrollTop: 0
                    }, 400);
                    return false;
                });
            });
        </script>
    </body>

    </html>